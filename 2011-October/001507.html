<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mapnik-devel] line placement is extremely slow for long road
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mapnik-devel/2011-October/index.html" >
   <LINK REL="made" HREF="mailto:mapnik-devel%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-devel%5D%20line%20placement%20is%20extremely%20slow%20for%20long%20road&In-Reply-To=%3CB96A985A-AFF3-4685-954F-D73772C05249%40dbsgeo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001505.html">
   <LINK REL="Next"  HREF="001506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mapnik-devel] line placement is extremely slow for long road</H1>
    <B>Dane Springmeyer</B> 
    <A HREF="mailto:mapnik-devel%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-devel%5D%20line%20placement%20is%20extremely%20slow%20for%20long%20road&In-Reply-To=%3CB96A985A-AFF3-4685-954F-D73772C05249%40dbsgeo.com%3E"
       TITLE="[Mapnik-devel] line placement is extremely slow for long road">dane at dbsgeo.com
       </A><BR>
    <I>Thu Oct 27 18:19:17 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001505.html">[Mapnik-devel] line placement is extremely slow for long road
</A></li>
        <LI>Next message: <A HREF="001506.html">[Mapnik-devel] Oracle/MapNik and Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1507">[ date ]</a>
              <a href="thread.html#1507">[ thread ]</a>
              <a href="subject.html#1507">[ subject ]</a>
              <a href="author.html#1507">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>zsj,

awesome work and investigations. We have a few issues as part of the 'performance' label (which groups performance work across all milestones) here:

<A HREF="https://github.com/mapnik/mapnik/issues?labels=performance&amp;sort=created&amp;direction=desc&amp;state=open&amp;page=1">https://github.com/mapnik/mapnik/issues?labels=performance&amp;sort=created&amp;direction=desc&amp;state=open&amp;page=1</A>

You will note #876 and #840 - both contain notes on perf boost using clipping and relate to text placement/rendering speeds. Both also need to to be cleaned up and broken out into new issues (for the patches that did not land).

So, it would be excellent if you could contribute your ideas on those issues, and feel free to create new issues with pull requests for your experimentations.

Other notes is that the move to github lost patches, so you may want to view the archived tickets on trac to get oriented: <A HREF="http://trac.mapnik.org/ticket/840">http://trac.mapnik.org/ticket/840</A> and <A HREF="http://trac.mapnik.org/ticket/876.">http://trac.mapnik.org/ticket/876.</A>

Dane


On Oct 26, 2011, at 2:22 AM, zzsj wrote:

&gt;&gt;&gt;<i> hi, list
</I>&gt;&gt;&gt;<i> While rendering osm data, some tile takes much more time than others. But the output tile seems to only contain a little part of a very long road. The profiler says almost 100% time is taken by find_line_placements. It seems the algorithm tries to iterate along the whole road each time with a little distance advanced. Is this a normal behaviour?
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> regards, zsj
</I>&gt;<i> 
</I>&gt;<i> hi, all 
</I>&gt;<i> I've tried tweaking the issue. Thanks to the agg::conv_clip_polyline, simply passing a clipped path to the placement_finder could dramatically boost the find_line_placements/find_point_placements to some acceptable performance.
</I>&gt;<i> agg's conversion pipeline like agg::conv_clip_polyline/conv_clip_polygon may tweak the agg_renderer for other cases (for example: clip before transform/stroking path, if the transformation/stroking are costly). Furthermore, turn off rasterizer's clipping while vertex source level clip is used (for most of my test cases, just a little speed gain).
</I>&gt;<i> 
</I>&gt;<i> regards, zsj
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mapnik-devel mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-devel">Mapnik-devel at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/mapnik-devel">https://lists.berlios.de/mailman/listinfo/mapnik-devel</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001505.html">[Mapnik-devel] line placement is extremely slow for long road
</A></li>
	<LI>Next message: <A HREF="001506.html">[Mapnik-devel] Oracle/MapNik and Windows
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1507">[ date ]</a>
              <a href="thread.html#1507">[ thread ]</a>
              <a href="subject.html#1507">[ subject ]</a>
              <a href="author.html#1507">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mapnik-devel">More information about the Mapnik-devel
mailing list</a><br>
</body></html>
