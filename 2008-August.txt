From lwu.two at gmail.com  Wed Aug  6 02:47:29 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Tue, 5 Aug 2008 17:47:29 -0700
Subject: [Mapnik-devel] Mapnik rundemo.cpp crash (OS X 10.5, svn trunk)
Message-ID: <78ec96990808051747m1b5d5539x404323641ebfe642@mail.gmail.com>

With the help of http://trac.mapnik.org/wiki/MacInstallation and

http://www.codingadventures.com/2008/04/howto-building-mapnik-on-osx-leopard/
I finally got Mapnik from svn trunk (r727) to build on OS X Leopard 10.5.4,
and can run python (2.5) rundemo.py successfully.
However, I seem to be having odd exceptions thrown when compiling and then
running rundemo.cpp under Xcode 3.0.

The console output looks like this:
   ENCODING = utf8
   ### std::exception: vector::reserve destroyed singleton
which seems to be thrown when "create_filter("[NAME_EN] = 'Ontario'")" is
called.

I narrowed (whittled) down the exceptional code snippet to the following:

try {
        color_factory::from_string("white");
        create_filter("[NAME_EN] = 'Toronto'");
        // ...
}

which then triggers an exception somewhere in create_filter(). I've looked
through previous threads on mapnik-devel, for example
http://lists.berlios.de/pipermail/mapnik-devel/2008-February/000490.html but
the previous patches and build commands (-DBOOST_SPIRIT_THREADSAFE) don't
quite seem to apply.

Any ideas? The exception seems to be thrown when main()'s call to
create_filter(...) creates a transcoder and then passes it to
factory.compile(...), which dies as it constructs a
filter_grammar<FeatureT>.

I'm compiling and linking against boost
(port) @1.35.0_0+darwin_9+icu+python25...

~L
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080805/b7ad0c15/attachment.html>

From lwu.two at gmail.com  Wed Aug  6 22:48:35 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Wed, 6 Aug 2008 13:48:35 -0700
Subject: [Mapnik-devel] Mapnik rundemo.cpp crash (OS X 10.5, svn trunk)
In-Reply-To: <78ec96990808051747m1b5d5539x404323641ebfe642@mail.gmail.com>
References: <78ec96990808051747m1b5d5539x404323641ebfe642@mail.gmail.com>
Message-ID: <78ec96990808061348la56baacga37706f7ff7afbfc@mail.gmail.com>

After some twiddling, I finally got rundemo.cpp compiling and running
successfully on OS X 10.5.4 with boost
(port) @1.35.0_0+darwin_9+icu+python25.
Although the Xcode 3.1 build still seems to throw a vector::reserve
exception, rundemo.cpp on Leopard works if I compile on the command line,
like so:

g++ -g -I/usr/local/include/mapnik -I/opt/local/include
-I/opt/local/include/freetype2 -I../../agg/include -L/usr/local/lib
-L/opt/local/lib -lmapnik  -lboost_thread-mt rundemo.cpp -o rundemo

It also seems that rundemo.cpp is slightly out-of-date wrt the current svn
trunk directory structure. Attached is a two line patch that enables
rundemo.cpp to work equivalently to python rundemo.py on the svn trunk (as
rundemo_r728.diff), by simply changing a few directory names.

~L


On Tue, Aug 5, 2008 at 5:47 PM, Leslie Wu <lwu.two at gmail.com> wrote:

> With the help of http://trac.mapnik.org/wiki/MacInstallation and
>
> http://www.codingadventures.com/2008/04/howto-building-mapnik-on-osx-leopard/
> I finally got Mapnik from svn trunk (r727) to build on OS X Leopard 10.5.4,
> and can run python (2.5) rundemo.py successfully.
> However, I seem to be having odd exceptions thrown when compiling and then
> running rundemo.cpp under Xcode 3.0.
>
> The console output looks like this:
>    ENCODING = utf8
>    ### std::exception: vector::reserve destroyed singleton
> which seems to be thrown when "create_filter("[NAME_EN] = 'Ontario'")" is
> called.
>
> I narrowed (whittled) down the exceptional code snippet to the following:
>
> try {
>         color_factory::from_string("white");
>         create_filter("[NAME_EN] = 'Toronto'");
>         // ...
> }
>
> which then triggers an exception somewhere in create_filter(). I've looked
> through previous threads on mapnik-devel, for example
> http://lists.berlios.de/pipermail/mapnik-devel/2008-February/000490.htmlbut the previous patches and build commands (-DBOOST_SPIRIT_THREADSAFE)
> don't quite seem to apply.
>
> Any ideas? The exception seems to be thrown when main()'s call to
> create_filter(...) creates a transcoder and then passes it to
> factory.compile(...), which dies as it constructs a
> filter_grammar<FeatureT>.
>
> I'm compiling and linking against boost
> (port) @1.35.0_0+darwin_9+icu+python25...
>
> ~L
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080806/bf027dcf/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rundemo_r728.diff
Type: application/octet-stream
Size: 745 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080806/bf027dcf/attachment.obj>

From blake at hailmail.net  Fri Aug 15 22:20:08 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 15 Aug 2008 13:20:08 -0700
Subject: [Mapnik-devel] mapnik.org down
Message-ID: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>

Looks like a mod_python problem...




From lwu.two at gmail.com  Fri Aug 15 04:56:37 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Thu, 14 Aug 2008 19:56:37 -0700
Subject: [Mapnik-devel] query zoom example code (cali.cpp) and dev experience
Message-ID: <78ec96990808141956n3893ced8we22c8477dc41081b@mail.gmail.com>

Hi all,
I thought I'd share my experiences trying to modify Mapnik's (r727)
demo/c++/rundemo.cpp code to render something slightly different.

rundemo.cpp renders a map of Ontario/Quebec, and instead I wanted to draw a
map of California and its surrounding states.

I grabbed the data from the USGS in the form of "statesp020" (google it, or
browse through nationalatlas.gov) and first wanted to modify rundemo.py
instead. Alas, this is uncharted territory, as the Python binding does not
yet support the mapnik::query object (see the near empty
mapnik/bindings/python/mapnik/mapnik_query.cpp).

Instead, I modified demo/c++/rundemo.cpp, and the final result can be viewed
here: http://gist.github.com/5009/

It took some time to get up to speed on Mapnik internals -- the code is
sparsely commented and there doesn't seem to be a canonical Doxygen dump
online (although one can be generated manually from the source). The Mapnik
wiki has some details, and I started to fill in some small gaps there, but
important bits such as what the "res" (second) parameter to the
mapnik::query ctor isn't documented anywhere.

The basic data model which isn't directly documented is something like this.
A mapnik Map has Layers, a Layer has a mapnik::datasource_ptr, and a
datasource has features. One queries a Map's Layer's datasource by asking it
for the features given a mapnik::query, specifying the axis-aligned bounding
box (Envelope).

Mapnik relies heavily on boost shared_ptr and similar classes, with the
convention that _ptr denotes such a pointer.

You can follow along here -- http://gist.github.com/5009#LID76

Note the call to (mapnik::query) q.add_property_name('STATE') on Line 80 --
without these, no properties will be returned! Figured this out by reading
feature_style_processor.hpp.
Line 81 has the feature query call. It would probably be nice to use a
filter_featureset<> object instead, but the filter<> objects don't seem to
expose public typedefs to facilitate declaring the filter_featureset<>
object...

So, we asked the Map's Layer's datasource for a featureset_ptr, and then
iterate through the linked list of features, checking to see which features
pass the previously constructed filter. Unfortunately, the "nil" extent,
that is, a default constructed Envelope<double> isn't really a nil extent,
but rather an Envelope with negative width and negative height. That's okay
but you shouldn't tell such an Envelope to expand_to_include() another
Envelope, as it will do the Wrong Thing.

I was hoping that it would work the other way, but there may or may not be
reasons to design the library this way.

Overall, even though the library is as-of-yet sparsely documented, it seems
to work pretty well even though my XCode compiles crash whereas gcc compiles
don't (ostensibly with the same include, compile, and linking options). The
Python binding has some rough edges, and there are cases where appropriate
public typedefs (in the "traits" spirit) would make figuring out how to type
things somewhat simpler.

~L
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080814/ccbbf32e/attachment.html>

From lwu.two at gmail.com  Sun Aug 17 18:00:04 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Sun, 17 Aug 2008 09:00:04 -0700
Subject: [Mapnik-devel] query zoom example code (cali.cpp) and dev experience
In-Reply-To: <78ec96990808141956n3893ced8we22c8477dc41081b@mail.gmail.com>
References: <78ec96990808141956n3893ced8we22c8477dc41081b@mail.gmail.com>
Message-ID: <78ec96990808170900x17689321g608d1553533beb66@mail.gmail.com>

Hi all,
I thought I'd share my experiences trying to modify Mapnik's (r727)
demo/c++/rundemo.cpp code to render something slightly different.

rundemo.cpp renders a map of Ontario/Quebec, and instead I wanted to draw a
map of California and its surrounding states.

I grabbed the data from the USGS in the form of "statesp020" (google it, or
browse through nationalatlas.gov) and first wanted to modify rundemo.py
instead. Alas, this is uncharted territory, as the Python binding does not
yet support the mapnik::query object (see the near empty
mapnik/bindings/python/mapnik/mapnik_query.cpp).

Instead, I modified demo/c++/rundemo.cpp, and the final result can be viewed
here: http://gist.github.com/5009/

It took some time to get up to speed on Mapnik internals -- the code is
sparsely commented and there doesn't seem to be a canonical Doxygen dump
online (although one can be generated manually from the source). The Mapnik
wiki has some details, and I started to fill in some small gaps there, but
important bits such as what the "res" (second) parameter to the
mapnik::query ctor isn't documented anywhere (elsewhere, some feature
to_string() method seems to return "TODO").

The basic Mapnik data model which isn't directly documented is something
like this. A mapnik Map has Layers, a Layer has a mapnik::datasource_ptr,
and a datasource has features. One queries a Map's Layer's datasource by
asking it for the features given a mapnik::query, specifying the
axis-aligned bounding box (Envelope).

Mapnik relies heavily on boost shared_ptr and similar classes, with the
convention that _ptr denotes such a pointer.

You can follow along here -- http://gist.github.com/5009#LID76

Note the call to (mapnik::query) q.add_property_name('STATE') on Line 80 --
without these, no properties will be returned! Figured this out by reading
feature_style_processor.hpp.
Line 81 has the feature query call. It would probably be nice to use a
filter_featureset<> object instead, but the filter<> objects don't seem to
expose public typedefs to facilitate declaring the filter_featureset<>
object?

So, we asked the Map's Layer's datasource for a featureset_ptr, and then
iterate through the linked list of features, checking to see which features
pass the previously constructed filter. Unfortunately, the "nil" extent,
that is, a default constructed Envelope<double> isn't really a nil extent,
but rather an Envelope with negative width and negative height. That's okay
but you shouldn't tell such an Envelope to expand_to_include() another
Envelope, as it will do the Wrong Thing.

I was hoping that it would work the other way, but there may or may not be
reasons to design the library this way (code simplicity).

Overall, even though the library is as-of-yet sparsely documented, it seems
to work pretty well even though my XCode compiles crash whereas gcc compiles
don't (ostensibly with the same include, compile, and linking options). The
Python binding has some rough edges, and there are cases where appropriate
public typedefs (in the "traits" spirit) would make figuring out how to type
things somewhat simpler.

~L
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080817/66deffa8/attachment.html>

From dom at earth.li  Sun Aug 17 17:51:33 2008
From: dom at earth.li (Dominic Hargreaves)
Date: Sun, 17 Aug 2008 16:51:33 +0100
Subject: [Mapnik-devel] mapnik.org down
In-Reply-To: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
References: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
Message-ID: <20080817155133.GF8999@urchin.earth.li>

On Fri, Aug 15, 2008 at 01:20:08PM -0700, Dane Springmeyer wrote:
> Looks like a mod_python problem...

Seems up to me now.

-- 
Dominic Hargreaves | http://www.larted.org.uk/~dom/
PGP key 5178E2A5 from the.earth.li (keyserver,web,email)


From blake at hailmail.net  Sun Aug 17 18:28:13 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Sun, 17 Aug 2008 09:28:13 -0700
Subject: [Mapnik-devel] [Mapnik-users]  mapnik.org down
In-Reply-To: <20080817155133.GF8999@urchin.earth.li>
References: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
	<20080817155133.GF8999@urchin.earth.li>
Message-ID: <73BB7E38-6FFF-4FE6-B867-B9846D192A58@hailmail.net>

Great, most systems seem to be working now.

On trac however, it appears that the `login/registration` link is  
missing. Anyone know why that might be?

Dane



On Aug 17, 2008, at 8:51 AM, Dominic Hargreaves wrote:

> On Fri, Aug 15, 2008 at 01:20:08PM -0700, Dane Springmeyer wrote:
>> Looks like a mod_python problem...
>
> Seems up to me now.
>
> -- 
> Dominic Hargreaves | http://www.larted.org.uk/~dom/
> PGP key 5178E2A5 from the.earth.li (keyserver,web,email)
> _______________________________________________
> Mapnik-users mailing list
> Mapnik-users at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-users



From blake at hailmail.net  Sun Aug 17 18:32:03 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Sun, 17 Aug 2008 09:32:03 -0700
Subject: [Mapnik-devel] #mapnik on irc.freenode.net
Message-ID: <6A421E61-5175-426B-9BF9-4C210D363171@hailmail.net>

Mapnik-dev,

Having the systems go down reminded me how useful irc can be (for  
those that use it). I was tipped off when things went down by an irc  
user asking about mapnik.org in #osgeo.

Anyway, I've informally started #mapnik on irc.freenode.net, so jump  
in if you are an irc user or wish to me. If there is interest, I'd be  
happy to jump through the formal registration steps too at some point.

Cheers,

Dane




From blake at hailmail.net  Sun Aug 17 19:58:06 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Sun, 17 Aug 2008 10:58:06 -0700
Subject: [Mapnik-devel] Patch for to shape plugin error reporting
Message-ID: <DD1C135F-0611-4C89-9996-91D773C3AD70@hailmail.net>

Attached.

A one line change to make the error reporting more explicit than 'got  
exception ...'

Ideally it would be good to catch a specific exception related to lack  
of read permissions to a datasource ( a common hiccup when configuring  
mapnik wms, tilecache, or other serverside uses), but I'm not aware of  
how to do that with C++.

I could also see value in making the inability to read a datasource a  
fatal error. This of course would really cause havoc for stylesheets  
like osm.xml with many datasources, but maybe a switch could added to  
change the default behavior.


Dane

-------------- next part --------------
A non-text attachment was scrubbed...
Name: shape_plugin.patch
Type: application/octet-stream
Size: 450 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080817/af71865d/attachment.obj>
-------------- next part --------------


From lwu.two at gmail.com  Mon Aug 18 06:56:07 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Sun, 17 Aug 2008 21:56:07 -0700
Subject: [Mapnik-devel] [Mapnik-users] mapnik.org down
In-Reply-To: <73BB7E38-6FFF-4FE6-B867-B9846D192A58@hailmail.net>
References: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
	<20080817155133.GF8999@urchin.earth.li>
	<73BB7E38-6FFF-4FE6-B867-B9846D192A58@hailmail.net>
Message-ID: <78ec96990808172156g17349d3mf60a9c423b902588@mail.gmail.com>

I don't know, but the login link still seems to be broken.
If you manually go to https://trac.mapnik.org/login you'll get "Error: not
found. No handler matched request to /login".

I was just about to start a new "Code Samples / Examples" Wiki node --
examples&samples are a great way to learn or get started, and Mapnik could
use a few more such code bits! (whether Python or C++. or maybe one day
Ruby? I haven't done much Ruby extension development but it's not too bad to
do.)

~L

On Sun, Aug 17, 2008 at 9:28 AM, Dane Springmeyer <blake at hailmail.net>wrote:

> Great, most systems seem to be working now.
>
> On trac however, it appears that the `login/registration` link is
> missing. Anyone know why that might be?
>
> Dane
>
>
>
> On Aug 17, 2008, at 8:51 AM, Dominic Hargreaves wrote:
>
> > On Fri, Aug 15, 2008 at 01:20:08PM -0700, Dane Springmeyer wrote:
> >> Looks like a mod_python problem...
> >
> > Seems up to me now.
> >
> > --
> > Dominic Hargreaves | http://www.larted.org.uk/~dom/
> > PGP key 5178E2A5 from the.earth.li (keyserver,web,email)
> > _______________________________________________
> > Mapnik-users mailing list
> > Mapnik-users at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/mapnik-users
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080817/701419e3/attachment.html>

From brianp at occinc.com  Mon Aug 18 20:02:03 2008
From: brianp at occinc.com (Brian Peschel)
Date: Mon, 18 Aug 2008 13:02:03 -0500
Subject: [Mapnik-devel] Boost 1.35/1.36 problem
In-Reply-To: <mailman.133.1219053725.29668.mapnik-devel@lists.berlios.de>
References: <mailman.133.1219053725.29668.mapnik-devel@lists.berlios.de>
Message-ID: <48A9B91B.2080404@occinc.com>

I have a bunch of code I have written (C++) using boost 1.34.1 (fedora 
8). This is for real time image generation. The concern is that render 
time is too long when alot of features are being drawn. I thought maybe 
a newer version of boost might help the problem so I installled the 
(just released) version of 1.36.0. I also tried 1.35.0. Neither version 
will compile my code. I get this error:

/usr/local/include/boost-1_36/boost/property_map.hpp:503: error: 
expected nested-name-specifier before ?unsigned?
/usr/local/include/boost-1_36/boost/property_map.hpp:506: error: 
type/value mismatch at argument 1 in template parameter list for 
?template<long unsigned int <anonymous>, class ValueType> class 
boost::ref_property_map?
/usr/local/include/boost-1_36/boost/property_map.hpp:506: error: 
expected a constant of type ?long unsigned int?, got ?long unsigned int?
/usr/local/include/boost-1_36/boost/property_map.hpp:506: error: 
template argument 2 is invalid

It doesn't matter which if my files I compile. If I include a mapnik 
header file I get this error. Like I said, this wasn't there under 
1.34.1, so I assume something changed in boost between 1.34 and 1.35.

Anyone seen a similar problem? Any idea how to fix it? Any other ideas 
how to speed up the render time?

- Brian


From blake at hailmail.net  Tue Aug 19 18:24:58 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Tue, 19 Aug 2008 09:24:58 -0700
Subject: [Mapnik-devel] (resolved) Undefined symbols  / pycairo
In-Reply-To: <B7DBE911-CC64-4EAE-8238-0CC09F39C2DE@hailmail.net>
References: <364d303b0803091040k12b5283fxdd34aea8fabcc655@mail.gmail.com>
	<25f9787d4f.tom@loxley.compton.nu>
	<364d303b0803091114u52a72a10h1f0df8c3406c79cd@mail.gmail.com>
	<4d5a7e7d4f.tom@loxley.compton.nu>
	<CF7AD335-A8D0-4CE3-86E4-C8A7B5734B05@hailmail.net>
	<450724F5-AB50-4917-8C1E-D2B8EFF53D9B@mapnik.org>
	<0FAAE6C5-18D0-4D5F-82FE-66A3D288662C@hailmail.net>
	<265D1811-74B0-4F43-8B97-1D694B45C8B5@hailmail.net>
	<88a6027f4f.tom@loxley.compton.nu>
	<B7DBE911-CC64-4EAE-8238-0CC09F39C2DE@hailmail.net>
Message-ID: <05E31C50-C165-4A54-9E8D-ABCBD1118BF5@hailmail.net>

A followup,

I've been using the cairo functionality successfully for a while on  
Mac OS 10.5.

Thanks to Tom for his work to include this in Mapnik core. The SVG and  
PDF output look great.

Ultimately, installing cairo, cairomm, and py-cairo with macports did  
the trick.

$ sudo port install cairo cairomm py-cairo # then rebuild mapnik from  
svn trunk


Dane



On Mar 12, 2008, at 10:54 AM, Dane Springmeyer wrote:

> Hi Tom,
>
> Sorry I meant macports (not boost). I'm currently working on
> installing the dependencies for cairo... I'll check back in if I
> succeed.
>
> Dane
>
>
> On Mar 12, 2008, at 10:49 AM, Tom Hughes wrote:
>
>> In message <265D1811-74B0-4F43-8B97-1D694B45C8B5 at hailmail.net>
>>         Dane Springmeyer <blake at hailmail.net> wrote:
>>
>>> Actually, Artem I have cairomm installed from boost, which should be
>>> the c++ wrappers.
>>
>> Boost is nothing to do with cairomm (or even pycairo).
>>
>> Tom
>>
>> -- 
>> Tom Hughes (tom at compton.nu)
>> http://www.compton.nu/
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From blake at hailmail.net  Tue Aug 19 18:34:48 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Tue, 19 Aug 2008 09:34:48 -0700
Subject: [Mapnik-devel] GeoDjango Datasource for Mapnik
In-Reply-To: <47F7B412.9090309@gmail.com>
References: <b3b5e5690804011254u7337449bu2a66485ba8c9be40@mail.gmail.com>	<a4c775140804020330h1a71e184rbdef94180762d77b@mail.gmail.com>	<b3b5e5690804020808s17b9c826i30daeb31661ab9d3@mail.gmail.com>
	<FB4C5F71-C0CB-4991-A718-748D4D330777@hailmail.net>
	<47F7B412.9090309@gmail.com>
Message-ID: <E26AA8AB-3B60-44E5-867F-6E61DCF31F71@hailmail.net>

Justin,

Sorry to have never followed-up on your response here.

Since this original thread I understand much more about how GeoDjango  
works, and I agree with you that there are huge possiblities for  
interfacing with mapnik from the GeoDjango side of things.

I've begun several experiments along these lines and I'll post to  
mapnik-users and the #geodjango room on irc.freenode.net once they are  
a little farther along.

I think the core of my interest on the mapnik side lies with this  
memory::datasource topic and the ability to instantiate datasources  
with the python bindings in-memory or on-the-fly.

GeoDjango thrives at working with geometries through your GEOS  
Geometries and an incredible mapping synergy would exist if these  
could be passed directly to Mapnik to be rendered on the same surface  
with layers built from a postgis datasource.

And perhaps, based on Leslie's excellent digging into  
memory::datasource, this will prove not far from reach from the python  
bindings.

Cheers,

Dane


On Apr 5, 2008, at 10:17 AM, Justin Bronn wrote:

> Dane & Mapnik Developers:
>
>> I've been using geodjango lately and am very excited about the
>> possibilities of the project. I'm curious about the potential/ 
>> interest
>> for a django datasource in Mapnik. Have any mapnik users/devs given
>> thought to this?
>
> As lead developer of GeoDjango, this is something that I definitely  
> have
> interest in.  However, rather than coding a a "GeoDjango" datasource  
> and
> including it in Mapnik, I think the better route would be to create
> utility routines/classes in GeoDjango that interface with the Mapnik
> Python API.  Using configuration information from Django's  
> `settings.py`
> (as you did in your example), and geographic model metadata it's
> entirely possible to feed the right information into the Mapnik's
> existing API (e.g., instantiating the existing `PostGIS` Mapnik data
> source with the right info).  Only if we run into problems interfacing
> with the Mapnik API on our end, should we then request reasonable
> additions/modifications.
>
> There are many exciting combinations of Mapnik + GeoDjango I can  
> think of :)
>
>> Integration of Mapnik as WMS into geodjango is something that should/
>> will likely happen on the django side, of course.
>
> I like the idea of having GeoDjango WMS views powered by Mapnik.   
> What's
> prevented me thus far from implementing them is a license conflict --
> GeoDjango is BSD and the `ogcserver` Mapnik Python components are
> licensed under the LGPL.  Would the Mapnik developers consider
> relicensing _only_ portions of the `ogcserver` Python code to BSD so I
> may modify and include it GeoDjango?  More specifically, I'm  
> interested
> in `wms111.py`, `wms130.py`, and `common.py`.
>
> Best Regards,
> -Justin
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From blake at hailmail.net  Tue Aug 19 19:00:19 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Tue, 19 Aug 2008 10:00:19 -0700
Subject: [Mapnik-devel] [Mapnik-users] mapnik.org down
In-Reply-To: <78ec96990808172156g17349d3mf60a9c423b902588@mail.gmail.com>
References: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
	<20080817155133.GF8999@urchin.earth.li>
	<73BB7E38-6FFF-4FE6-B867-B9846D192A58@hailmail.net>
	<78ec96990808172156g17349d3mf60a9c423b902588@mail.gmail.com>
Message-ID: <8C78DB84-68F6-4AC9-8CA9-445390B7DBE7@hailmail.net>

I'm glad to see that the login is now working (thanks!).

Only other issue I see is that something minor has been lost with the  
trac formatting.  I remember a blue header color that is now missing.

Obviously a small issue, but perhaps there are other lurking issues  
that might be involved.

Dane


On Aug 17, 2008, at 9:56 PM, Leslie Wu wrote:

> I don't know, but the login link still seems to be broken.
>
> If you manually go to https://trac.mapnik.org/login you'll get  
> "Error: not found. No handler matched request to /login".
>
> I was just about to start a new "Code Samples / Examples" Wiki node  
> -- examples&samples are a great way to learn or get started, and  
> Mapnik could use a few more such code bits! (whether Python or C++.  
> or maybe one day Ruby? I haven't done much Ruby extension  
> development but it's not too bad to do.)
>
> ~L
>
> On Sun, Aug 17, 2008 at 9:28 AM, Dane Springmeyer  
> <blake at hailmail.net> wrote:
> Great, most systems seem to be working now.
>
> On trac however, it appears that the `login/registration` link is
> missing. Anyone know why that might be?
>
> Dane
>
>
>
> On Aug 17, 2008, at 8:51 AM, Dominic Hargreaves wrote:
>
> > On Fri, Aug 15, 2008 at 01:20:08PM -0700, Dane Springmeyer wrote:
> >> Looks like a mod_python problem...
> >
> > Seems up to me now.
> >
> > --
> > Dominic Hargreaves | http://www.larted.org.uk/~dom/
> > PGP key 5178E2A5 from the.earth.li (keyserver,web,email)
> > _______________________________________________
> > Mapnik-users mailing list
> > Mapnik-users at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/mapnik-users
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080819/cd3139fc/attachment.html>

From mapnik at randomjunk.co.uk  Thu Aug 21 14:57:47 2008
From: mapnik at randomjunk.co.uk (Dave Stubbs)
Date: Thu, 21 Aug 2008 13:57:47 +0100
Subject: [Mapnik-devel] Layer intersection bug (patch attached)
Message-ID: <a4c775140808210557y2b8db80cn628a08dac42c0e66@mail.gmail.com>

Hi,

When Mapnik is processing layers, it tries to clip the map bbox to the
layer extent... unfortunately it doesn't test for intersection first,
so the "clipped" bbox is completely bogus. The layer is then asked for
features for this bbox, and if you have a lot of small raster layers
then this has a big performance impact.

I've attached a patch that fixes this, and also returns something
slightly more sensible from Envelope.intersects in the same situation.

(I'd have stuck this in trac, but I don't have a login)

Dave
-------------- next part --------------
A non-text attachment was scrubbed...
Name: intersection.diff
Type: text/x-diff
Size: 1642 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080821/f40c89a4/attachment.diff>

From blake at hailmail.net  Thu Aug 21 18:15:48 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Thu, 21 Aug 2008 09:15:48 -0700
Subject: [Mapnik-devel] Trac register link missing
In-Reply-To: <8C78DB84-68F6-4AC9-8CA9-445390B7DBE7@hailmail.net>
References: <0D2073C3-A37D-49B4-B6C8-17B5999EB10E@hailmail.net>
	<20080817155133.GF8999@urchin.earth.li>
	<73BB7E38-6FFF-4FE6-B867-B9846D192A58@hailmail.net>
	<78ec96990808172156g17349d3mf60a9c423b902588@mail.gmail.com>
	<8C78DB84-68F6-4AC9-8CA9-445390B7DBE7@hailmail.net>
Message-ID: <EF4B4A26-9248-4A8F-BCDC-F509657BBB42@hailmail.net>

Seems to be another issue with trac registration.

should the url be /register?


Dane


On Aug 19, 2008, at 10:00 AM, Dane Springmeyer wrote:

> I'm glad to see that the login is now working (thanks!).
>
> Only other issue I see is that something minor has been lost with  
> the trac formatting.  I remember a blue header color that is now  
> missing.
>
> Obviously a small issue, but perhaps there are other lurking issues  
> that might be involved.
>
> Dane
>
>
> On Aug 17, 2008, at 9:56 PM, Leslie Wu wrote:
>
>> I don't know, but the login link still seems to be broken.
>>
>> If you manually go to https://trac.mapnik.org/login you'll get  
>> "Error: not found. No handler matched request to /login".
>>
>> I was just about to start a new "Code Samples / Examples" Wiki node  
>> -- examples&samples are a great way to learn or get started, and  
>> Mapnik could use a few more such code bits! (whether Python or C++.  
>> or maybe one day Ruby? I haven't done much Ruby extension  
>> development but it's not too bad to do.)
>>
>> ~L
>>
>> On Sun, Aug 17, 2008 at 9:28 AM, Dane Springmeyer  
>> <blake at hailmail.net> wrote:
>> Great, most systems seem to be working now.
>>
>> On trac however, it appears that the `login/registration` link is
>> missing. Anyone know why that might be?
>>
>> Dane
>>
>>
>>
>> On Aug 17, 2008, at 8:51 AM, Dominic Hargreaves wrote:
>>
>> > On Fri, Aug 15, 2008 at 01:20:08PM -0700, Dane Springmeyer wrote:
>> >> Looks like a mod_python problem...
>> >
>> > Seems up to me now.
>> >
>> > --
>> > Dominic Hargreaves | http://www.larted.org.uk/~dom/
>> > PGP key 5178E2A5 from the.earth.li (keyserver,web,email)
>> > _______________________________________________
>> > Mapnik-users mailing list
>> > Mapnik-users at lists.berlios.de
>> > https://lists.berlios.de/mailman/listinfo/mapnik-users
>>
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080821/b411e49e/attachment.html>

From lwu.two at gmail.com  Fri Aug 22 07:16:07 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Thu, 21 Aug 2008 22:16:07 -0700
Subject: [Mapnik-devel] Mapnik Trac dev wiki updates
Message-ID: <78ec96990808212216h29b31301jdeb9094e58df4473@mail.gmail.com>

Hi all,
As I get up to speed with Mapnik, as a user and a developer, I have been
fixing up and adding text to the Mapnik wiki.

The Trac timeline has all the specific edits (
http://trac.mapnik.org/timeline) but the main new additions relevant to
mapnik-devel@ are:

http://trac.mapnik.org/wiki/ExampleCode -- please add your code snippets!
New developers often look to code examples to learn from and modify.

http://trac.mapnik.org/wiki/PluginArchitecture
http://trac.mapnik.org/wiki/PostGIS and

the overview pages http://trac.mapnik.org/wiki/MapDesign and
http://trac.mapnik.org/wiki/MapnikOverview

Best,

~L
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080821/25c68271/attachment.html>

From mateusz at loskot.net  Sat Aug 23 21:32:00 2008
From: mateusz at loskot.net (Mateusz Loskot)
Date: Sat, 23 Aug 2008 21:32:00 +0200
Subject: [Mapnik-devel] Building with Boost 1.33
Message-ID: <48B065B0.3080104@loskot.net>

Folks,

Let me please to say Hello! for the first time here.

I'm trying to build and debug Mapnik under Linux (Ubuntu 7.04) with 
Boost 1.33 (all Boost packages installed). Unfortunately scons does not 
find Boost components.

Does it mean Boost 1.33 is not supported?

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
Charter Member of OSGeo, http://osgeo.org


From lwu.two at gmail.com  Sun Aug 24 00:55:57 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Sat, 23 Aug 2008 15:55:57 -0700
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B065B0.3080104@loskot.net>
References: <48B065B0.3080104@loskot.net>
Message-ID: <78ec96990808231555l3b6dfc07u3fd4ca630bfc0f43@mail.gmail.com>

I don't know, but as a point of reference,   $ sudo aptitude show
libboost-dev
shows I'm running "Version: 1.34.1-4ubuntu3" on Hardy Heron, and
  $ port info boost
shows I'm running boost 1.35.0 on OS X Leopard.

Have you checked the SConstruct file to make sure the BOOST_INCLUDES and
BOOST_LIBS are pointing to the right place? When you run "gcc
-lboost_thread-mt" do you get "undefined reference to 'main'" (good) or
"cannot find -lboost_thread-mx" (bad)?

~L


On Sat, Aug 23, 2008 at 12:32 PM, Mateusz Loskot <mateusz at loskot.net> wrote:

> Folks,
>
> Let me please to say Hello! for the first time here.
>
> I'm trying to build and debug Mapnik under Linux (Ubuntu 7.04) with
> Boost 1.33 (all Boost packages installed). Unfortunately scons does not
> find Boost components.
>
> Does it mean Boost 1.33 is not supported?
>
> Best regards,
> --
> Mateusz Loskot, http://mateusz.loskot.net
> Charter Member of OSGeo, http://osgeo.org
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080823/879675b9/attachment.html>

From jbronn at gmail.com  Mon Aug 25 03:33:54 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Sun, 24 Aug 2008 20:33:54 -0500
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B065B0.3080104@loskot.net>
References: <48B065B0.3080104@loskot.net>
Message-ID: <48B20C02.2080203@gmail.com>

Mateusz,

 > Let me please to say Hello! for the first time here.
 >
 > I'm trying to build and debug Mapnik under Linux (Ubuntu 7.04) with
 > Boost 1.33 (all Boost packages installed). Unfortunately scons
 > not find Boost components.
 >
 > Does it mean Boost 1.33 is not supported?

Welcome --  there are problems in the way Mapnik's scons script 
constructs the boost library name.  I've already created a patch that 
addresses theses issues in ticket #90.  After applying my patch I was 
successfully able to build and run the python demo on 7.04 using boost 
installed from apt and mapnik from svn (r729):

$ patch -p0 < boost_append_osx_patch_v2.diff
$ python scons/scons.py BOOST_TOOLKIT=gcc BOOST_VERSION=1_33_1


The patch and ticket are at:
http://trac.mapnik.org/ticket/90

Regards,
-Justin


From mateusz at loskot.net  Mon Aug 25 14:29:03 2008
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 25 Aug 2008 14:29:03 +0200
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B20C02.2080203@gmail.com>
References: <48B065B0.3080104@loskot.net> <48B20C02.2080203@gmail.com>
Message-ID: <48B2A58F.3000402@loskot.net>

Justin Bronn wrote:
> Mateusz,
>> Let me please to say Hello! for the first time here.
>>
>> I'm trying to build and debug Mapnik under Linux (Ubuntu 7.04) with
>> Boost 1.33 (all Boost packages installed). Unfortunately scons
>> not find Boost components.
>>
>> Does it mean Boost 1.33 is not supported?
> 
> Welcome --  there are problems in the way Mapnik's scons script 
> constructs the boost library name.  I've already created a patch that 
> addresses theses issues in ticket #90.  After applying my patch I was 
> successfully able to build and run the python demo on 7.04 using boost 
> installed from apt and mapnik from svn (r729):
> 
> $ patch -p0 < boost_append_osx_patch_v2.diff
> $ python scons/scons.py BOOST_TOOLKIT=gcc BOOST_VERSION=1_33_1

Hi Justin,

I've tried your patch but it doesn't work for me:

mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ svn info | grep Rev
Revision: 729

mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ patch -p0 <
boost_append_osx_patch_v2.diff

mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ svn st
M      plugins/input/shape/SConscript
M      plugins/input/postgis/SConscript
M      bindings/python/SConscript
M      utils/shapeindex/SConscript
M      SConstruct

mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ python scons/scons.py
DEBUG=y GDAL_INCLUDES=/usr/include GDAL_LIBS=/usr/lib XMLPARSER=libxml2
BOOST_TOOLKIT=gcc BOOST_VERSION=1_33_1

scons: Reading SConscript files ...
Building on Linux ...
pkg-config --exists cairomm-1.0
Checking for C library m... yes
Checking for C library ltdl... yes
Checking for C library png... yes
Checking for C library tiff... yes
Checking for C library z... yes
Checking for C library jpeg... yes
Checking for C library proj... yes
Checking for C library pq... no
Checking for C++ library icuuc... yes
Checking for C++ library icudata... yes
Checking for C++ library gdal... no
Checking for C++ library boost_system-gcc-mt-1_33_1... no
Checking for C++ library boost_filesystem-gcc-mt-1_33_1... no
Could not find header or shared library for boost filesystem, exiting!
mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$


It looks like boost_system is not even available in Ubuntu 7.04
packages of Boost 1.33.1

http://packages.ubuntu.com/search?keywords=libboost&suite=feisty

It tells me that building Mapnik on Ubuntu 7.04 is not supported,
unless users make their own build of Boost (simple task).

> The patch and ticket are at:
> http://trac.mapnik.org/ticket/90

I wanted to submit my notes as ticket comment, but have no idea how to
register and authorize. Is it possible to get Mapnik Trac account?

Best regards
-- 
Mateusz Loskot, http://mateusz.loskot.net
Charter Member of OSGeo, http://osgeo.org


From jbronn at gmail.com  Mon Aug 25 15:54:13 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Mon, 25 Aug 2008 08:54:13 -0500
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B2A58F.3000402@loskot.net>
References: <48B065B0.3080104@loskot.net> <48B20C02.2080203@gmail.com>
	<48B2A58F.3000402@loskot.net>
Message-ID: <48B2B985.7070002@gmail.com>

> It looks like boost_system is not even available in Ubuntu 7.04
> packages of Boost 1.33.1
> 
> http://packages.ubuntu.com/search?keywords=libboost&suite=feisty
> 
> It tells me that building Mapnik on Ubuntu 7.04 is not supported,
> unless users make their own build of Boost (simple task).

The `boost_system` library is only required for Boost versions > 1.35 
(as noted in the INSTALL file).  Did you install the dev packages so 
boost headers were included?  Here's how I installed boost:

$ sudo apt-get install libboost-thread-dev libboost-filesystem-dev 
libboost-regex-dev libboost-iostreams-dev libboost-program-options-dev 
libboost-python-dev

I'm pretty sure it's supported -- I created an Ubuntu 7.04 VM to test 
and was able to build and run the demo OK.

> I wanted to submit my notes as ticket comment, but have no idea how to
> register and authorize. Is it possible to get Mapnik Trac account?

I think I registered at http://trac.mapnik.org/register -- but that URL 
doesn't appear to work anymore.

-Justin


From mateusz at loskot.net  Mon Aug 25 17:17:52 2008
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 25 Aug 2008 17:17:52 +0200
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <104A2E3E-2621-43F5-9F8D-3C6A9725C831@hailmail.net>
References: <48B065B0.3080104@loskot.net> <48B20C02.2080203@gmail.com>
	<48B2A58F.3000402@loskot.net>
	<104A2E3E-2621-43F5-9F8D-3C6A9725C831@hailmail.net>
Message-ID: <48B2CD20.4080108@loskot.net>

Dane Springmeyer wrote:
> Mateusz,
> 
> Trac registration is down right now. But I want to help get your ticket 
> filed however we can. You can either send it to me or just post to the 
> list and I'll scoop it up and put it on trac.

Dane,

Understood. I will use the list.

> I've build mapnik on ubuntu 7.04 with libboost from apt-get, and these 
> notes started as ubuntu 7.04 notes.. 
> http://trac.mapnik.org/wiki/UbuntuInstallation

Yes, I'm following this guide.

> I'm traveling today (and stepping out now..) but I should have some time 
> to look at this between flights. Can you send me the output of $ python 
> scons/scons.py -h


mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ svn up
At revision 729.

mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$ python scons/scons.py -h
scons: Reading SConscript files ...
Building on Linux ...
pkg-config --exists cairomm-1.0
Checking for C library m... yes
Checking for C library ltdl... yes
Checking for C library png... yes
Checking for C library tiff... yes
Checking for C library z... yes
Checking for C library jpeg... yes
Checking for C library proj... yes
Checking for C library pq... no
Checking for C++ library icuuc... yes
Checking for C++ library icudata... yes
Checking for C++ library gdal... no
Checking for C++ library boost_system-mt... no
Checking for C++ library boost_filesystem-mt... no
Could not find header or shared library for boost filesystem, exiting!
mloskot at vm-ubuntu704:~/dev/mapnik/_svn/trunk$


> and let me know what the output looks like of $ ls /usr/lib/libboost* -l
> or wherever your local installation of boost is...

I've installed all libboost* and boost related packages from the Ubuntu 
7.04 repository. I use Boost in my own projects and it works well for 
me, however I configure my projects with Autotools, CMake or Boost BUild 
and have Zero experience with SCons.

Here is the output you've requested


$ ls -1 /usr/lib/libboost* | sort
/usr/lib/libboost_date_time.a
/usr/lib/libboost_date_time-gcc-1_33_1.a
/usr/lib/libboost_date_time-gcc-1_33_1.so
/usr/lib/libboost_date_time-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_date_time-gcc-mt-1_33_1.a
/usr/lib/libboost_date_time-gcc-mt-1_33_1.so
/usr/lib/libboost_date_time-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_date_time.so
/usr/lib/libboost_filesystem.a
/usr/lib/libboost_filesystem-gcc-1_33_1.a
/usr/lib/libboost_filesystem-gcc-1_33_1.so
/usr/lib/libboost_filesystem-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_filesystem-gcc-mt-1_33_1.a
/usr/lib/libboost_filesystem-gcc-mt-1_33_1.so
/usr/lib/libboost_filesystem-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_filesystem.so
/usr/lib/libboost_iostreams-gcc-mt-1_33_1.so
/usr/lib/libboost_iostreams-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_iostreams.so
/usr/lib/libboost_prg_exec_monitor.a
/usr/lib/libboost_prg_exec_monitor-gcc-1_33_1.a
/usr/lib/libboost_prg_exec_monitor-gcc-1_33_1.so
/usr/lib/libboost_prg_exec_monitor-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_prg_exec_monitor-gcc-mt-1_33_1.a
/usr/lib/libboost_prg_exec_monitor-gcc-mt-1_33_1.so
/usr/lib/libboost_prg_exec_monitor-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_prg_exec_monitor.so
/usr/lib/libboost_program_options.a
/usr/lib/libboost_program_options-gcc-1_33_1.a
/usr/lib/libboost_program_options-gcc-1_33_1.so
/usr/lib/libboost_program_options-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_program_options-gcc-mt-1_33_1.a
/usr/lib/libboost_program_options-gcc-mt-1_33_1.so
/usr/lib/libboost_program_options-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_program_options.so
/usr/lib/libboost_python-gcc-1_33_1.so
/usr/lib/libboost_python-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_python-gcc-mt-1_33_1.so
/usr/lib/libboost_python-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_python.so
/usr/lib/libboost_regex.a
/usr/lib/libboost_regex-gcc-1_33_1.a
/usr/lib/libboost_regex-gcc-1_33_1.so
/usr/lib/libboost_regex-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_regex-gcc-mt-1_33_1.a
/usr/lib/libboost_regex-gcc-mt-1_33_1.so
/usr/lib/libboost_regex-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_regex.so
/usr/lib/libboost_serialization.a
/usr/lib/libboost_serialization-gcc-1_33_1.a
/usr/lib/libboost_serialization-gcc-mt-1_33_1.a
/usr/lib/libboost_signals.a
/usr/lib/libboost_signals-gcc-1_33_1.a
/usr/lib/libboost_signals-gcc-1_33_1.so
/usr/lib/libboost_signals-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_signals-gcc-mt-1_33_1.a
/usr/lib/libboost_signals-gcc-mt-1_33_1.so
/usr/lib/libboost_signals-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_signals.so
/usr/lib/libboost_test_exec_monitor.a
/usr/lib/libboost_test_exec_monitor-gcc-1_33_1.a
/usr/lib/libboost_test_exec_monitor-gcc-1_33_1.so
/usr/lib/libboost_test_exec_monitor-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_test_exec_monitor-gcc-mt-1_33_1.a
/usr/lib/libboost_test_exec_monitor-gcc-mt-1_33_1.so
/usr/lib/libboost_test_exec_monitor-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_test_exec_monitor.so
/usr/lib/libboost_thread.a
/usr/lib/libboost_thread-gcc-mt-1_33_1.a
/usr/lib/libboost_thread-gcc-mt-1_33_1.so
/usr/lib/libboost_thread-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_thread.so
/usr/lib/libboost_unit_test_framework.a
/usr/lib/libboost_unit_test_framework-gcc-1_33_1.a
/usr/lib/libboost_unit_test_framework-gcc-1_33_1.so
/usr/lib/libboost_unit_test_framework-gcc-1_33_1.so.1.33.1
/usr/lib/libboost_unit_test_framework-gcc-mt-1_33_1.a
/usr/lib/libboost_unit_test_framework-gcc-mt-1_33_1.so
/usr/lib/libboost_unit_test_framework-gcc-mt-1_33_1.so.1.33.1
/usr/lib/libboost_unit_test_framework.so
/usr/lib/libboost_wave.a
/usr/lib/libboost_wave-gcc-mt-1_33_1.a
/usr/lib/libboost_wserialization.a
/usr/lib/libboost_wserialization-gcc-1_33_1.a
/usr/lib/libboost_wserialization-gcc-mt-1_33_1.a


> My hunch is this is a symlinking issue, where mapnik is not finding the 
> boost installs perhaps because you have the 'gcc' extension or related 
> to the mt extension. the OSM mapnik install notes might provide some 
> ideas for fixing symlinks 
> (http://wiki.openstreetmap.org/index.php/Mapnik). And I'd love to look 
> at this in more detail later today.


I'd love to assist in finding the problem (and solving it).
Thanks!

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
Charter Member of OSGeo, http://osgeo.org


From mateusz at loskot.net  Mon Aug 25 17:56:59 2008
From: mateusz at loskot.net (Mateusz Loskot)
Date: Mon, 25 Aug 2008 17:56:59 +0200
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B2B985.7070002@gmail.com>
References: <48B065B0.3080104@loskot.net>
	<48B20C02.2080203@gmail.com>	<48B2A58F.3000402@loskot.net>
	<48B2B985.7070002@gmail.com>
Message-ID: <48B2D64B.4000902@loskot.net>

Justin Bronn wrote:
>> It looks like boost_system is not even available in Ubuntu 7.04
>> packages of Boost 1.33.1
>>
>> http://packages.ubuntu.com/search?keywords=libboost&suite=feisty
>>
>> It tells me that building Mapnik on Ubuntu 7.04 is not supported,
>> unless users make their own build of Boost (simple task).
> 
> The `boost_system` library is only required for Boost versions > 1.35 
> (as noted in the INSTALL file).  Did you install the dev packages so 
> boost headers were included?  Here's how I installed boost:
> 
> $ sudo apt-get install libboost-thread-dev libboost-filesystem-dev 
> libboost-regex-dev libboost-iostreams-dev libboost-program-options-dev 
> libboost-python-dev


Justin,

Yes, I have installed all Boost packages available for Ubuntu 7.04

> I'm pretty sure it's supported -- I created an Ubuntu 7.04 VM to test 
> and was able to build and run the demo OK.

The libboost_system looks strange to me. There is no such
package for U7.04.

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
Charter Member of OSGeo, http://osgeo.org


From jbronn at gmail.com  Mon Aug 25 20:02:22 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Mon, 25 Aug 2008 13:02:22 -0500
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B2D64B.4000902@loskot.net>
References: <48B065B0.3080104@loskot.net>
	<48B20C02.2080203@gmail.com>	<48B2A58F.3000402@loskot.net>
	<48B2B985.7070002@gmail.com> <48B2D64B.4000902@loskot.net>
Message-ID: <48B2F3AE.2050609@gmail.com>

Mateusz Loskot wrote:
> Justin,

> The libboost_system looks strange to me. There is no such
> package for U7.04.
> 
That's because boost_system is only a part of Boost 1.35 and above. [1] 
It's only required to compile Mapnik by certain platforms (Darwin/OSX) 
and my patch makes it optional again except for the systems that truly 
require it.

Are you running on an x86-64 system?  That's the only thing I can think 
of that changes the default locations, maybe explaining why it's working 
on my VM and not on your install.  Thus, you may need to be more 
explicit in the compile flags to specify the exact Boost locations then 
(assuming the v2 patch from #90 is applied):

$ python scons/scons.py \
   BOOST_TOOLKIT=gcc BOOST_VERSION=1_33_1 \
   BOOST_LIBS=/usr/lib BOOST_INCLUDES=/usr/include

If you're still having trouble, then we'll have to go more in depth and 
examine the way SCons is detecting the library, and try to reproduce why 
it's compilation command is failing.  SCons tests using a C++ stub like so:

#include "boost/filesystem/operations.hpp"

int
main() {

return 0;
}

-Justin

[1] http://lists.berlios.de/pipermail/mapnik-devel/2008-July/000655.html


From mateusz at loskot.net  Tue Aug 26 13:59:15 2008
From: mateusz at loskot.net (Mateusz Loskot)
Date: Tue, 26 Aug 2008 13:59:15 +0200
Subject: [Mapnik-devel] Building with Boost 1.33
In-Reply-To: <48B2F3AE.2050609@gmail.com>
References: <48B065B0.3080104@loskot.net>	<48B20C02.2080203@gmail.com>	<48B2A58F.3000402@loskot.net>	<48B2B985.7070002@gmail.com>
	<48B2D64B.4000902@loskot.net> <48B2F3AE.2050609@gmail.com>
Message-ID: <48B3F013.2090305@loskot.net>

Justin Bronn wrote:
> Mateusz Loskot wrote:
>> Justin,
> 
>> The libboost_system looks strange to me. There is no such
>> package for U7.04.
>>
> That's because boost_system is only a part of Boost 1.35 and above. [1] 
> It's only required to compile Mapnik by certain platforms (Darwin/OSX) 
> and my patch makes it optional again except for the systems that truly 
> require it.

Justin,

Understood.

BTW, Yesterday Dane suggested to fix symlinks for Boost libs:

sudo ln -s /usr/lib/libboost_filesystem.a /usr/lib/libboost_filesystem-mt.a
sudo ln -s /usr/lib/libboost_filesystem.so 
/usr/lib/libboost_filesystem-mt.so

and as I write below, it is required to fix Boost detection under Ubuntu 
7.04.

> Are you running on an x86-64 system?

Nope, I use x86-32 of Ubuntu 7.04 under Parallels VM.

> That's the only thing I can think 
> of that changes the default locations, maybe explaining why it's working 
> on my VM and not on your install.  Thus, you may need to be more 
> explicit in the compile flags to specify the exact Boost locations then 
> (assuming the v2 patch from #90 is applied):
> 
> $ python scons/scons.py \
>    BOOST_TOOLKIT=gcc BOOST_VERSION=1_33_1 \
>    BOOST_LIBS=/usr/lib BOOST_INCLUDES=/usr/include

I have tried all these flags, without success.

> If you're still having trouble, then we'll have to go more in depth and 
> examine the way SCons is detecting the library, and try to reproduce why 
> it's compilation command is failing.

Yes, and I've digged it (see below).

> SCons tests using a C++ stub like so:
> 
> #include "boost/filesystem/operations.hpp"
> 
> int
> main() {
> 
> return 0;
> }

And compiling this test (as fstest.cpp) answered where is the problem, 
at least partially:

$ g++ -Wall -pedantic fstest.cpp
/usr/include/pthread.h:285: error: conflicting declaration ?typedef 
struct pthread_st* pthread_t?
/usr/include/bits/pthreadtypes.h:36: error: ?pthread_t? has a previous 
declaration as ?typedef long unsigned int pthread_t?
...

I've found that this error is caused by conflict/broken
packages (see [1] and [2]).

[1] http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=410692
[2] http://tinyurl.com/libpthread-bugs


I uninstalled libpthread* stuff and now scons.py for Mapnik goes a few 
steps further:

$ python scons/scons.py DEBUG=y GDAL_INCLUDES=/usr/include 
GDAL_LIBS=/usr/lib XMLPARSER=libxml2 BOOST_VERSION=1_33_1 BOOST_TOOLSET=gcc

scons: Reading SConscript files ...
Building on Linux ...
pkg-config --exists cairomm-1.0
Checking for C library m... yes
Checking for C library ltdl... yes
Checking for C library png... yes
Checking for C library tiff... yes
Checking for C library z... yes
Checking for C library jpeg... yes
Checking for C library proj... yes
Checking for C library pq... no
Checking for C++ library icuuc... yes
Checking for C++ library icudata... yes
Checking for C++ library gdal... no
Checking for C++ library boost_system-mt... no
Checking for C++ library boost_filesystem-mt... yes
Checking for C++ library boost_regex-mt... no
Could not find header or shared library for boost regex, exiting!
$

As I mentioned, I fixed symlinks to filesystem libraries.
So, the report above says now that filesystem has been detected,
but not regex though I have *all* Boost packages installed on my U7.04.

OK, apparently another symlinks have to be fixed:

sudo ln -s /usr/lib/libboost_regex.a /usr/lib/libboost_regex-mt.a
sudo ln -s /usr/lib/libboost_regex.so /usr/lib/libboost_regex-mt.so

### NOTE: Only link to .so required ###
sudo ln -s /usr/lib/libboost_iostreams.so /usr/lib/libboost_iostreams-mt.so

sudo ln -s /usr/lib/libboost_program_options.a 
/usr/lib/libboost_program_options-mt.a
sudo ln -s /usr/lib/libboost_program_options.so 
/usr/lib/libboost_program_options-mt.so

sudo ln -s /usr/lib/libboost_thread.a /usr/lib/libboost_thread-mt.a
sudo ln -s /usr/lib/libboost_thread.so /usr/lib/libboost_thread-mt.so


After these fixes, scons.py outputs this:

$ python scons/scons.py DEBUG=y GDAL_INCLUDES=/usr/include 
GDAL_LIBS=/usr/lib XMLPARSER=libxml2 BOOST_VERSION=1_33_1 BOOST_TOOLSET=gcc
scons: Reading SConscript files ...
Building on Linux ...
pkg-config --exists cairomm-1.0
Checking for C library m... yes
Checking for C library ltdl... yes
Checking for C library png... yes
Checking for C library tiff... yes
Checking for C library z... yes
Checking for C library jpeg... yes
Checking for C library proj... yes
Checking for C library pq... no
Checking for C++ library icuuc... yes
Checking for C++ library icudata... yes
Checking for C++ library gdal... no
Checking for C++ library boost_system-mt... no
Checking for C++ library boost_filesystem-mt... yes
Checking for C++ library boost_regex-mt... yes
Checking for C++ library boost_iostreams-mt... yes
Checking for C++ library boost_program_options-mt... yes
Checking for C++ library boost_thread-mt... yes
Bindings Python version... 2.5
Python 2.5 prefix... /usr
pkg-config --exists pycairo
scons: done reading SConscript files.
scons: Building targets ...
...
scons: done building targets.


One note, it seems that scons.py does not check for libboost_python, so 
compilation configured as above stopped with linker error:

/usr/bin/ld: cannot find -lboost_python-mt

Fixing yet another symlink solves the problem:

sudo ln -s /usr/lib/libboost_python.so /usr/lib/libboost_python-mt.so


I have no tried to run Mapnik in any way yet, just tested it configures 
and builds without errors. Later on, I will test it in run-time and 
report if my build works or not :-)

Thanks all for your help!

Best regards,
-- 
Mateusz Loskot, http://mateusz.loskot.net
Charter Member of OSGeo, http://osgeo.org


From gelosi at gmail.com  Thu Aug 28 16:10:08 2008
From: gelosi at gmail.com (Oleg Shaniuk)
Date: Thu, 28 Aug 2008 17:10:08 +0300
Subject: [Mapnik-devel] Mapnik's WMS use
Message-ID: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>

Hi All,

I'm playing with mapnik's WMS features. And I'm getting empty image in
browser. The interesting thing, if I use the same style and layer, but
with Map object and render image in python script - it works correct.

Fot the request:
http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300

I'm getting empty white picture 600x300pix.

using mapnik 5.1.0

My scripts/config:

######## wms python script for fcgi #########
#!/usr/bin/python

from mapnik.ogcserver.cgiserver import Handler
import jon.fcgi as fcgi

import sys
sys.path.append('/var/mapnik')

class WMSHandler(Handler):
    configpath = '/var/mapnik/ogcserver.conf'

fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()

######## ogcserver.config ###############

# unchanged, except

module=worldMapFactory

######## worldMapFactory.py #############

#!/usr/bin/python

from mapnik.ogcserver.WMS import BaseWMSFactory
from mapnik import *

class WMSFactory(BaseWMSFactory):
  def __init__(self):
    BaseWMSFactory.__init__(self)
    sty = Style()
    rl = Rule()
    rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
    rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
    sty.rules.append( rl )
    self.register_style('style1', sty)
    lyr = Layer('world', '+init=epsg:4326')

    lyr.title = 'World'
    lyr.abstract = 'World Test'
    lyr.queryable = True
    lyr.datasource =
Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
    self.register_layer(lyr,'style1')
    self.finalize()


# simple test script (works just fine):
######## mapnikTest.py ###########

from mapnik import *

m = Map(600,300)
m.background = Color('steelblue')

sty = Style()
rl = Rule()

rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))

sty.rules.append( rl )

m.append_style('My Style',sty)

lyr = Layer('world', '+init=epsg:4326')

lyr.title = 'World Borders'
lyr.abstract = 'World Test'
lyr.queryable = True
lyr.datasource =
Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
lyr.styles.append('My Style')

m.layers.append(lyr)

m.zoom_to_box(lyr.envelope())
render_to_file(m, 'hello_world_in_pure_python.png')


From blake at hailmail.net  Thu Aug 28 16:38:12 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Thu, 28 Aug 2008 07:38:12 -0700
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
Message-ID: <9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>

Hi Oleg,

Your test configuration, including that URL, looks fine.

My guess is that your apache user may not have read permissions for '/ 
var/mapnik/world_boundaries/world_boundaries_m'
Check your apache logs and if this is the case you'll likely see the  
mapnik output of 'got exception...'
Or perhaps the Mapnik WMS code is failing for some other reason, and  
the apache error logs should give you an idea.  If you find anything  
you don't understand, paste a snippet back to the list.

Also, what system are you running?

Cheers,

Dane

On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:

> Hi All,
>
> I'm playing with mapnik's WMS features. And I'm getting empty image in
> browser. The interesting thing, if I use the same style and layer, but
> with Map object and render image in python script - it works correct.
>
> Fot the request:
> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
>
> I'm getting empty white picture 600x300pix.
>
> using mapnik 5.1.0
>
> My scripts/config:
>
> ######## wms python script for fcgi #########
> #!/usr/bin/python
>
> from mapnik.ogcserver.cgiserver import Handler
> import jon.fcgi as fcgi
>
> import sys
> sys.path.append('/var/mapnik')
>
> class WMSHandler(Handler):
>    configpath = '/var/mapnik/ogcserver.conf'
>
> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
>
> ######## ogcserver.config ###############
>
> # unchanged, except
>
> module=worldMapFactory
>
> ######## worldMapFactory.py #############
>
> #!/usr/bin/python
>
> from mapnik.ogcserver.WMS import BaseWMSFactory
> from mapnik import *
>
> class WMSFactory(BaseWMSFactory):
>  def __init__(self):
>    BaseWMSFactory.__init__(self)
>    sty = Style()
>    rl = Rule()
>    rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>    rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>    sty.rules.append( rl )
>    self.register_style('style1', sty)
>    lyr = Layer('world', '+init=epsg:4326')
>
>    lyr.title = 'World'
>    lyr.abstract = 'World Test'
>    lyr.queryable = True
>    lyr.datasource =
> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>    self.register_layer(lyr,'style1')
>    self.finalize()
>
>
> # simple test script (works just fine):
> ######## mapnikTest.py ###########
>
> from mapnik import *
>
> m = Map(600,300)
> m.background = Color('steelblue')
>
> sty = Style()
> rl = Rule()
>
> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>
> sty.rules.append( rl )
>
> m.append_style('My Style',sty)
>
> lyr = Layer('world', '+init=epsg:4326')
>
> lyr.title = 'World Borders'
> lyr.abstract = 'World Test'
> lyr.queryable = True
> lyr.datasource =
> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
> lyr.styles.append('My Style')
>
> m.layers.append(lyr)
>
> m.zoom_to_box(lyr.envelope())
> render_to_file(m, 'hello_world_in_pure_python.png')
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From gelosi at gmail.com  Thu Aug 28 16:53:32 2008
From: gelosi at gmail.com (Oleg Shaniuk)
Date: Thu, 28 Aug 2008 17:53:32 +0300
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
Message-ID: <29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>

Hi Dane,

I've checked log, even tried to run apache in debug mode with maximum
verbose level (debug), but there is just nothing in log. When I set
incorrect coastline file name, I've got an exception; so, it has
access to file (I've checked rights for double-sure)
My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works well.
The confusing thing is white color - seems, it just render empty map,
without any styles at all...

which reasons at all can cause such behavior?

Regards,
Oleg

2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> Hi Oleg,
>
> Your test configuration, including that URL, looks fine.
>
> My guess is that your apache user may not have read permissions for
> '/var/mapnik/world_boundaries/world_boundaries_m'
> Check your apache logs and if this is the case you'll likely see the mapnik
> output of 'got exception...'
> Or perhaps the Mapnik WMS code is failing for some other reason, and the
> apache error logs should give you an idea.  If you find anything you don't
> understand, paste a snippet back to the list.
>
> Also, what system are you running?
>
> Cheers,
>
> Dane
>
> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
>
>> Hi All,
>>
>> I'm playing with mapnik's WMS features. And I'm getting empty image in
>> browser. The interesting thing, if I use the same style and layer, but
>> with Map object and render image in python script - it works correct.
>>
>> Fot the request:
>>
>> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
>>
>> I'm getting empty white picture 600x300pix.
>>
>> using mapnik 5.1.0
>>
>> My scripts/config:
>>
>> ######## wms python script for fcgi #########
>> #!/usr/bin/python
>>
>> from mapnik.ogcserver.cgiserver import Handler
>> import jon.fcgi as fcgi
>>
>> import sys
>> sys.path.append('/var/mapnik')
>>
>> class WMSHandler(Handler):
>>   configpath = '/var/mapnik/ogcserver.conf'
>>
>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
>>
>> ######## ogcserver.config ###############
>>
>> # unchanged, except
>>
>> module=worldMapFactory
>>
>> ######## worldMapFactory.py #############
>>
>> #!/usr/bin/python
>>
>> from mapnik.ogcserver.WMS import BaseWMSFactory
>> from mapnik import *
>>
>> class WMSFactory(BaseWMSFactory):
>>  def __init__(self):
>>   BaseWMSFactory.__init__(self)
>>   sty = Style()
>>   rl = Rule()
>>   rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>   rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>   sty.rules.append( rl )
>>   self.register_style('style1', sty)
>>   lyr = Layer('world', '+init=epsg:4326')
>>
>>   lyr.title = 'World'
>>   lyr.abstract = 'World Test'
>>   lyr.queryable = True
>>   lyr.datasource =
>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>   self.register_layer(lyr,'style1')
>>   self.finalize()
>>
>>
>> # simple test script (works just fine):
>> ######## mapnikTest.py ###########
>>
>> from mapnik import *
>>
>> m = Map(600,300)
>> m.background = Color('steelblue')
>>
>> sty = Style()
>> rl = Rule()
>>
>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>
>> sty.rules.append( rl )
>>
>> m.append_style('My Style',sty)
>>
>> lyr = Layer('world', '+init=epsg:4326')
>>
>> lyr.title = 'World Borders'
>> lyr.abstract = 'World Test'
>> lyr.queryable = True
>> lyr.datasource =
>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>> lyr.styles.append('My Style')
>>
>> m.layers.append(lyr)
>>
>> m.zoom_to_box(lyr.envelope())
>> render_to_file(m, 'hello_world_in_pure_python.png')
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>


From blake at hailmail.net  Thu Aug 28 17:47:25 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Thu, 28 Aug 2008 08:47:25 -0700
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
	<29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
Message-ID: <D2930B2A-A09B-4113-9FBB-ED7D7947410A@hailmail.net>

Oleg,

If you rebuild mapnik with the debug=y  Scons flag, mapnik should  
output a variety of information to your apache logs such at the extent  
of the data and the map, and how many features are processed given the  
bounding box.

I think if you do this what you will see is that no features are being  
processed since they are not falling within the WMS query BBOX you are  
testing.

I think you must have downloaded that world_boundaries_m.shp from  
OSM?  If I run ogrinfo on that shapefile I get:

$ ogrinfo world_boundaries_m.shp -so -al
INFO: Open of `world_boundaries_m.shp'
       using driver `ESRI Shapefile' successful.

Layer name: world_boundaries_m
Geometry: Polygon
Feature Count: 3807
Extent: (-20037400.000000, -19929239.110000) - (20037400.000000,  
18375854.709643)
Layer SRS WKT:
PROJCS["Mercator",
     GEOGCS["GCS_WGS_1984",
         DATUM["WGS_1984",
             SPHEROID["WGS_1984",6378137,298.257223563]],
         PRIMEM["Greenwich",0],
         UNIT["Degree",0.017453292519943295]],
     PROJECTION["Mercator_1SP"],
     PARAMETER["latitude_of_origin",0],
     PARAMETER["central_meridian",0],
     PARAMETER["scale_factor",1],
     PARAMETER["false_easting",0],
     PARAMETER["false_northing",0],
     UNIT["Meter",1]]
CAT: Real (16.0)
FIPS_CNTRY: String (80.0)
CNTRY_NAME: String (80.0)


It seems like for your testing script you will need a shapefile in  
true unprojected WGS 84(EPSG:4326) coordinates, like the one here:
http://mapnik-utils.googlecode.com/svn/trunk/sample_data/

Otherwise you will need to modify your script

such that this line:

>>>  lyr = Layer('world', '+init=epsg:4326')


becomes:

lyr = Layer('world', '+init=epsg:3395')


Which will allow the WMS server to reproject your data. So, using the  
same query string you should get back a map in EPSG:4326.

If you then want to get map tiles in mercator you'll need to add a  
line to your ogcserver.conf like:

allowedepsgcodes=4326,3395, # trailing comma is essential

and then test a WMS query string with a  
bbox=-20037400.000000,-19929239.110000,  
20037400.000000,18375854.709643 and EPSG=3395

something more like:

http://localhost/fcgi-bin/wms?LAYERS=world&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&STYLES=&EXCEPTIONS=application%2Fvnd.ogc.se_inimage&FORMAT=image%2Fpng&SRS=EPSG%3A3395&BBOX=-20037400.000000,-19929239.110000,%2020037400.000000,18375854.709643&WIDTH=256&HEIGHT=256


Dane


On Aug 28, 2008, at 7:53 AM, Oleg Shaniuk wrote:

> Hi Dane,
>
> I've checked log, even tried to run apache in debug mode with maximum
> verbose level (debug), but there is just nothing in log. When I set
> incorrect coastline file name, I've got an exception; so, it has
> access to file (I've checked rights for double-sure)
> My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works well.
> The confusing thing is white color - seems, it just render empty map,
> without any styles at all...
>
> which reasons at all can cause such behavior?
>
> Regards,
> Oleg
>
> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
>> Hi Oleg,
>>
>> Your test configuration, including that URL, looks fine.
>>
>> My guess is that your apache user may not have read permissions for
>> '/var/mapnik/world_boundaries/world_boundaries_m'
>> Check your apache logs and if this is the case you'll likely see  
>> the mapnik
>> output of 'got exception...'
>> Or perhaps the Mapnik WMS code is failing for some other reason,  
>> and the
>> apache error logs should give you an idea.  If you find anything  
>> you don't
>> understand, paste a snippet back to the list.
>>
>> Also, what system are you running?
>>
>> Cheers,
>>
>> Dane
>>
>> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
>>
>>> Hi All,
>>>
>>> I'm playing with mapnik's WMS features. And I'm getting empty  
>>> image in
>>> browser. The interesting thing, if I use the same style and layer,  
>>> but
>>> with Map object and render image in python script - it works  
>>> correct.
>>>
>>> Fot the request:
>>>
>>> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
>>>
>>> I'm getting empty white picture 600x300pix.
>>>
>>> using mapnik 5.1.0
>>>
>>> My scripts/config:
>>>
>>> ######## wms python script for fcgi #########
>>> #!/usr/bin/python
>>>
>>> from mapnik.ogcserver.cgiserver import Handler
>>> import jon.fcgi as fcgi
>>>
>>> import sys
>>> sys.path.append('/var/mapnik')
>>>
>>> class WMSHandler(Handler):
>>>  configpath = '/var/mapnik/ogcserver.conf'
>>>
>>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
>>>
>>> ######## ogcserver.config ###############
>>>
>>> # unchanged, except
>>>
>>> module=worldMapFactory
>>>
>>> ######## worldMapFactory.py #############
>>>
>>> #!/usr/bin/python
>>>
>>> from mapnik.ogcserver.WMS import BaseWMSFactory
>>> from mapnik import *
>>>
>>> class WMSFactory(BaseWMSFactory):
>>> def __init__(self):
>>>  BaseWMSFactory.__init__(self)
>>>  sty = Style()
>>>  rl = Rule()
>>>  rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>>  rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>  sty.rules.append( rl )
>>>  self.register_style('style1', sty)
>>>  lyr = Layer('world', '+init=epsg:4326')
>>>
>>>  lyr.title = 'World'
>>>  lyr.abstract = 'World Test'
>>>  lyr.queryable = True
>>>  lyr.datasource =
>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>>  self.register_layer(lyr,'style1')
>>>  self.finalize()
>>>
>>>
>>> # simple test script (works just fine):
>>> ######## mapnikTest.py ###########
>>>
>>> from mapnik import *
>>>
>>> m = Map(600,300)
>>> m.background = Color('steelblue')
>>>
>>> sty = Style()
>>> rl = Rule()
>>>
>>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>
>>> sty.rules.append( rl )
>>>
>>> m.append_style('My Style',sty)
>>>
>>> lyr = Layer('world', '+init=epsg:4326')
>>>
>>> lyr.title = 'World Borders'
>>> lyr.abstract = 'World Test'
>>> lyr.queryable = True
>>> lyr.datasource =
>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>> lyr.styles.append('My Style')
>>>
>>> m.layers.append(lyr)
>>>
>>> m.zoom_to_box(lyr.envelope())
>>> render_to_file(m, 'hello_world_in_pure_python.png')
>>> _______________________________________________
>>> Mapnik-devel mailing list
>>> Mapnik-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>
>>



From blake at hailmail.net  Thu Aug 28 17:48:30 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Thu, 28 Aug 2008 08:48:30 -0700
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
	<29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
Message-ID: <7AFE1943-A6E8-405B-8D35-3930CFB0E894@hailmail.net>

Oleg,

Can you also confirm that this works without errors:

$ python
 >>> from mapnik.ogcserver import common
 >>>

Thanks,

Dane

On Aug 28, 2008, at 7:53 AM, Oleg Shaniuk wrote:

> Hi Dane,
>
> I've checked log, even tried to run apache in debug mode with maximum
> verbose level (debug), but there is just nothing in log. When I set
> incorrect coastline file name, I've got an exception; so, it has
> access to file (I've checked rights for double-sure)
> My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works well.
> The confusing thing is white color - seems, it just render empty map,
> without any styles at all...
>
> which reasons at all can cause such behavior?
>
> Regards,
> Oleg
>
> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
>> Hi Oleg,
>>
>> Your test configuration, including that URL, looks fine.
>>
>> My guess is that your apache user may not have read permissions for
>> '/var/mapnik/world_boundaries/world_boundaries_m'
>> Check your apache logs and if this is the case you'll likely see  
>> the mapnik
>> output of 'got exception...'
>> Or perhaps the Mapnik WMS code is failing for some other reason,  
>> and the
>> apache error logs should give you an idea.  If you find anything  
>> you don't
>> understand, paste a snippet back to the list.
>>
>> Also, what system are you running?
>>
>> Cheers,
>>
>> Dane
>>
>> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
>>
>>> Hi All,
>>>
>>> I'm playing with mapnik's WMS features. And I'm getting empty  
>>> image in
>>> browser. The interesting thing, if I use the same style and layer,  
>>> but
>>> with Map object and render image in python script - it works  
>>> correct.
>>>
>>> Fot the request:
>>>
>>> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
>>>
>>> I'm getting empty white picture 600x300pix.
>>>
>>> using mapnik 5.1.0
>>>
>>> My scripts/config:
>>>
>>> ######## wms python script for fcgi #########
>>> #!/usr/bin/python
>>>
>>> from mapnik.ogcserver.cgiserver import Handler
>>> import jon.fcgi as fcgi
>>>
>>> import sys
>>> sys.path.append('/var/mapnik')
>>>
>>> class WMSHandler(Handler):
>>>  configpath = '/var/mapnik/ogcserver.conf'
>>>
>>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
>>>
>>> ######## ogcserver.config ###############
>>>
>>> # unchanged, except
>>>
>>> module=worldMapFactory
>>>
>>> ######## worldMapFactory.py #############
>>>
>>> #!/usr/bin/python
>>>
>>> from mapnik.ogcserver.WMS import BaseWMSFactory
>>> from mapnik import *
>>>
>>> class WMSFactory(BaseWMSFactory):
>>> def __init__(self):
>>>  BaseWMSFactory.__init__(self)
>>>  sty = Style()
>>>  rl = Rule()
>>>  rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>>  rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>  sty.rules.append( rl )
>>>  self.register_style('style1', sty)
>>>  lyr = Layer('world', '+init=epsg:4326')
>>>
>>>  lyr.title = 'World'
>>>  lyr.abstract = 'World Test'
>>>  lyr.queryable = True
>>>  lyr.datasource =
>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>>  self.register_layer(lyr,'style1')
>>>  self.finalize()
>>>
>>>
>>> # simple test script (works just fine):
>>> ######## mapnikTest.py ###########
>>>
>>> from mapnik import *
>>>
>>> m = Map(600,300)
>>> m.background = Color('steelblue')
>>>
>>> sty = Style()
>>> rl = Rule()
>>>
>>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>
>>> sty.rules.append( rl )
>>>
>>> m.append_style('My Style',sty)
>>>
>>> lyr = Layer('world', '+init=epsg:4326')
>>>
>>> lyr.title = 'World Borders'
>>> lyr.abstract = 'World Test'
>>> lyr.queryable = True
>>> lyr.datasource =
>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>> lyr.styles.append('My Style')
>>>
>>> m.layers.append(lyr)
>>>
>>> m.zoom_to_box(lyr.envelope())
>>> render_to_file(m, 'hello_world_in_pure_python.png')
>>> _______________________________________________
>>> Mapnik-devel mailing list
>>> Mapnik-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>
>>



From gelosi at gmail.com  Fri Aug 29 09:41:15 2008
From: gelosi at gmail.com (Oleg Shaniuk)
Date: Fri, 29 Aug 2008 10:41:15 +0300
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <D2930B2A-A09B-4113-9FBB-ED7D7947410A@hailmail.net>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
	<29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
	<D2930B2A-A09B-4113-9FBB-ED7D7947410A@hailmail.net>
Message-ID: <29735a280808290041h7e39dbcclfe244fdf7530b612@mail.gmail.com>

Hi Dane,

Thanks for tip! It's really about projections. Looks like, time to
learn more about geospatial systems.
Also, as you might guess already, [>>> from mapnik.ogcserver import
common] works well ;)

Regards,
Oleg

2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> Oleg,
>
> If you rebuild mapnik with the debug=y  Scons flag, mapnik should output a
> variety of information to your apache logs such at the extent of the data
> and the map, and how many features are processed given the bounding box.
>
> I think if you do this what you will see is that no features are being
> processed since they are not falling within the WMS query BBOX you are
> testing.
>
> I think you must have downloaded that world_boundaries_m.shp from OSM?  If I
> run ogrinfo on that shapefile I get:
>
> $ ogrinfo world_boundaries_m.shp -so -al
> INFO: Open of `world_boundaries_m.shp'
>      using driver `ESRI Shapefile' successful.
>
> Layer name: world_boundaries_m
> Geometry: Polygon
> Feature Count: 3807
> Extent: (-20037400.000000, -19929239.110000) - (20037400.000000,
> 18375854.709643)
> Layer SRS WKT:
> PROJCS["Mercator",
>    GEOGCS["GCS_WGS_1984",
>        DATUM["WGS_1984",
>            SPHEROID["WGS_1984",6378137,298.257223563]],
>        PRIMEM["Greenwich",0],
>        UNIT["Degree",0.017453292519943295]],
>    PROJECTION["Mercator_1SP"],
>    PARAMETER["latitude_of_origin",0],
>    PARAMETER["central_meridian",0],
>    PARAMETER["scale_factor",1],
>    PARAMETER["false_easting",0],
>    PARAMETER["false_northing",0],
>    UNIT["Meter",1]]
> CAT: Real (16.0)
> FIPS_CNTRY: String (80.0)
> CNTRY_NAME: String (80.0)
>
>
> It seems like for your testing script you will need a shapefile in true
> unprojected WGS 84(EPSG:4326) coordinates, like the one here:
> http://mapnik-utils.googlecode.com/svn/trunk/sample_data/
>
> Otherwise you will need to modify your script
>
> such that this line:
>
>>>>  lyr = Layer('world', '+init=epsg:4326')
>
>
> becomes:
>
> lyr = Layer('world', '+init=epsg:3395')
>
>
> Which will allow the WMS server to reproject your data. So, using the same
> query string you should get back a map in EPSG:4326.
>
> If you then want to get map tiles in mercator you'll need to add a line to
> your ogcserver.conf like:
>
> allowedepsgcodes=4326,3395, # trailing comma is essential
>
> and then test a WMS query string with a
> bbox=-20037400.000000,-19929239.110000, 20037400.000000,18375854.709643 and
> EPSG=3395
>
> something more like:
>
> http://localhost/fcgi-bin/wms?LAYERS=world&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&STYLES=&EXCEPTIONS=application%2Fvnd.ogc.se_inimage&FORMAT=image%2Fpng&SRS=EPSG%3A3395&BBOX=-20037400.000000,-19929239.110000,%2020037400.000000,18375854.709643&WIDTH=256&HEIGHT=256
>
>
> Dane
>
>
> On Aug 28, 2008, at 7:53 AM, Oleg Shaniuk wrote:
>
>> Hi Dane,
>>
>> I've checked log, even tried to run apache in debug mode with maximum
>> verbose level (debug), but there is just nothing in log. When I set
>> incorrect coastline file name, I've got an exception; so, it has
>> access to file (I've checked rights for double-sure)
>> My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works well.
>> The confusing thing is white color - seems, it just render empty map,
>> without any styles at all...
>>
>> which reasons at all can cause such behavior?
>>
>> Regards,
>> Oleg
>>
>> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
>>>
>>> Hi Oleg,
>>>
>>> Your test configuration, including that URL, looks fine.
>>>
>>> My guess is that your apache user may not have read permissions for
>>> '/var/mapnik/world_boundaries/world_boundaries_m'
>>> Check your apache logs and if this is the case you'll likely see the
>>> mapnik
>>> output of 'got exception...'
>>> Or perhaps the Mapnik WMS code is failing for some other reason, and the
>>> apache error logs should give you an idea.  If you find anything you
>>> don't
>>> understand, paste a snippet back to the list.
>>>
>>> Also, what system are you running?
>>>
>>> Cheers,
>>>
>>> Dane
>>>
>>> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
>>>
>>>> Hi All,
>>>>
>>>> I'm playing with mapnik's WMS features. And I'm getting empty image in
>>>> browser. The interesting thing, if I use the same style and layer, but
>>>> with Map object and render image in python script - it works correct.
>>>>
>>>> Fot the request:
>>>>
>>>>
>>>> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
>>>>
>>>> I'm getting empty white picture 600x300pix.
>>>>
>>>> using mapnik 5.1.0
>>>>
>>>> My scripts/config:
>>>>
>>>> ######## wms python script for fcgi #########
>>>> #!/usr/bin/python
>>>>
>>>> from mapnik.ogcserver.cgiserver import Handler
>>>> import jon.fcgi as fcgi
>>>>
>>>> import sys
>>>> sys.path.append('/var/mapnik')
>>>>
>>>> class WMSHandler(Handler):
>>>>  configpath = '/var/mapnik/ogcserver.conf'
>>>>
>>>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
>>>>
>>>> ######## ogcserver.config ###############
>>>>
>>>> # unchanged, except
>>>>
>>>> module=worldMapFactory
>>>>
>>>> ######## worldMapFactory.py #############
>>>>
>>>> #!/usr/bin/python
>>>>
>>>> from mapnik.ogcserver.WMS import BaseWMSFactory
>>>> from mapnik import *
>>>>
>>>> class WMSFactory(BaseWMSFactory):
>>>> def __init__(self):
>>>>  BaseWMSFactory.__init__(self)
>>>>  sty = Style()
>>>>  rl = Rule()
>>>>  rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>>>  rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>>  sty.rules.append( rl )
>>>>  self.register_style('style1', sty)
>>>>  lyr = Layer('world', '+init=epsg:4326')
>>>>
>>>>  lyr.title = 'World'
>>>>  lyr.abstract = 'World Test'
>>>>  lyr.queryable = True
>>>>  lyr.datasource =
>>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>>>  self.register_layer(lyr,'style1')
>>>>  self.finalize()
>>>>
>>>>
>>>> # simple test script (works just fine):
>>>> ######## mapnikTest.py ###########
>>>>
>>>> from mapnik import *
>>>>
>>>> m = Map(600,300)
>>>> m.background = Color('steelblue')
>>>>
>>>> sty = Style()
>>>> rl = Rule()
>>>>
>>>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
>>>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
>>>>
>>>> sty.rules.append( rl )
>>>>
>>>> m.append_style('My Style',sty)
>>>>
>>>> lyr = Layer('world', '+init=epsg:4326')
>>>>
>>>> lyr.title = 'World Borders'
>>>> lyr.abstract = 'World Test'
>>>> lyr.queryable = True
>>>> lyr.datasource =
>>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
>>>> lyr.styles.append('My Style')
>>>>
>>>> m.layers.append(lyr)
>>>>
>>>> m.zoom_to_box(lyr.envelope())
>>>> render_to_file(m, 'hello_world_in_pure_python.png')
>>>> _______________________________________________
>>>> Mapnik-devel mailing list
>>>> Mapnik-devel at lists.berlios.de
>>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>>
>>>
>
>


From lwu.two at gmail.com  Fri Aug 29 22:30:18 2008
From: lwu.two at gmail.com (Leslie Wu)
Date: Fri, 29 Aug 2008 13:30:18 -0700
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <29735a280808290041h7e39dbcclfe244fdf7530b612@mail.gmail.com>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
	<29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
	<D2930B2A-A09B-4113-9FBB-ED7D7947410A@hailmail.net>
	<29735a280808290041h7e39dbcclfe244fdf7530b612@mail.gmail.com>
Message-ID: <78ec96990808291330x4ff8ec0bkd87727d7045cce65@mail.gmail.com>

I guess we could add some background GIS / info links to the Mapnik wiki.
I've been learning about projections myself recently.
Perhaps a proj.4 reference and a guide such as this?

  http://www.manifold.net/doc/guide_to_selecting_map_projections.htm

I started a brief introduction to GIS page here:

  http://trac.mapnik.org/wiki/IntroductionToGIS

Please contribute :)

~L


On Fri, Aug 29, 2008 at 12:41 AM, Oleg Shaniuk <gelosi at gmail.com> wrote:

> Hi Dane,
>
> Thanks for tip! It's really about projections. Looks like, time to
> learn more about geospatial systems.
> Also, as you might guess already, [>>> from mapnik.ogcserver import
> common] works well ;)
>
> Regards,
> Oleg
>
> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> > Oleg,
> >
> > If you rebuild mapnik with the debug=y  Scons flag, mapnik should output
> a
> > variety of information to your apache logs such at the extent of the data
> > and the map, and how many features are processed given the bounding box.
> >
> > I think if you do this what you will see is that no features are being
> > processed since they are not falling within the WMS query BBOX you are
> > testing.
> >
> > I think you must have downloaded that world_boundaries_m.shp from OSM?
>  If I
> > run ogrinfo on that shapefile I get:
> >
> > $ ogrinfo world_boundaries_m.shp -so -al
> > INFO: Open of `world_boundaries_m.shp'
> >      using driver `ESRI Shapefile' successful.
> >
> > Layer name: world_boundaries_m
> > Geometry: Polygon
> > Feature Count: 3807
> > Extent: (-20037400.000000, -19929239.110000) - (20037400.000000,
> > 18375854.709643)
> > Layer SRS WKT:
> > PROJCS["Mercator",
> >    GEOGCS["GCS_WGS_1984",
> >        DATUM["WGS_1984",
> >            SPHEROID["WGS_1984",6378137,298.257223563]],
> >        PRIMEM["Greenwich",0],
> >        UNIT["Degree",0.017453292519943295]],
> >    PROJECTION["Mercator_1SP"],
> >    PARAMETER["latitude_of_origin",0],
> >    PARAMETER["central_meridian",0],
> >    PARAMETER["scale_factor",1],
> >    PARAMETER["false_easting",0],
> >    PARAMETER["false_northing",0],
> >    UNIT["Meter",1]]
> > CAT: Real (16.0)
> > FIPS_CNTRY: String (80.0)
> > CNTRY_NAME: String (80.0)
> >
> >
> > It seems like for your testing script you will need a shapefile in true
> > unprojected WGS 84(EPSG:4326) coordinates, like the one here:
> > http://mapnik-utils.googlecode.com/svn/trunk/sample_data/
> >
> > Otherwise you will need to modify your script
> >
> > such that this line:
> >
> >>>>  lyr = Layer('world', '+init=epsg:4326')
> >
> >
> > becomes:
> >
> > lyr = Layer('world', '+init=epsg:3395')
> >
> >
> > Which will allow the WMS server to reproject your data. So, using the
> same
> > query string you should get back a map in EPSG:4326.
> >
> > If you then want to get map tiles in mercator you'll need to add a line
> to
> > your ogcserver.conf like:
> >
> > allowedepsgcodes=4326,3395, # trailing comma is essential
> >
> > and then test a WMS query string with a
> > bbox=-20037400.000000,-19929239.110000, 20037400.000000,18375854.709643
> and
> > EPSG=3395
> >
> > something more like:
> >
> >
> http://localhost/fcgi-bin/wms?LAYERS=world&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&STYLES=&EXCEPTIONS=application%2Fvnd.ogc.se_inimage&FORMAT=image%2Fpng&SRS=EPSG%3A3395&BBOX=-20037400.000000,-19929239.110000,%2020037400.000000,18375854.709643&WIDTH=256&HEIGHT=256
> >
> >
> > Dane
> >
> >
> > On Aug 28, 2008, at 7:53 AM, Oleg Shaniuk wrote:
> >
> >> Hi Dane,
> >>
> >> I've checked log, even tried to run apache in debug mode with maximum
> >> verbose level (debug), but there is just nothing in log. When I set
> >> incorrect coastline file name, I've got an exception; so, it has
> >> access to file (I've checked rights for double-sure)
> >> My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works well.
> >> The confusing thing is white color - seems, it just render empty map,
> >> without any styles at all...
> >>
> >> which reasons at all can cause such behavior?
> >>
> >> Regards,
> >> Oleg
> >>
> >> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> >>>
> >>> Hi Oleg,
> >>>
> >>> Your test configuration, including that URL, looks fine.
> >>>
> >>> My guess is that your apache user may not have read permissions for
> >>> '/var/mapnik/world_boundaries/world_boundaries_m'
> >>> Check your apache logs and if this is the case you'll likely see the
> >>> mapnik
> >>> output of 'got exception...'
> >>> Or perhaps the Mapnik WMS code is failing for some other reason, and
> the
> >>> apache error logs should give you an idea.  If you find anything you
> >>> don't
> >>> understand, paste a snippet back to the list.
> >>>
> >>> Also, what system are you running?
> >>>
> >>> Cheers,
> >>>
> >>> Dane
> >>>
> >>> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
> >>>
> >>>> Hi All,
> >>>>
> >>>> I'm playing with mapnik's WMS features. And I'm getting empty image in
> >>>> browser. The interesting thing, if I use the same style and layer, but
> >>>> with Map object and render image in python script - it works correct.
> >>>>
> >>>> Fot the request:
> >>>>
> >>>>
> >>>>
> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
> >>>>
> >>>> I'm getting empty white picture 600x300pix.
> >>>>
> >>>> using mapnik 5.1.0
> >>>>
> >>>> My scripts/config:
> >>>>
> >>>> ######## wms python script for fcgi #########
> >>>> #!/usr/bin/python
> >>>>
> >>>> from mapnik.ogcserver.cgiserver import Handler
> >>>> import jon.fcgi as fcgi
> >>>>
> >>>> import sys
> >>>> sys.path.append('/var/mapnik')
> >>>>
> >>>> class WMSHandler(Handler):
> >>>>  configpath = '/var/mapnik/ogcserver.conf'
> >>>>
> >>>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
> >>>>
> >>>> ######## ogcserver.config ###############
> >>>>
> >>>> # unchanged, except
> >>>>
> >>>> module=worldMapFactory
> >>>>
> >>>> ######## worldMapFactory.py #############
> >>>>
> >>>> #!/usr/bin/python
> >>>>
> >>>> from mapnik.ogcserver.WMS import BaseWMSFactory
> >>>> from mapnik import *
> >>>>
> >>>> class WMSFactory(BaseWMSFactory):
> >>>> def __init__(self):
> >>>>  BaseWMSFactory.__init__(self)
> >>>>  sty = Style()
> >>>>  rl = Rule()
> >>>>  rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
> >>>>  rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
> >>>>  sty.rules.append( rl )
> >>>>  self.register_style('style1', sty)
> >>>>  lyr = Layer('world', '+init=epsg:4326')
> >>>>
> >>>>  lyr.title = 'World'
> >>>>  lyr.abstract = 'World Test'
> >>>>  lyr.queryable = True
> >>>>  lyr.datasource =
> >>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
> >>>>  self.register_layer(lyr,'style1')
> >>>>  self.finalize()
> >>>>
> >>>>
> >>>> # simple test script (works just fine):
> >>>> ######## mapnikTest.py ###########
> >>>>
> >>>> from mapnik import *
> >>>>
> >>>> m = Map(600,300)
> >>>> m.background = Color('steelblue')
> >>>>
> >>>> sty = Style()
> >>>> rl = Rule()
> >>>>
> >>>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
> >>>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
> >>>>
> >>>> sty.rules.append( rl )
> >>>>
> >>>> m.append_style('My Style',sty)
> >>>>
> >>>> lyr = Layer('world', '+init=epsg:4326')
> >>>>
> >>>> lyr.title = 'World Borders'
> >>>> lyr.abstract = 'World Test'
> >>>> lyr.queryable = True
> >>>> lyr.datasource =
> >>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
> >>>> lyr.styles.append('My Style')
> >>>>
> >>>> m.layers.append(lyr)
> >>>>
> >>>> m.zoom_to_box(lyr.envelope())
> >>>> render_to_file(m, 'hello_world_in_pure_python.png')
> >>>> _______________________________________________
> >>>> Mapnik-devel mailing list
> >>>> Mapnik-devel at lists.berlios.de
> >>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
> >>>
> >>>
> >
> >
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080829/de99caca/attachment.html>

From blake at hailmail.net  Fri Aug 29 23:00:18 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 29 Aug 2008 14:00:18 -0700
Subject: [Mapnik-devel] Mapnik's WMS use
In-Reply-To: <78ec96990808291330x4ff8ec0bkd87727d7045cce65@mail.gmail.com>
References: <29735a280808280710l141851eei223a3166bda17364@mail.gmail.com>
	<9DE5CD87-0215-4919-AE68-67E58FDA1B3E@hailmail.net>
	<29735a280808280753j74eeff22tc5c36c402c6ff81d@mail.gmail.com>
	<D2930B2A-A09B-4113-9FBB-ED7D7947410A@hailmail.net>
	<29735a280808290041h7e39dbcclfe244fdf7530b612@mail.gmail.com>
	<78ec96990808291330x4ff8ec0bkd87727d7045cce65@mail.gmail.com>
Message-ID: <3D83C7AE-670E-4CCB-9A35-80AD88794879@hailmail.net>

Hi Leslie,

Thanks for adding the page, I think thats a great idea. I've been  
working with projections for a long time, errr...  at least long  
enough that I am able to confuse most people I try to help!

Oleg, have you made any progess?  Figuring out the projection of your  
data and then making sure to add the epsg code to you ogcserver.conf  
is all you should need to do, then you can test the new url query  
string.

An example config with some code to turn on EPSG 3395 can be found here:

http://mapnik-utils.googlecode.com/svn/trunk/tutorials/wms/

Cheers,

Dane





On Aug 29, 2008, at 1:30 PM, Leslie Wu wrote:

> I guess we could add some background GIS / info links to the Mapnik  
> wiki. I've been learning about projections myself recently.
>
> Perhaps a proj.4 reference and a guide such as this?
>
>   http://www.manifold.net/doc/guide_to_selecting_map_projections.htm
>
> I started a brief introduction to GIS page here:
>
>   http://trac.mapnik.org/wiki/IntroductionToGIS
>
> Please contribute :)
>
> ~L
>
>
> On Fri, Aug 29, 2008 at 12:41 AM, Oleg Shaniuk <gelosi at gmail.com>  
> wrote:
> Hi Dane,
>
> Thanks for tip! It's really about projections. Looks like, time to
> learn more about geospatial systems.
> Also, as you might guess already, [>>> from mapnik.ogcserver import
> common] works well ;)
>
> Regards,
> Oleg
>
> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> > Oleg,
> >
> > If you rebuild mapnik with the debug=y  Scons flag, mapnik should  
> output a
> > variety of information to your apache logs such at the extent of  
> the data
> > and the map, and how many features are processed given the  
> bounding box.
> >
> > I think if you do this what you will see is that no features are  
> being
> > processed since they are not falling within the WMS query BBOX you  
> are
> > testing.
> >
> > I think you must have downloaded that world_boundaries_m.shp from  
> OSM?  If I
> > run ogrinfo on that shapefile I get:
> >
> > $ ogrinfo world_boundaries_m.shp -so -al
> > INFO: Open of `world_boundaries_m.shp'
> >      using driver `ESRI Shapefile' successful.
> >
> > Layer name: world_boundaries_m
> > Geometry: Polygon
> > Feature Count: 3807
> > Extent: (-20037400.000000, -19929239.110000) - (20037400.000000,
> > 18375854.709643)
> > Layer SRS WKT:
> > PROJCS["Mercator",
> >    GEOGCS["GCS_WGS_1984",
> >        DATUM["WGS_1984",
> >            SPHEROID["WGS_1984",6378137,298.257223563]],
> >        PRIMEM["Greenwich",0],
> >        UNIT["Degree",0.017453292519943295]],
> >    PROJECTION["Mercator_1SP"],
> >    PARAMETER["latitude_of_origin",0],
> >    PARAMETER["central_meridian",0],
> >    PARAMETER["scale_factor",1],
> >    PARAMETER["false_easting",0],
> >    PARAMETER["false_northing",0],
> >    UNIT["Meter",1]]
> > CAT: Real (16.0)
> > FIPS_CNTRY: String (80.0)
> > CNTRY_NAME: String (80.0)
> >
> >
> > It seems like for your testing script you will need a shapefile in  
> true
> > unprojected WGS 84(EPSG:4326) coordinates, like the one here:
> > http://mapnik-utils.googlecode.com/svn/trunk/sample_data/
> >
> > Otherwise you will need to modify your script
> >
> > such that this line:
> >
> >>>>  lyr = Layer('world', '+init=epsg:4326')
> >
> >
> > becomes:
> >
> > lyr = Layer('world', '+init=epsg:3395')
> >
> >
> > Which will allow the WMS server to reproject your data. So, using  
> the same
> > query string you should get back a map in EPSG:4326.
> >
> > If you then want to get map tiles in mercator you'll need to add a  
> line to
> > your ogcserver.conf like:
> >
> > allowedepsgcodes=4326,3395, # trailing comma is essential
> >
> > and then test a WMS query string with a
> > bbox=-20037400.000000,-19929239.110000,  
> 20037400.000000,18375854.709643 and
> > EPSG=3395
> >
> > something more like:
> >
> > http://localhost/fcgi-bin/wms?LAYERS=world&SERVICE=WMS&VERSION=1.1.1&REQUEST=GetMap&STYLES=&EXCEPTIONS=application%2Fvnd.ogc.se_inimage&FORMAT=image%2Fpng&SRS=EPSG%3A3395&BBOX=-20037400.000000,-19929239.110000,%2020037400.000000,18375854.709643&WIDTH=256&HEIGHT=256
> >
> >
> > Dane
> >
> >
> > On Aug 28, 2008, at 7:53 AM, Oleg Shaniuk wrote:
> >
> >> Hi Dane,
> >>
> >> I've checked log, even tried to run apache in debug mode with  
> maximum
> >> verbose level (debug), but there is just nothing in log. When I set
> >> incorrect coastline file name, I've got an exception; so, it has
> >> access to file (I've checked rights for double-sure)
> >> My system is ubuntu 8.04, apache2 ( 2.2.8 ubuntu ). Mapnik works  
> well.
> >> The confusing thing is white color - seems, it just render empty  
> map,
> >> without any styles at all...
> >>
> >> which reasons at all can cause such behavior?
> >>
> >> Regards,
> >> Oleg
> >>
> >> 2008/8/28 Dane Springmeyer <blake at hailmail.net>:
> >>>
> >>> Hi Oleg,
> >>>
> >>> Your test configuration, including that URL, looks fine.
> >>>
> >>> My guess is that your apache user may not have read permissions  
> for
> >>> '/var/mapnik/world_boundaries/world_boundaries_m'
> >>> Check your apache logs and if this is the case you'll likely see  
> the
> >>> mapnik
> >>> output of 'got exception...'
> >>> Or perhaps the Mapnik WMS code is failing for some other reason,  
> and the
> >>> apache error logs should give you an idea.  If you find anything  
> you
> >>> don't
> >>> understand, paste a snippet back to the list.
> >>>
> >>> Also, what system are you running?
> >>>
> >>> Cheers,
> >>>
> >>> Dane
> >>>
> >>> On Aug 28, 2008, at 7:10 AM, Oleg Shaniuk wrote:
> >>>
> >>>> Hi All,
> >>>>
> >>>> I'm playing with mapnik's WMS features. And I'm getting empty  
> image in
> >>>> browser. The interesting thing, if I use the same style and  
> layer, but
> >>>> with Map object and render image in python script - it works  
> correct.
> >>>>
> >>>> Fot the request:
> >>>>
> >>>>
> >>>> http://localhost/fcgi-bin/wms?VERSION=1.1.1&REQUEST=GetMap&LAYERS=world&FORMAT=image/png&SRS=EPSG:4326&STYLES=&&BBOX=-179,-83,179,83&EXCEPTIONS=application/vnd.ogc.se_inimage&width=600&height=300
> >>>>
> >>>> I'm getting empty white picture 600x300pix.
> >>>>
> >>>> using mapnik 5.1.0
> >>>>
> >>>> My scripts/config:
> >>>>
> >>>> ######## wms python script for fcgi #########
> >>>> #!/usr/bin/python
> >>>>
> >>>> from mapnik.ogcserver.cgiserver import Handler
> >>>> import jon.fcgi as fcgi
> >>>>
> >>>> import sys
> >>>> sys.path.append('/var/mapnik')
> >>>>
> >>>> class WMSHandler(Handler):
> >>>>  configpath = '/var/mapnik/ogcserver.conf'
> >>>>
> >>>> fcgi.Server({fcgi.FCGI_RESPONDER: WMSHandler}).run()
> >>>>
> >>>> ######## ogcserver.config ###############
> >>>>
> >>>> # unchanged, except
> >>>>
> >>>> module=worldMapFactory
> >>>>
> >>>> ######## worldMapFactory.py #############
> >>>>
> >>>> #!/usr/bin/python
> >>>>
> >>>> from mapnik.ogcserver.WMS import BaseWMSFactory
> >>>> from mapnik import *
> >>>>
> >>>> class WMSFactory(BaseWMSFactory):
> >>>> def __init__(self):
> >>>>  BaseWMSFactory.__init__(self)
> >>>>  sty = Style()
> >>>>  rl = Rule()
> >>>>  rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
> >>>>  rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
> >>>>  sty.rules.append( rl )
> >>>>  self.register_style('style1', sty)
> >>>>  lyr = Layer('world', '+init=epsg:4326')
> >>>>
> >>>>  lyr.title = 'World'
> >>>>  lyr.abstract = 'World Test'
> >>>>  lyr.queryable = True
> >>>>  lyr.datasource =
> >>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
> >>>>  self.register_layer(lyr,'style1')
> >>>>  self.finalize()
> >>>>
> >>>>
> >>>> # simple test script (works just fine):
> >>>> ######## mapnikTest.py ###########
> >>>>
> >>>> from mapnik import *
> >>>>
> >>>> m = Map(600,300)
> >>>> m.background = Color('steelblue')
> >>>>
> >>>> sty = Style()
> >>>> rl = Rule()
> >>>>
> >>>> rl.symbols.append(PolygonSymbolizer(Color('#f2eff9')))
> >>>> rl.symbols.append(LineSymbolizer(Color('steelblue'),.1))
> >>>>
> >>>> sty.rules.append( rl )
> >>>>
> >>>> m.append_style('My Style',sty)
> >>>>
> >>>> lyr = Layer('world', '+init=epsg:4326')
> >>>>
> >>>> lyr.title = 'World Borders'
> >>>> lyr.abstract = 'World Test'
> >>>> lyr.queryable = True
> >>>> lyr.datasource =
> >>>> Shapefile(file='/var/mapnik/world_boundaries/world_boundaries_m')
> >>>> lyr.styles.append('My Style')
> >>>>
> >>>> m.layers.append(lyr)
> >>>>
> >>>> m.zoom_to_box(lyr.envelope())
> >>>> render_to_file(m, 'hello_world_in_pure_python.png')
> >>>> _______________________________________________
> >>>> Mapnik-devel mailing list
> >>>> Mapnik-devel at lists.berlios.de
> >>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
> >>>
> >>>
> >
> >
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080829/7c5df1be/attachment.html>

