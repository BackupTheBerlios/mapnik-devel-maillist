<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Mapnik-devel] Area center calculation
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/mapnik-devel/2010-October/index.html" >
   <LINK REL="made" HREF="mailto:mapnik-devel%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-devel%5D%20Area%20center%20calculation&In-Reply-To=%3C71D478F6-3F1F-4F69-A088-D66390D57EDD%40dbsgeo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001276.html">
   <LINK REL="Next"  HREF="001279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Mapnik-devel] Area center calculation</H1>
    <B>Dane Springmeyer</B> 
    <A HREF="mailto:mapnik-devel%40lists.berlios.de?Subject=Re%3A%20%5BMapnik-devel%5D%20Area%20center%20calculation&In-Reply-To=%3C71D478F6-3F1F-4F69-A088-D66390D57EDD%40dbsgeo.com%3E"
       TITLE="[Mapnik-devel] Area center calculation">dane at dbsgeo.com
       </A><BR>
    <I>Tue Oct 12 22:47:52 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001276.html">[Mapnik-devel] Area center calculation
</A></li>
        <LI>Next message: <A HREF="001279.html">[Mapnik-devel] Area center calculation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1277">[ date ]</a>
              <a href="thread.html#1277">[ thread ]</a>
              <a href="subject.html#1277">[ subject ]</a>
              <a href="author.html#1277">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 12, 2010, at 3:25 AM, Csongor Nemes wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I am contacting you regarding the calculation of centers of areas in OSM.
</I>&gt;<i> 
</I>
Hello Csongor,

Yes, I am aware of your application. I've yet to try it because it requires 4.0 I'm resisting upgrading to the 4.0 iOS as I have heard it is quite unstable of older iphones, but someday...

&gt;<i> Our product, OpenMaps (currently available on the iPhone and the iPod touch), is the only one which lets you tap on POIs on the map. We use the default OSM map as the default map type in our app, but the user can change to OpenCycleMap and OpenPisteMap as well; also the user can add custom map types (e.g. OSM Osmarender). We need to know the exact location of the symbol inside an area (currently we use an algorithm which doesn't always match the rendered symbol's location).
</I>
What algorithm do you use? Can you post an example?

How are you getting the actual coordinates of the area in the first place?

&gt;<i> The best solution (from our perspective) would be to request the calculated center from OSM, but I'm not sure that it's possible.
</I>
This seems like a good route - to ask the same server which rendered the tiles to tell you where the exact features are that were rendered.

&gt;<i> Otherwise we will implement the algorithm. If I'm not mistaken slightly different algorithms are implemented in different renderers.
</I>
I would also presume so. And each different stylesheet used for a given renderer is potentially going to show different POI's with different symbols of potentially different sizes - all of which impact which ones are placed and where.

&gt;<i> We are interested in the Mapnik version for now.
</I>
Well, as I allude to above I don't think this issue is as simple as the algorithm, but certainly click-ability of features is important and the algorithm will make a difference.

&gt;<i> Point me in the right direction, please; where can I find a description of the algorithm and which source files contain the implementation?
</I>
Mapnik uses a centroid calculation that can be viewed here:

<A HREF="http://trac.mapnik.org/browser/trunk/include/mapnik/geometry.hpp#L218">http://trac.mapnik.org/browser/trunk/include/mapnik/geometry.hpp#L218</A>

&gt;<i> 
</I>&gt;<i> We don't plan to maintain our own tile server in the near future. Also, I learned that there was some discussion about making the centering more intelligent, and it is possible that at some point the icon will be moved a bit additionally to find free space;
</I>
yes, this is certainly a possibility longer term.

&gt;<i> hence we would like to have a general solution in the long term.
</I>
I think the general or long term solution is to ask the server the for the exact x,y or bbox of rendered POIs. Hermann Kraus is the Mapnik developer that has given this quite a bit of thought, and in Mapnik trunk there is support he has added for outputting GeoJSON from Mapnik that will provide this information to be served along with tiles. 

Cheers,

Dane


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001276.html">[Mapnik-devel] Area center calculation
</A></li>
	<LI>Next message: <A HREF="001279.html">[Mapnik-devel] Area center calculation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1277">[ date ]</a>
              <a href="thread.html#1277">[ thread ]</a>
              <a href="subject.html#1277">[ subject ]</a>
              <a href="author.html#1277">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/mapnik-devel">More information about the Mapnik-devel
mailing list</a><br>
</body></html>
