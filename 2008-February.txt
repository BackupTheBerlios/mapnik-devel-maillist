From jochen at remote.org  Fri Feb  1 15:25:29 2008
From: jochen at remote.org (Jochen Topf)
Date: Fri, 1 Feb 2008 15:25:29 +0100
Subject: [Mapnik-devel] Compile error (problem with libpng)
Message-ID: <20080201142529.GA21594@eldorado.remote.org>

With Mapnik trunk I get a compiler error:

    /usr/include/pngconf.h:317: error: expected constructor, destructor, or
    type conversion before '.' token
    /usr/include/pngconf.h:318: error: '__dont__' does not name a type

Looking in pngconf.h I find the following:

    /* If you encounter a compiler error here, see the explanation
    * near the end of INSTALL.
    */

Looking in the libpng INSTALL file I see this:

   If you encounter a compiler error message complaining about the
   lines
         __png.h__ already includes setjmp.h;
         __dont__ include it again.;

   This means you have compiled another module that includes setjmp.h,
   which is hazardous because the two modules might not include exactly
   the same setjmp.h.  If you are sure that you know what you are doing
   and that they are exactly the same, then you can comment out or
   delete the two lines.  Better yet, use the cexcept interface
   instead, as demonstrated in contrib/visupng of the libpng distribution.

Jochen
-- 
Jochen Topf  jochen at remote.org  http://www.remote.org/jochen/  +49-721-388298



From jburgess at uklinux.net  Fri Feb  1 19:45:41 2008
From: jburgess at uklinux.net (Jon Burgess)
Date: Fri, 01 Feb 2008 18:45:41 +0000
Subject: [Mapnik-devel] Compile error (problem with libpng)
In-Reply-To: <20080201142529.GA21594@eldorado.remote.org>
References: <20080201142529.GA21594@eldorado.remote.org>
Message-ID: <1201891541.17492.24.camel@localhost.localdomain>


On Fri, 2008-02-01 at 15:25 +0100, Jochen Topf wrote:
> With Mapnik trunk I get a compiler error:
> 
>     /usr/include/pngconf.h:317: error: expected constructor, destructor, or
>     type conversion before '.' token
>     /usr/include/pngconf.h:318: error: '__dont__' does not name a type
> 
> Looking in pngconf.h I find the following:
> 
>     /* If you encounter a compiler error here, see the explanation
>     * near the end of INSTALL.
>     */
> 
> Looking in the libpng INSTALL file I see this:
> 
>    If you encounter a compiler error message complaining about the
>    lines
>          __png.h__ already includes setjmp.h;
>          __dont__ include it again.;
> 
>    This means you have compiled another module that includes setjmp.h,
>    which is hazardous because the two modules might not include exactly
>    the same setjmp.h.  If you are sure that you know what you are doing
>    and that they are exactly the same, then you can comment out or
>    delete the two lines.  Better yet, use the cexcept interface
>    instead, as demonstrated in contrib/visupng of the libpng distribution.
> 

Try:
http://lists.berlios.de/pipermail/mapnik-devel/2008-January/000456.html


> Jochen



From blake at hailmail.net  Fri Feb  1 21:10:49 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 1 Feb 2008 12:10:49 -0800
Subject: [Mapnik-devel] Compile error (problem with libpng)
In-Reply-To: <20080201142529.GA21594@eldorado.remote.org>
References: <20080201142529.GA21594@eldorado.remote.org>
Message-ID: <0503CC7D-B621-4881-ADF9-A97B769C2F08@hailmail.net>

I get the same error when compiling today's svn trunk on a fresh EC2  
instance of Ubuntu 7.10

Error below:

Cheers,
Dane

--------------------

root at domU-12-31-35-00-3D-72:/usr/src/mapnik# python scons/scons  
PGSQL_INCLUDES=/usr/include/postgresql/ PGSQL_LIBS=/usr/lib/ 
postgresqlscons: Reading SConscript files ...
Building on Linux ...
Checking for C library m... (cached) yes
Checking for C library ltdl... (cached) yes
Checking for C library png... (cached) yes
Checking for C library tiff... (cached) yes
Checking for C library z... (cached) yes
Checking for C library jpeg... (cached) yes
Checking for C library proj... (cached) yes
Checking for C library iconv... (cached) no
Checking for C library pq... yes
Checking for C++ library gdal... yes
Checking for C++ library boost_thread-mt... yes
Checking for C++ library boost_filesystem-mt... yes
Checking for C++ library boost_regex-mt... yes
Checking for C++ library boost_program_options-mt... yes
Bindings Python version... 2.5
Python 2.5 prefix... /usr
scons: done reading SConscript files.
scons: Building targets ...
g++ -o bindings/python/mapnik_image_view.os -c - 
DBOOST_PROPERTY_TREE_XML_PARSER_TINYXML -DTIXML_USE_STL -ansi -Wall - 
pthread -ftemplate-depth-100 -DLINUX -DBOOST_SPIRIT_THREADSAFE -O2 - 
finline-functions -Wno-inline -DNDEBUG -fPIC -I/usr/include/python2.5  
-Iagg/include -Itinyxml -Iinclude -I. -I/usr/include -I/usr/include/ 
postgresql -I/usr/local/include -I/usr/include/freetype2 bindings/ 
python/mapnik_image_view.cpp
/usr/local/include/pngconf.h:326: error: expected constructor,  
destructor, or type conversion before '.' token
/usr/local/include/pngconf.h:327: error: '__dont__' does not name a type
scons: *** [bindings/python/mapnik_image_view.os] Error 1
scons: building terminated because of errors.
root at domU-12-31-35-00-3D-72:/usr/src/mapnik#



On Feb 1, 2008, at 6:25 AM, Jochen Topf wrote:

> With Mapnik trunk I get a compiler error:
>
>     /usr/include/pngconf.h:317: error: expected constructor,  
> destructor, or
>     type conversion before '.' token
>     /usr/include/pngconf.h:318: error: '__dont__' does not name a type
>
> Looking in pngconf.h I find the following:
>
>     /* If you encounter a compiler error here, see the explanation
>     * near the end of INSTALL.
>     */
>
> Looking in the libpng INSTALL file I see this:
>
>    If you encounter a compiler error message complaining about the
>    lines
>          __png.h__ already includes setjmp.h;
>          __dont__ include it again.;
>
>    This means you have compiled another module that includes setjmp.h,
>    which is hazardous because the two modules might not include  
> exactly
>    the same setjmp.h.  If you are sure that you know what you are  
> doing
>    and that they are exactly the same, then you can comment out or
>    delete the two lines.  Better yet, use the cexcept interface
>    instead, as demonstrated in contrib/visupng of the libpng  
> distribution.
>
> Jochen
> -- 
> Jochen Topf  jochen at remote.org  http://www.remote.org/jochen/   
> +49-721-388298
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem at mapnik.org  Fri Feb  1 21:15:55 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 1 Feb 2008 20:15:55 +0000
Subject: [Mapnik-devel] Compile error (problem with libpng)
In-Reply-To: <0503CC7D-B621-4881-ADF9-A97B769C2F08@hailmail.net>
References: <20080201142529.GA21594@eldorado.remote.org>
	<0503CC7D-B621-4881-ADF9-A97B769C2F08@hailmail.net>
Message-ID: <3EA4EDE7-D9C4-4AFD-BEAC-3538EF04F05B@mapnik.org>

See : http://lists.berlios.de/pipermail/mapnik-devel/2008-January/ 
000456.html for workaround
Artem

On 1 Feb 2008, at 20:10, Dane Springmeyer wrote:

> I get the same error when compiling today's svn trunk on a fresh EC2
> instance of Ubuntu 7.10
>
> Error below:
>
> Cheers,
> Dane
>
> --------------------
>
> root at domU-12-31-35-00-3D-72:/usr/src/mapnik# python scons/scons
> PGSQL_INCLUDES=/usr/include/postgresql/ PGSQL_LIBS=/usr/lib/
> postgresqlscons: Reading SConscript files ...
> Building on Linux ...
> Checking for C library m... (cached) yes
> Checking for C library ltdl... (cached) yes
> Checking for C library png... (cached) yes
> Checking for C library tiff... (cached) yes
> Checking for C library z... (cached) yes
> Checking for C library jpeg... (cached) yes
> Checking for C library proj... (cached) yes
> Checking for C library iconv... (cached) no
> Checking for C library pq... yes
> Checking for C++ library gdal... yes
> Checking for C++ library boost_thread-mt... yes
> Checking for C++ library boost_filesystem-mt... yes
> Checking for C++ library boost_regex-mt... yes
> Checking for C++ library boost_program_options-mt... yes
> Bindings Python version... 2.5
> Python 2.5 prefix... /usr
> scons: done reading SConscript files.
> scons: Building targets ...
> g++ -o bindings/python/mapnik_image_view.os -c -
> DBOOST_PROPERTY_TREE_XML_PARSER_TINYXML -DTIXML_USE_STL -ansi -Wall -
> pthread -ftemplate-depth-100 -DLINUX -DBOOST_SPIRIT_THREADSAFE -O2 -
> finline-functions -Wno-inline -DNDEBUG -fPIC -I/usr/include/python2.5
> -Iagg/include -Itinyxml -Iinclude -I. -I/usr/include -I/usr/include/
> postgresql -I/usr/local/include -I/usr/include/freetype2 bindings/
> python/mapnik_image_view.cpp
> /usr/local/include/pngconf.h:326: error: expected constructor,
> destructor, or type conversion before '.' token
> /usr/local/include/pngconf.h:327: error: '__dont__' does not name a  
> type
> scons: *** [bindings/python/mapnik_image_view.os] Error 1
> scons: building terminated because of errors.
> root at domU-12-31-35-00-3D-72:/usr/src/mapnik#
>
>
>
> On Feb 1, 2008, at 6:25 AM, Jochen Topf wrote:
>
>> With Mapnik trunk I get a compiler error:
>>
>>     /usr/include/pngconf.h:317: error: expected constructor,
>> destructor, or
>>     type conversion before '.' token
>>     /usr/include/pngconf.h:318: error: '__dont__' does not name a  
>> type
>>
>> Looking in pngconf.h I find the following:
>>
>>     /* If you encounter a compiler error here, see the explanation
>>     * near the end of INSTALL.
>>     */
>>
>> Looking in the libpng INSTALL file I see this:
>>
>>    If you encounter a compiler error message complaining about the
>>    lines
>>          __png.h__ already includes setjmp.h;
>>          __dont__ include it again.;
>>
>>    This means you have compiled another module that includes  
>> setjmp.h,
>>    which is hazardous because the two modules might not include
>> exactly
>>    the same setjmp.h.  If you are sure that you know what you are
>> doing
>>    and that they are exactly the same, then you can comment out or
>>    delete the two lines.  Better yet, use the cexcept interface
>>    instead, as demonstrated in contrib/visupng of the libpng
>> distribution.
>>
>> Jochen
>> -- 
>> Jochen Topf  jochen at remote.org  http://www.remote.org/jochen/
>> +49-721-388298
>>
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Sun Feb  3 18:50:32 2008
From: tom at compton.nu (Tom Hughes)
Date: Sun, 3 Feb 2008 17:50:32 +0000
Subject: [Mapnik-devel] Protect access to proj4 with a mutex
Message-ID: <d82f70760802030950p5674bbdbn607675023ff6de2d@mail.gmail.com>

The attached patch adds a global mutex to protect all access to the
proj4 library and ensure that only one thread can be inside a call to
the library at a time.

Jon Burgess has confirmed that this fixes the the rendering problems
he was seeing when trying to do multithreaded rendering.

The problem (as discovered with valgrind's helgrind tool) is that the
library has a global error variable called pj_errno and if one thread
writes to that and then another one reads it then the wrong thread can
think it has seen an error and things go pear shaped.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: mapnik-projection-lock.patch
Type: text/x-patch
Size: 2933 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080203/c0e7c2c4/attachment.bin>

From artem at mapnik.org  Mon Feb  4 10:54:55 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Mon, 4 Feb 2008 09:54:55 +0000
Subject: [Mapnik-devel] Protect access to proj4 with a mutex
In-Reply-To: <d82f70760802030950p5674bbdbn607675023ff6de2d@mail.gmail.com>
References: <d82f70760802030950p5674bbdbn607675023ff6de2d@mail.gmail.com>
Message-ID: <B71A0117-CAEA-43FA-8604-A2EA116EE1BB@mapnik.org>


> The attached patch adds a global mutex to protect all access to the
> proj4 library and ensure that only one thread can be inside a call to
> the library at a time.
>
> Jon Burgess has confirmed that this fixes the the rendering problems
> he was seeing when trying to do multithreaded rendering.
>
> The problem (as discovered with valgrind's helgrind tool) is that the
> library has a global error variable called pj_errno and if one thread
> writes to that and then another one reads it then the wrong thread can
> think it has seen an error and things go pear shaped.

Hi Tom,

Thanks for the patch. Somehow I was hoping that only initialization  
parts of libproj4 are problematic, but it looks like fundamental  
design flaw.
Having mutex locks for each coordinate transformation sounds  
expensive to me, buy we have no real alternatives at the moment.

So, here is my plan:
1. apply your patch
2. provide an optional  flag (at compile time) to build core library  
and data source plug-ins as multithreaded, applying synchronization  
where appropriate and linking to multithreaded versions of boost, or  
single threaded. For example, there is no much to gain from  
supporting multiple threads in Python bindings - all calls are  
already protected by GIL (global interpreter lock).  In fact, the  
above will improve bindings performance.

In a long run, we'll have to make a decision whether using proj4 is a  
good idea.
>
> Tom
>
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/<mapnik-projection-lock.patch>________

Artem

> _______________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From tom at compton.nu  Mon Feb  4 11:23:41 2008
From: tom at compton.nu (Tom Hughes)
Date: Mon, 04 Feb 2008 10:23:41 +0000
Subject: [Mapnik-devel] Protect access to proj4 with a mutex
In-Reply-To: <B71A0117-CAEA-43FA-8604-A2EA116EE1BB@mapnik.org> (Artem
	Pavlenko's message of "Mon\, 4 Feb 2008 09\:54\:55 +0000")
References: <d82f70760802030950p5674bbdbn607675023ff6de2d@mail.gmail.com>
	<B71A0117-CAEA-43FA-8604-A2EA116EE1BB@mapnik.org>
Message-ID: <yekve55uij6.fsf@dellow.uk.cyberscience.com>

In message <B71A0117-CAEA-43FA-8604-A2EA116EE1BB at mapnik.org>
        Artem Pavlenko <artem at mapnik.org> wrote:

> Thanks for the patch. Somehow I was hoping that only initialization
> parts of libproj4 are problematic, but it looks like fundamental
> design flaw.

It is pretty nasty, yes. Jon and I were discussing solutions
on IRC yesterday and he found an old thread on a proj4 mailing
list about it as well.

One fairly simple (but tedious) partial solution is to alter
proj4 to have an errno member in the projection handle that 
most of the routine use - that way you only have to ensure that
you don't try and call two proj4 functions on the same handle
at the same time. The main problem then is pj_init which needs
to do error handling before any handle exists.

> Having mutex locks for each coordinate transformation sounds
> expensive to me, buy we have no real alternatives at the moment.
>
> So, here is my plan:
> 1. apply your patch
> 2. provide an optional  flag (at compile time) to build core library
> and data source plug-ins as multithreaded, applying synchronization
> where appropriate and linking to multithreaded versions of boost, or
> single threaded. For example, there is no much to gain from
> supporting multiple threads in Python bindings - all calls are
> already protected by GIL (global interpreter lock).  In fact, the
> above will improve bindings performance.
>
> In a long run, we'll have to make a decision whether using proj4 is a
> good idea.

Sounds like a good plan - we can always improve things later if
proj4 can be improved.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From dom at earth.li  Tue Feb  5 01:40:19 2008
From: dom at earth.li (Dominic Hargreaves)
Date: Tue, 5 Feb 2008 00:40:19 +0000
Subject: [Mapnik-devel] mapnik release
In-Reply-To: <1559F549-47E0-4538-8C04-8E0B2FCB5B46@gmail.com>
References: <OF0A6F1DB1.0AD562C0-ON802573DB.003BBF88-802573DB.003C4019@solent-university.ac.uk>
	<20080125142000.GT4317@urchin.earth.li>
	<238F16EE-01DF-4777-BB59-DC4BBF93F3CC@gmail.com>
	<20080126200643.GC4317@urchin.earth.li>
	<03ECD4F0-A28E-4EA6-87B0-C2AA36B980C6@gmail.com>
	<20080127002626.GF4317@urchin.earth.li>
	<1559F549-47E0-4538-8C04-8E0B2FCB5B46@gmail.com>
Message-ID: <20080205004019.GT4154@urchin.earth.li>

On Sun, Jan 27, 2008 at 03:53:08PM +0000, Artem Pavlenko wrote:
> On 27 Jan 2008, at 00:26, Dominic Hargreaves wrote:
> 
> >On Sat, Jan 26, 2008 at 08:24:28PM +0000, Artem Pavlenko wrote:
> >>
> >>On 26 Jan 2008, at 20:06, Dominic Hargreaves wrote:
> >>>Alternatively, would it make most sense to ship the plugins as  
> >>>part of
> >>>the main library? Is there any other way they could be used other  
> >>>than
> >>>as part of the main library?
> >>
> >>Part of core libmapnik I think. Theoretically, of course it is
> >>possible to use them separately but in practice they're tightly
> >>linked to Mapnik.
> >
> >Hrm, this presents a bit of a problem for people using the plugins,
> >since the plugin path is currently hardcoded in places to be
> >/usr/lib/mapnik/input, and it would be a shame to have to have people
> >modify their code when using a new release.
> >
> >Would it be possible to change things so that the library knows  
> >where to
> >find plugins by itself, eg with a register_default_datasources?  
> >Then the
> >code could automatically look in, eg, /usr/lib/mapnik/0.5/input.
> >
> Should we have MAPNIK_VERSION defined somewhere ? What people think?

What I've done for now is included a 'mapnik-plugin-base' shell script
into libmapnik-dev, which spits out the correct path, so this can be
used at compile time by other packages to get the correct location. It's
not particularly great, but it'll do.

Dominic.

-- 
Dominic Hargreaves | http://www.larted.org.uk/~dom/
PGP key 5178E2A5 from the.earth.li (keyserver,web,email)


From artem at mapnik.org  Tue Feb  5 15:00:08 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Tue, 5 Feb 2008 14:00:08 +0000
Subject: [Mapnik-devel] mapnik release
In-Reply-To: <20080205004019.GT4154@urchin.earth.li>
References: <OF0A6F1DB1.0AD562C0-ON802573DB.003BBF88-802573DB.003C4019@solent-university.ac.uk>
	<20080125142000.GT4317@urchin.earth.li>
	<238F16EE-01DF-4777-BB59-DC4BBF93F3CC@gmail.com>
	<20080126200643.GC4317@urchin.earth.li>
	<03ECD4F0-A28E-4EA6-87B0-C2AA36B980C6@gmail.com>
	<20080127002626.GF4317@urchin.earth.li>
	<1559F549-47E0-4538-8C04-8E0B2FCB5B46@gmail.com>
	<20080205004019.GT4154@urchin.earth.li>
Message-ID: <30BE500C-72F0-41B2-8003-2C3F1E449097@mapnik.org>


On 5 Feb 2008, at 00:40, Dominic Hargreaves wrote:

> On Sun, Jan 27, 2008 at 03:53:08PM +0000, Artem Pavlenko wrote:
>> On 27 Jan 2008, at 00:26, Dominic Hargreaves wrote:
>>
>>> On Sat, Jan 26, 2008 at 08:24:28PM +0000, Artem Pavlenko wrote:
>>>>
>>>> On 26 Jan 2008, at 20:06, Dominic Hargreaves wrote:
>>>>> Alternatively, would it make most sense to ship the plugins as
>>>>> part of
>>>>> the main library? Is there any other way they could be used other
>>>>> than
>>>>> as part of the main library?
>>>>
>>>> Part of core libmapnik I think. Theoretically, of course it is
>>>> possible to use them separately but in practice they're tightly
>>>> linked to Mapnik.
>>>
>>> Hrm, this presents a bit of a problem for people using the plugins,
>>> since the plugin path is currently hardcoded in places to be
>>> /usr/lib/mapnik/input, and it would be a shame to have to have  
>>> people
>>> modify their code when using a new release.
>>>
>>> Would it be possible to change things so that the library knows
>>> where to
>>> find plugins by itself, eg with a register_default_datasources?
>>> Then the
>>> code could automatically look in, eg, /usr/lib/mapnik/0.5/input.
>>>
>> Should we have MAPNIK_VERSION defined somewhere ? What people think?
>
> What I've done for now is included a 'mapnik-plugin-base' shell script
> into libmapnik-dev, which spits out the correct path, so this can be
> used at compile time by other packages to get the correct location.  
> It's
> not particularly great, but it'll do.
>
> Dominic.

Thanks, Dom.
Artem
>
> -- 
> Dominic Hargreaves | http://www.larted.org.uk/~dom/
> PGP key 5178E2A5 from the.earth.li (keyserver,web,email)
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From artem at mapnik.org  Thu Feb  7 12:52:20 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Thu, 7 Feb 2008 11:52:20 +0000
Subject: [Mapnik-devel] r616 incorrect?
In-Reply-To: <d82f70760801301640j4ad1885cx41e41d36be5785dc@mail.gmail.com>
References: <d82f70760801301640j4ad1885cx41e41d36be5785dc@mail.gmail.com>
Message-ID: <39F47131-A438-422F-A31E-D20E333D7A4B@mapnik.org>


On 31 Jan 2008, at 00:40, Tom Hughes wrote:

> Revision 616 alters bindings/python/SConscript to prefix DESTDIR onto
> the value of mapniklibpath in the generated paths.py file.
>
> This seems to be wrong though - DESTDIR is a temporary prefix during
> package creation and shouldn't be encoded in any paths that will part
> of the installed software.

Yep, fixed in r645
Thanks
Artem
>
> Tom
>
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From jburgess777 at googlemail.com  Mon Feb 11 23:00:39 2008
From: jburgess777 at googlemail.com (Jon Burgess)
Date: Mon, 11 Feb 2008 22:00:39 +0000
Subject: [Mapnik-devel] updating the dejavu fonts?
Message-ID: <1202767239.3480.21.camel@localhost.localdomain>

After some prompting on IRC I updated the DejaVu fonts being used by the
OSM Mapnik renderer to the latest 2.23 release[1]. Mapnik ships with
version 2.14.

More names now seem to be rendering correctly on the map[2]. 

Should the Mapnik fonts be updated?

	Jon


[1] http://dejavu.sourceforge.net/wiki/index.php/Download 
[2] http://www.openstreetmap.org/?lat=41.78&lon=44.925&zoom=9&layers=B0FT






From artem at mapnik.org  Mon Feb 11 23:11:17 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Mon, 11 Feb 2008 22:11:17 +0000
Subject: [Mapnik-devel] updating the dejavu fonts?
In-Reply-To: <1202767239.3480.21.camel@localhost.localdomain>
References: <1202767239.3480.21.camel@localhost.localdomain>
Message-ID: <1D295975-6EA1-49DF-9171-7FC151675C95@mapnik.org>


On 11 Feb 2008, at 22:00, Jon Burgess wrote:

> After some prompting on IRC I updated the DejaVu fonts being used  
> by the
> OSM Mapnik renderer to the latest 2.23 release[1]. Mapnik ships with
> version 2.14.
>
> More names now seem to be rendering correctly on the map[2].

Wow, Armenian script looks cool.
>
> Should the Mapnik fonts be updated?
>

Yes.


> 	Jon
>


I was playing with ICU library today and it looks very promising. It  
can do proper BIDI in mixed strings, for example - english name  
followed by arabic and 'shaping' .  My plan is to use UnicodeString  
instead of std::wstring internally and stop relying on iconv and  
fribidi.
Artem

>
> [1] http://dejavu.sourceforge.net/wiki/index.php/Download
> [2] http://www.openstreetmap.org/? 
> lat=41.78&lon=44.925&zoom=9&layers=B0FT
>
>
>
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From kleptog at gmail.com  Thu Feb 14 17:25:00 2008
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Thu, 14 Feb 2008 17:25:00 +0100
Subject: [Mapnik-devel] Shapefile output check
Message-ID: <2fc2c5f10802140825i2b989f8nd42597e6abec3a4c@mail.gmail.com>

Several times I've noticed that shapeindex doesn't notice if the
outputting fails  i.e. you get a file of zero size. I don't know much
about C++ but I think the following should at least cause it to bail
what that happens (usually disk full).

Thanks in advance,
-- 
Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: shapeindex.patch
Type: text/x-patch
Size: 500 bytes
Desc: not available
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080214/6b969454/attachment.bin>

From kms at passback.co.uk  Thu Feb 14 15:07:45 2008
From: kms at passback.co.uk (Keith Sharp)
Date: Thu, 14 Feb 2008 14:07:45 +0000
Subject: [Mapnik-devel] updating the dejavu fonts?
In-Reply-To: <1202767239.3480.21.camel@localhost.localdomain>
References: <1202767239.3480.21.camel@localhost.localdomain>
Message-ID: <1202998065.30005.4.camel@kmsharp-xp.cisco.com>


On Mon, 2008-02-11 at 22:00 +0000, Jon Burgess wrote:
> After some prompting on IRC I updated the DejaVu fonts being used by the
> OSM Mapnik renderer to the latest 2.23 release[1]. Mapnik ships with
> version 2.14.
> 
> More names now seem to be rendering correctly on the map[2]. 
> 
> Should the Mapnik fonts be updated?

Mapnik should just use the system version of fonts rather than including
its own copies.

Just my 2p worth...

Keith.



From blake at hailmail.net  Sat Feb 16 00:06:33 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 15 Feb 2008 15:06:33 -0800
Subject: [Mapnik-devel] Mac 10.4 build problem with boost
In-Reply-To: <44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
Message-ID: <538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>

Trying to build mapnik on 10.4.11

I'm running into a problem directing scons.py to find my boost installs.

Can anyone spot what might be going wrong?

-------

spring-2:~/src/mapnik_feb15 spring$ python scons/scons.py  
JPEG_INCLUDES=/Library/Frameworks/UnixImageIO.framework/unix/include  
JPEG_LIBS=/Library/Frameworks/UnixImageIO.framework/unix/lib  
PGSQL_INCLUDES=/usr/local/pgsql/include PGSQL_LIBS=/usr/local/pgsql/ 
lib BOOST_INCLUDES=/opt/local/include/boost-1_34_1 BOOST_LIBS=/opt/ 
local/lib
scons: Reading SConscript files ...
Building on Darwin ...
Checking for C library m... yes
Checking for C library ltdl... yes
Checking for C library png... yes
Checking for C library tiff... yes
Checking for C library z... yes
Checking for C library jpeg... yes
Checking for C library proj... yes
Checking for C library iconv... yes
Checking for C library pq... yes
Checking for C++ library gdal... yes
Checking for C++ library boost_filesystem-mt... no
Could not find header or shared library for boost filesystem, exiting!

-------


I installed boost using MACPORTS which put headers here, for example:

/opt/local/include/boost-1_34_1/boost/filesystem/operations.hpp
/opt/local/include/boost-1_34_1/boost/regex.hpp

and put libraries and symlinks here:

/opt/local/lib...

spring-2:~/src/mapnik_feb15 spring$ ls -l /opt/local/lib/ 
libboost_filesystem*

-rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-1_34_1.a
-rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-1_34_1.dylib
-rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-d-1_34_1.a
-rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-d-1_34_1.dylib
lrwxr-xr-x   1 root  admin     165 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-d.a -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.a
lrwxr-xr-x   1 root  admin     169 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-d.dylib -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.dylib
-rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-mt-1_34_1.a
-rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-mt-1_34_1.dylib
-rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-mt-d-1_34_1.a
-rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/ 
libboost_filesystem-mt-d-1_34_1.dylib
lrwxr-xr-x   1 root  admin     168 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-mt-d.a -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.a
lrwxr-xr-x   1 root  admin     172 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-mt-d.dylib -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.dylib
lrwxr-xr-x   1 root  admin     166 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-mt.a -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.a
lrwxr-xr-x   1 root  admin     170 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem-mt.dylib -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.dylib
lrwxr-xr-x   1 root  admin     163 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem.a -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.a
lrwxr-xr-x   1 root  admin     167 Feb 15 12:13 /opt/local/lib/ 
libboost_filesystem.dylib -> /opt/local/var/macports/build/ 
_opt_local_var_macports_sources_rsync.macports.org_release_ports_devel_b 
oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.dylib



From artem at mapnik.org  Wed Feb 20 10:35:31 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Wed, 20 Feb 2008 09:35:31 +0000
Subject: [Mapnik-devel] Shapefile output check
In-Reply-To: <2fc2c5f10802140825i2b989f8nd42597e6abec3a4c@mail.gmail.com>
References: <2fc2c5f10802140825i2b989f8nd42597e6abec3a4c@mail.gmail.com>
Message-ID: <DE91AF02-05CF-45E1-97FA-881594A071B1@mapnik.org>


On 14 Feb 2008, at 16:25, Martijn van Oosterhout wrote:

> Several times I've noticed that shapeindex doesn't notice if the
> outputting fails  i.e. you get a file of zero size. I don't know much
> about C++ but I think the following should at least cause it to bail
> what that happens (usually disk full).
>
> Thanks in advance,

Martijn, thanks.
Applied in r653
Artem

> --  
> Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/ 
> <shapeindex.patch>_______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem at mapnik.org  Wed Feb 20 10:50:44 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Wed, 20 Feb 2008 09:50:44 +0000
Subject: [Mapnik-devel] updating the dejavu fonts?
In-Reply-To: <1202998065.30005.4.camel@kmsharp-xp.cisco.com>
References: <1202767239.3480.21.camel@localhost.localdomain>
	<1202998065.30005.4.camel@kmsharp-xp.cisco.com>
Message-ID: <0BEAFBC8-5BE7-4D0E-95DB-033A62B01571@mapnik.org>


On 14 Feb 2008, at 14:07, Keith Sharp wrote:

>
> On Mon, 2008-02-11 at 22:00 +0000, Jon Burgess wrote:
>> After some prompting on IRC I updated the DejaVu fonts being used  
>> by the
>> OSM Mapnik renderer to the latest 2.23 release[1]. Mapnik ships with
>> version 2.14.
>>
>> More names now seem to be rendering correctly on the map[2].
>>
>> Should the Mapnik fonts be updated?
>
> Mapnik should just use the system version of fonts rather than  
> including
> its own copies.
>
> Just my 2p worth...
>
> Keith.

Keith,

On Linux, FreeBSD etc - yes, we should use system fonts ( this is  
what Debian packages do ??)
On Windows, OS X I think it's nice to give people a choice to use  
Free fonts .

Hmm.. what do others think about it ?

Artem

> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Wed Feb 20 10:51:23 2008
From: tom at compton.nu (Tom Hughes)
Date: Wed, 20 Feb 2008 09:51:23 +0000
Subject: [Mapnik-devel] Shapefile output check
In-Reply-To: <DE91AF02-05CF-45E1-97FA-881594A071B1@mapnik.org> (Artem
	Pavlenko's message of "Wed\, 20 Feb 2008 09\:35\:31 +0000")
References: <2fc2c5f10802140825i2b989f8nd42597e6abec3a4c@mail.gmail.com>
	<DE91AF02-05CF-45E1-97FA-881594A071B1@mapnik.org>
Message-ID: <yekir0k6jms.fsf@dellow.uk.cyberscience.com>

In message <DE91AF02-05CF-45E1-97FA-881594A071B1 at mapnik.org>
        Artem Pavlenko <artem at mapnik.org> wrote:

> On 14 Feb 2008, at 16:25, Martijn van Oosterhout wrote:
>
>> Several times I've noticed that shapeindex doesn't notice if the
>> outputting fails  i.e. you get a file of zero size. I don't know much
>> about C++ but I think the following should at least cause it to bail
>> what that happens (usually disk full).
>>
>> Thanks in advance,
>
> Martijn, thanks.
> Applied in r653

It seems to be short a few std:: prefixes:

utils/shapeindex/shapeindex.cpp: In function `int main(int, char**)':
utils/shapeindex/shapeindex.cpp:213: error: `ios' has not been declared
utils/shapeindex/shapeindex.cpp:213: error: `ios' has not been declared

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From artem at mapnik.org  Wed Feb 20 10:57:58 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Wed, 20 Feb 2008 09:57:58 +0000
Subject: [Mapnik-devel] Shapefile output check
In-Reply-To: <yekir0k6jms.fsf@dellow.uk.cyberscience.com>
References: <2fc2c5f10802140825i2b989f8nd42597e6abec3a4c@mail.gmail.com>
	<DE91AF02-05CF-45E1-97FA-881594A071B1@mapnik.org>
	<yekir0k6jms.fsf@dellow.uk.cyberscience.com>
Message-ID: <8B774DC4-3D4E-4C03-8F90-CCF8A94DBBFD@mapnik.org>


On 20 Feb 2008, at 09:51, Tom Hughes wrote:

> In message <DE91AF02-05CF-45E1-97FA-881594A071B1 at mapnik.org>
>         Artem Pavlenko <artem at mapnik.org> wrote:
>
>> On 14 Feb 2008, at 16:25, Martijn van Oosterhout wrote:
>>
>>> Several times I've noticed that shapeindex doesn't notice if the
>>> outputting fails  i.e. you get a file of zero size. I don't know  
>>> much
>>> about C++ but I think the following should at least cause it to bail
>>> what that happens (usually disk full).
>>>
>>> Thanks in advance,
>>
>> Martijn, thanks.
>> Applied in r653
>
> It seems to be short a few std:: prefixes:
>
> utils/shapeindex/shapeindex.cpp: In function `int main(int, char**)':
> utils/shapeindex/shapeindex.cpp:213: error: `ios' has not been  
> declared
> utils/shapeindex/shapeindex.cpp:213: error: `ios' has not been  
> declared
>
> Tom

Opps, thanks. This is what happens when committing without testing.
fixed in r654
Artem
>
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From artem at mapnik.org  Wed Feb 20 11:03:01 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Wed, 20 Feb 2008 10:03:01 +0000
Subject: [Mapnik-devel] Mac 10.4 build problem with boost
In-Reply-To: <538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
Message-ID: <C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>

Hi Dane,

Sometimes scons fails to update cache, could you try :

rm -rf .scons*

and try again.

You boost installation looks fine.
Cheers
Artem

On 15 Feb 2008, at 23:06, Dane Springmeyer wrote:

> Trying to build mapnik on 10.4.11
>
> I'm running into a problem directing scons.py to find my boost  
> installs.
>
> Can anyone spot what might be going wrong?
>
> -------
>
> spring-2:~/src/mapnik_feb15 spring$ python scons/scons.py
> JPEG_INCLUDES=/Library/Frameworks/UnixImageIO.framework/unix/include
> JPEG_LIBS=/Library/Frameworks/UnixImageIO.framework/unix/lib
> PGSQL_INCLUDES=/usr/local/pgsql/include PGSQL_LIBS=/usr/local/pgsql/
> lib BOOST_INCLUDES=/opt/local/include/boost-1_34_1 BOOST_LIBS=/opt/
> local/lib
> scons: Reading SConscript files ...
> Building on Darwin ...
> Checking for C library m... yes
> Checking for C library ltdl... yes
> Checking for C library png... yes
> Checking for C library tiff... yes
> Checking for C library z... yes
> Checking for C library jpeg... yes
> Checking for C library proj... yes
> Checking for C library iconv... yes
> Checking for C library pq... yes
> Checking for C++ library gdal... yes
> Checking for C++ library boost_filesystem-mt... no
> Could not find header or shared library for boost filesystem, exiting!
>
> -------
>
>
> I installed boost using MACPORTS which put headers here, for example:
>
> /opt/local/include/boost-1_34_1/boost/filesystem/operations.hpp
> /opt/local/include/boost-1_34_1/boost/regex.hpp
>
> and put libraries and symlinks here:
>
> /opt/local/lib...
>
> spring-2:~/src/mapnik_feb15 spring$ ls -l /opt/local/lib/
> libboost_filesystem*
>
> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-1_34_1.a
> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-1_34_1.dylib
> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-d-1_34_1.a
> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-d-1_34_1.dylib
> lrwxr-xr-x   1 root  admin     165 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-d.a -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.a
> lrwxr-xr-x   1 root  admin     169 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-d.dylib -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.dylib
> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-mt-1_34_1.a
> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-mt-1_34_1.dylib
> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-mt-d-1_34_1.a
> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
> libboost_filesystem-mt-d-1_34_1.dylib
> lrwxr-xr-x   1 root  admin     168 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-mt-d.a -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.a
> lrwxr-xr-x   1 root  admin     172 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-mt-d.dylib -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.dylib
> lrwxr-xr-x   1 root  admin     166 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-mt.a -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.a
> lrwxr-xr-x   1 root  admin     170 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem-mt.dylib -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.dylib
> lrwxr-xr-x   1 root  admin     163 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem.a -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.a
> lrwxr-xr-x   1 root  admin     167 Feb 15 12:13 /opt/local/lib/
> libboost_filesystem.dylib -> /opt/local/var/macports/build/
> _opt_local_var_macports_sources_rsync.macports.org_release_ports_devel 
> _b
> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.dylib
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From blake at hailmail.net  Wed Feb 20 16:59:44 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Wed, 20 Feb 2008 07:59:44 -0800
Subject: [Mapnik-devel] Mac 10.4 build problem with boost
In-Reply-To: <C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
Message-ID: <3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>

Hi Artem,

Thanks for the suggestion. I'll try that next.

My hunch still is that the macports install of liboost has some  
symlinking problems, as I've discussed it on IRC with macports folks  
and recommended filing a bug (http://trac.macosforge.org/projects/macports/ticket/14365 
).

If the cache rebuild does not work I think I'll try rebuilding the  
symlinks in opt/local/lib.

What lib name does scons look for exactly?  For the Filesystem, for  
example. does scons look for

path-to-boost/liblibboost_filesystem-mt.dylib

or

path-to-boost/lib/libboost_filesystem.dylib?

Also, for reference I'm now running 10.5 and still have this same  
problem.

Thanks,

Dane



On Feb 20, 2008, at 2:03 AM, Artem Pavlenko wrote:

> Hi Dane,
>
> Sometimes scons fails to update cache, could you try :
>
> rm -rf .scons*
>
> and try again.
>
> You boost installation looks fine.
> Cheers
> Artem
>
> On 15 Feb 2008, at 23:06, Dane Springmeyer wrote:
>
>> Trying to build mapnik on 10.4.11
>>
>> I'm running into a problem directing scons.py to find my boost  
>> installs.
>>
>> Can anyone spot what might be going wrong?
>>
>> -------
>>
>> spring-2:~/src/mapnik_feb15 spring$ python scons/scons.py
>> JPEG_INCLUDES=/Library/Frameworks/UnixImageIO.framework/unix/include
>> JPEG_LIBS=/Library/Frameworks/UnixImageIO.framework/unix/lib
>> PGSQL_INCLUDES=/usr/local/pgsql/include PGSQL_LIBS=/usr/local/pgsql/
>> lib BOOST_INCLUDES=/opt/local/include/boost-1_34_1 BOOST_LIBS=/opt/
>> local/lib
>> scons: Reading SConscript files ...
>> Building on Darwin ...
>> Checking for C library m... yes
>> Checking for C library ltdl... yes
>> Checking for C library png... yes
>> Checking for C library tiff... yes
>> Checking for C library z... yes
>> Checking for C library jpeg... yes
>> Checking for C library proj... yes
>> Checking for C library iconv... yes
>> Checking for C library pq... yes
>> Checking for C++ library gdal... yes
>> Checking for C++ library boost_filesystem-mt... no
>> Could not find header or shared library for boost filesystem,  
>> exiting!
>>
>> -------
>>
>>
>> I installed boost using MACPORTS which put headers here, for example:
>>
>> /opt/local/include/boost-1_34_1/boost/filesystem/operations.hpp
>> /opt/local/include/boost-1_34_1/boost/regex.hpp
>>
>> and put libraries and symlinks here:
>>
>> /opt/local/lib...
>>
>> spring-2:~/src/mapnik_feb15 spring$ ls -l /opt/local/lib/
>> libboost_filesystem*
>>
>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-1_34_1.a
>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-1_34_1.dylib
>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-d-1_34_1.a
>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-d-1_34_1.dylib
>> lrwxr-xr-x   1 root  admin     165 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-d.a -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.a
>> lrwxr-xr-x   1 root  admin     169 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-d.dylib -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.dylib
>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-mt-1_34_1.a
>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-mt-1_34_1.dylib
>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-mt-d-1_34_1.a
>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>> libboost_filesystem-mt-d-1_34_1.dylib
>> lrwxr-xr-x   1 root  admin     168 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-mt-d.a -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.a
>> lrwxr-xr-x   1 root  admin     172 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-mt-d.dylib -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt- 
>> d-1_34_1.dylib
>> lrwxr-xr-x   1 root  admin     166 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-mt.a -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.a
>> lrwxr-xr-x   1 root  admin     170 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem-mt.dylib -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.dylib
>> lrwxr-xr-x   1 root  admin     163 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem.a -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.a
>> lrwxr-xr-x   1 root  admin     167 Feb 15 12:13 /opt/local/lib/
>> libboost_filesystem.dylib -> /opt/local/var/macports/build/
>> _opt_local_var_macports_sources_rsync 
>> .macports.org_release_ports_devel_b
>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.dylib
>>
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>
>



From blake at hailmail.net  Fri Feb 22 07:43:54 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Thu, 21 Feb 2008 22:43:54 -0800
Subject: [Mapnik-devel] Mac 10.4 build problem with boost
In-Reply-To: <3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
Message-ID: <A60361FC-1F47-4A92-8BB4-109BBC9AA848@hailmail.net>

Artem,

I'm glad to report that the problem with scons.py not finding the  
boost libs and includes is solved and I've finally got a working  
install of mapnik on Mac OS 10.5.

There was a bug in macports that is now fixed (http://trac.macosforge.org/projects/macports/ticket/14365 
). In addition macports requires installing the python bindings to  
boost through the -v for variant flag.

So to build on mac leopard, either with release 0.5 or svn I now can  
simply do:

sudo port install boost-jam #note there is still a dependency problem  
in macports where you must build boost-jam first
sudo port install -v boost +python25 +icu
svn co svn://svn.mapnik.org/trunk mapnik
cd mapnik
python scons/scons.py
python scons/scons.py PGSQL_INCLUDES=/usr/local/pgsql/include  
PGSQL_LIBS=/usr/local/pgsql/lib
sudo python scons/scons.py install PGSQL_INCLUDES=/usr/local/pgsql/ 
include PGSQL_LIBS=/usr/local/pgsql/lib

then:
copy this folder /System/Library/Frameworks/Python.framework/Versions/ 
2.5/lib/python2.5/site-packages/mapnik/$golden
to
/Library/Python/2.5/site-packages/


When you get a chance, you should document the addition of ICU to the  
INSTALL.txt in svn.

Cheers,

Dane


On Feb 20, 2008, at 7:59 AM, Dane Springmeyer wrote:

> Hi Artem,
>
> Thanks for the suggestion. I'll try that next.
>
> My hunch still is that the macports install of liboost has some
> symlinking problems, as I've discussed it on IRC with macports folks
> and recommended filing a bug (http://trac.macosforge.org/projects/macports/ticket/14365
> ).
>
> If the cache rebuild does not work I think I'll try rebuilding the
> symlinks in opt/local/lib.
>
> What lib name does scons look for exactly?  For the Filesystem, for
> example. does scons look for
>
> path-to-boost/liblibboost_filesystem-mt.dylib
>
> or
>
> path-to-boost/lib/libboost_filesystem.dylib?
>
> Also, for reference I'm now running 10.5 and still have this same
> problem.
>
> Thanks,
>
> Dane
>
>
>
> On Feb 20, 2008, at 2:03 AM, Artem Pavlenko wrote:
>
>> Hi Dane,
>>
>> Sometimes scons fails to update cache, could you try :
>>
>> rm -rf .scons*
>>
>> and try again.
>>
>> You boost installation looks fine.
>> Cheers
>> Artem
>>
>> On 15 Feb 2008, at 23:06, Dane Springmeyer wrote:
>>
>>> Trying to build mapnik on 10.4.11
>>>
>>> I'm running into a problem directing scons.py to find my boost
>>> installs.
>>>
>>> Can anyone spot what might be going wrong?
>>>
>>> -------
>>>
>>> spring-2:~/src/mapnik_feb15 spring$ python scons/scons.py
>>> JPEG_INCLUDES=/Library/Frameworks/UnixImageIO.framework/unix/include
>>> JPEG_LIBS=/Library/Frameworks/UnixImageIO.framework/unix/lib
>>> PGSQL_INCLUDES=/usr/local/pgsql/include PGSQL_LIBS=/usr/local/pgsql/
>>> lib BOOST_INCLUDES=/opt/local/include/boost-1_34_1 BOOST_LIBS=/opt/
>>> local/lib
>>> scons: Reading SConscript files ...
>>> Building on Darwin ...
>>> Checking for C library m... yes
>>> Checking for C library ltdl... yes
>>> Checking for C library png... yes
>>> Checking for C library tiff... yes
>>> Checking for C library z... yes
>>> Checking for C library jpeg... yes
>>> Checking for C library proj... yes
>>> Checking for C library iconv... yes
>>> Checking for C library pq... yes
>>> Checking for C++ library gdal... yes
>>> Checking for C++ library boost_filesystem-mt... no
>>> Could not find header or shared library for boost filesystem,
>>> exiting!
>>>
>>> -------
>>>
>>>
>>> I installed boost using MACPORTS which put headers here, for  
>>> example:
>>>
>>> /opt/local/include/boost-1_34_1/boost/filesystem/operations.hpp
>>> /opt/local/include/boost-1_34_1/boost/regex.hpp
>>>
>>> and put libraries and symlinks here:
>>>
>>> /opt/local/lib...
>>>
>>> spring-2:~/src/mapnik_feb15 spring$ ls -l /opt/local/lib/
>>> libboost_filesystem*
>>>
>>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-1_34_1.a
>>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-1_34_1.dylib
>>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-d-1_34_1.a
>>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-d-1_34_1.dylib
>>> lrwxr-xr-x   1 root  admin     165 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-d.a -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.a
>>> lrwxr-xr-x   1 root  admin     169 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-d.dylib -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.dylib
>>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-mt-1_34_1.a
>>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-mt-1_34_1.dylib
>>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-mt-d-1_34_1.a
>>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>>> libboost_filesystem-mt-d-1_34_1.dylib
>>> lrwxr-xr-x   1 root  admin     168 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-mt-d.a -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.a
>>> lrwxr-xr-x   1 root  admin     172 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-mt-d.dylib -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-
>>> d-1_34_1.dylib
>>> lrwxr-xr-x   1 root  admin     166 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-mt.a -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.a
>>> lrwxr-xr-x   1 root  admin     170 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem-mt.dylib -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.dylib
>>> lrwxr-xr-x   1 root  admin     163 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem.a -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.a
>>> lrwxr-xr-x   1 root  admin     167 Feb 15 12:13 /opt/local/lib/
>>> libboost_filesystem.dylib -> /opt/local/var/macports/build/
>>> _opt_local_var_macports_sources_rsync
>>> .macports.org_release_ports_devel_b
>>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.dylib
>>>
>>> _______________________________________________
>>> Mapnik-devel mailing list
>>> Mapnik-devel at lists.berlios.de
>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>>
>>
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From blake at hailmail.net  Fri Feb 22 09:13:23 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 22 Feb 2008 00:13:23 -0800
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
Message-ID: <FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>

When running the demo/python/rundemo.py

I get a "Segmentation fault".

I tracked the problem down to line 98 of the script:

"""
provpoly_rule_qc.filter = Filter("[NAME_EN] = 'Quebec'")

"""

When I commented this line out everything seemingly ran well and  
output the script nice demo images.

Dane




From artem at mapnik.org  Fri Feb 22 12:28:10 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 11:28:10 +0000
Subject: [Mapnik-devel] Mac 10.4 build problem with boost
In-Reply-To: <A60361FC-1F47-4A92-8BB4-109BBC9AA848@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<A60361FC-1F47-4A92-8BB4-109BBC9AA848@hailmail.net>
Message-ID: <7D600AED-D637-4A1A-AB24-198000DDF0AE@mapnik.org>


On 22 Feb 2008, at 06:43, Dane Springmeyer wrote:

> Artem,
>
> I'm glad to report that the problem with scons.py not finding the  
> boost libs and includes is solved and I've finally got a working  
> install of mapnik on Mac OS 10.5.
>
> There was a bug in macports that is now fixed (http:// 
> trac.macosforge.org/projects/macports/ticket/14365). In addition  
> macports requires installing the python bindings to boost through  
> the -v for variant flag.
>
> So to build on mac leopard, either with release 0.5 or svn I now  
> can simply do:
>
> sudo port install boost-jam #note there is still a dependency  
> problem in macports where you must build boost-jam first
> sudo port install -v boost +python25 +icu
> svn co svn://svn.mapnik.org/trunk mapnik
> cd mapnik
> python scons/scons.py
> python scons/scons.py PGSQL_INCLUDES=/usr/local/pgsql/include  
> PGSQL_LIBS=/usr/local/pgsql/lib
> sudo python scons/scons.py install PGSQL_INCLUDES=/usr/local/pgsql/ 
> include PGSQL_LIBS=/usr/local/pgsql/lib
>
> then:
> copy this folder /System/Library/Frameworks/Python.framework/ 
> Versions/2.5/lib/python2.5/site-packages/mapnik/$golden
> to
> /Library/Python/2.5/site-packages/
>

Great news!
>
> When you get a chance, you should document the addition of ICU to  
> the INSTALL.txt in svn.

Yes, sure.
>
> Cheers,
>
> Dane
>

Artem
>
> On Feb 20, 2008, at 7:59 AM, Dane Springmeyer wrote:
>
>> Hi Artem,
>>
>> Thanks for the suggestion. I'll try that next.
>>
>> My hunch still is that the macports install of liboost has some
>> symlinking problems, as I've discussed it on IRC with macports folks
>> and recommended filing a bug (http://trac.macosforge.org/projects/ 
>> macports/ticket/14365
>> ).
>>
>> If the cache rebuild does not work I think I'll try rebuilding the
>> symlinks in opt/local/lib.
>>
>> What lib name does scons look for exactly?  For the Filesystem, for
>> example. does scons look for
>>
>> path-to-boost/liblibboost_filesystem-mt.dylib
>>
>> or
>>
>> path-to-boost/lib/libboost_filesystem.dylib?
>>
>> Also, for reference I'm now running 10.5 and still have this same
>> problem.
>>
>> Thanks,
>>
>> Dane
>>
>>
>>
>> On Feb 20, 2008, at 2:03 AM, Artem Pavlenko wrote:
>>
>>> Hi Dane,
>>>
>>> Sometimes scons fails to update cache, could you try :
>>>
>>> rm -rf .scons*
>>>
>>> and try again.
>>>
>>> You boost installation looks fine.
>>> Cheers
>>> Artem
>>>
>>> On 15 Feb 2008, at 23:06, Dane Springmeyer wrote:
>>>
>>>> Trying to build mapnik on 10.4.11
>>>>
>>>> I'm running into a problem directing scons.py to find my boost
>>>> installs.
>>>>
>>>> Can anyone spot what might be going wrong?
>>>>
>>>> -------
>>>>
>>>> spring-2:~/src/mapnik_feb15 spring$ python scons/scons.py
>>>> JPEG_INCLUDES=/Library/Frameworks/UnixImageIO.framework/unix/ 
>>>> include
>>>> JPEG_LIBS=/Library/Frameworks/UnixImageIO.framework/unix/lib
>>>> PGSQL_INCLUDES=/usr/local/pgsql/include PGSQL_LIBS=/usr/local/ 
>>>> pgsql/
>>>> lib BOOST_INCLUDES=/opt/local/include/boost-1_34_1 BOOST_LIBS=/opt/
>>>> local/lib
>>>> scons: Reading SConscript files ...
>>>> Building on Darwin ...
>>>> Checking for C library m... yes
>>>> Checking for C library ltdl... yes
>>>> Checking for C library png... yes
>>>> Checking for C library tiff... yes
>>>> Checking for C library z... yes
>>>> Checking for C library jpeg... yes
>>>> Checking for C library proj... yes
>>>> Checking for C library iconv... yes
>>>> Checking for C library pq... yes
>>>> Checking for C++ library gdal... yes
>>>> Checking for C++ library boost_filesystem-mt... no
>>>> Could not find header or shared library for boost filesystem,
>>>> exiting!
>>>>
>>>> -------
>>>>
>>>>
>>>> I installed boost using MACPORTS which put headers here, for  
>>>> example:
>>>>
>>>> /opt/local/include/boost-1_34_1/boost/filesystem/operations.hpp
>>>> /opt/local/include/boost-1_34_1/boost/regex.hpp
>>>>
>>>> and put libraries and symlinks here:
>>>>
>>>> /opt/local/lib...
>>>>
>>>> spring-2:~/src/mapnik_feb15 spring$ ls -l /opt/local/lib/
>>>> libboost_filesystem*
>>>>
>>>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-1_34_1.a
>>>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-1_34_1.dylib
>>>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-d-1_34_1.a
>>>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-d-1_34_1.dylib
>>>> lrwxr-xr-x   1 root  admin     165 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-d.a -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.a
>>>> lrwxr-xr-x   1 root  admin     169 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-d.dylib -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-d-1_34_1.dylib
>>>> -rw-r--r--   2 root  admin   81604 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-mt-1_34_1.a
>>>> -rwxr-xr-x   2 root  admin   66388 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-mt-1_34_1.dylib
>>>> -rw-r--r--   2 root  admin  410068 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-mt-d-1_34_1.a
>>>> -rwxr-xr-x   2 root  admin  367408 Feb 15 12:12 /opt/local/lib/
>>>> libboost_filesystem-mt-d-1_34_1.dylib
>>>> lrwxr-xr-x   1 root  admin     168 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-mt-d.a -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-d-1_34_1.a
>>>> lrwxr-xr-x   1 root  admin     172 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-mt-d.dylib -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-
>>>> d-1_34_1.dylib
>>>> lrwxr-xr-x   1 root  admin     166 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-mt.a -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-mt-1_34_1.a
>>>> lrwxr-xr-x   1 root  admin     170 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem-mt.dylib -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem- 
>>>> mt-1_34_1.dylib
>>>> lrwxr-xr-x   1 root  admin     163 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem.a -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.a
>>>> lrwxr-xr-x   1 root  admin     167 Feb 15 12:13 /opt/local/lib/
>>>> libboost_filesystem.dylib -> /opt/local/var/macports/build/
>>>> _opt_local_var_macports_sources_rsync
>>>> .macports.org_release_ports_devel_b
>>>> oost/work/destroot/opt/local/lib/libboost_filesystem-1_34_1.dylib
>>>>
>>>> _______________________________________________
>>>> Mapnik-devel mailing list
>>>> Mapnik-devel at lists.berlios.de
>>>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>>>>
>>>
>>
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>



From artem at mapnik.org  Fri Feb 22 12:38:50 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 11:38:50 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
Message-ID: <C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>


On 22 Feb 2008, at 08:13, Dane Springmeyer wrote:

> When running the demo/python/rundemo.py
>
> I get a "Segmentation fault".
>
> I tracked the problem down to line 98 of the script:
>
> """
> provpoly_rule_qc.filter = Filter("[NAME_EN] = 'Quebec'")
>
> """
>
> When I commented this line out everything seemingly ran well and
> output the script nice demo images.

Hmm.. interesting. It works fine for me.  Are you running Mapnik from  
svn trunk? or 0.5?
To track down the reason for seg fault you need to re-compile Mapnik  
with DEBUG=y and see if you will get some clues from stderr,
Or even better, run it in gdb.


>
> Dane
>
Artem
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From jbronn at gmail.com  Fri Feb 22 15:46:46 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Fri, 22 Feb 2008 08:46:46 -0600
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
Message-ID: <47BEE056.4050500@gmail.com>

 >> When running the demo/python/rundemo.py
 >>
 >> I get a "Segmentation fault".

 > To track down the reason for seg fault you need to re-compile Mapnik
 > with DEBUG=y and see if you will get some clues from stderr,
 > Or even better, run it in gdb.

I've been having similar problems ("Bus error") -- however, these only 
occur for me when the DEBUG flag is _not_ set.  If you're running SVN 
see if you can run the demo after compiling with the DEBUG flag set.

This last occurred for me on OSX 10.5, using SVN r652.

-Justin



From blake at hailmail.net  Fri Feb 22 17:24:53 2008
From: blake at hailmail.net (Dane Springmeyer)
Date: Fri, 22 Feb 2008 08:24:53 -0800
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BEE056.4050500@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
Message-ID: <FDD604C6-B209-4D52-9E67-E16F4C1B50D1@hailmail.net>

Justin,

I rebuild with debug=y from svn655 and yes, the demo runs fine now  
without any segmentation error.

Thanks,
Dane


On Feb 22, 2008, at 6:46 AM, Justin Bronn wrote:

>>> When running the demo/python/rundemo.py
>>>
>>> I get a "Segmentation fault".
>
>> To track down the reason for seg fault you need to re-compile Mapnik
>> with DEBUG=y and see if you will get some clues from stderr,
>> Or even better, run it in gdb.
>
> I've been having similar problems ("Bus error") -- however, these only
> occur for me when the DEBUG flag is _not_ set.  If you're running SVN
> see if you can run the demo after compiling with the DEBUG flag set.
>
> This last occurred for me on OSX 10.5, using SVN r652.
>
> -Justin
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem at mapnik.org  Fri Feb 22 18:00:45 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 17:00:45 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BEE056.4050500@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
Message-ID: <DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>


On 22 Feb 2008, at 14:46, Justin Bronn wrote:

>>> When running the demo/python/rundemo.py
>>>
>>> I get a "Segmentation fault".
>
>> To track down the reason for seg fault you need to re-compile Mapnik
>> with DEBUG=y and see if you will get some clues from stderr,
>> Or even better, run it in gdb.
>
> I've been having similar problems ("Bus error") -- however, these only
> occur for me when the DEBUG flag is _not_ set.  If you're running SVN
> see if you can run the demo after compiling with the DEBUG flag set.
>
> This last occurred for me on OSX 10.5, using SVN r652.

I don't have access to OS X 10.5 and I can not reproduce this on 10.4
It would be very useful if someone could rebuild Mapnik with  
optimization and debug flags enabled : -O2 -g  -DDEBUG
and find what is causing this segmentation fault.


>
> -Justin
>

Thanks in advance
Artem

> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From jbronn at gmail.com  Fri Feb 22 19:59:14 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Fri, 22 Feb 2008 12:59:14 -0600
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
Message-ID: <47BF1B82.8030200@gmail.com>

Artem,

> I don't have access to OS X 10.5 and I can not reproduce this on 10.4
> It would be very useful if someone could rebuild Mapnik with 
> optimization and debug flags enabled : -O2 -g  -DDEBUG
> and find what is causing this segmentation fault.

The attached patch for filter_factory.hpp fixes the segfault problem for 
non-debug builds on my installation of 10.5 (Leopard). The patch 
requires no changing of the compilation flags.

I'm still perplexed as to why it would work in the first place even when 
DEBUG was set -- any ideas?

The compiler macros in the patch came from my previous patch (now 
commented due to ICU unicode support) in unicode.cpp.

-Justin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: filter_factory.diff
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080222/d41ac481/attachment.ksh>

From tom at compton.nu  Fri Feb 22 20:52:54 2008
From: tom at compton.nu (Tom Hughes)
Date: Fri, 22 Feb 2008 19:52:54 GMT
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BF1B82.8030200@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org> 
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org> 
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net> 
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net> 
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com> 
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
Message-ID: <9e1245754f.tom@loxley.compton.nu>

In message <47BF1B82.8030200 at gmail.com>
          Justin Bronn <jbronn at gmail.com> wrote:

> Artem,
> 
> > I don't have access to OS X 10.5 and I can not reproduce this on 10.4
> > It would be very useful if someone could rebuild Mapnik with
> > optimization and debug flags enabled : -O2 -g  -DDEBUG
> > and find what is causing this segmentation fault.
> 
> The attached patch for filter_factory.hpp fixes the segfault problem for
> non-debug builds on my installation of 10.5 (Leopard). The patch
> requires no changing of the compilation flags.
> 
> I'm still perplexed as to why it would work in the first place even when
> DEBUG was set -- any ideas?

Well what was the cause of the segv? and how does your patch fix it?

It looks like all you're doing is casting away const, but as const
is not normally enforced at run time I don't see how that helps...

The only time changing a const object will segv is when it is a
compile time constant and has been placed in an RO section of the
resulting executable, and in that case casting away const won't
help in the slightest - it will just stop the compiler warning
about you trying to change a const object.

Casting away const like that should be a major red flag anyway
as it isn't something you should normally be doing at all.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From artem at mapnik.org  Fri Feb 22 21:51:17 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 20:51:17 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BF1B82.8030200@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
Message-ID: <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>


On 22 Feb 2008, at 18:59, Justin Bronn wrote:

> Artem,
>
>> I don't have access to OS X 10.5 and I can not reproduce this on 10.4
>> It would be very useful if someone could rebuild Mapnik with  
>> optimization and debug flags enabled : -O2 -g  -DDEBUG
>> and find what is causing this segmentation fault.
>
> The attached patch for filter_factory.hpp fixes the segfault  
> problem for non-debug builds on my installation of 10.5 (Leopard).  
> The patch requires no changing of the compilation flags.
>
> I'm still perplexed as to why it would work in the first place even  
> when DEBUG was set -- any ideas?
>
> The compiler macros in the patch came from my previous patch (now  
> commented due to ICU unicode support) in unicode.cpp.
>
> -Justin
> Index: include/mapnik/filter_factory.hpp
> ===================================================================
> --- include/mapnik/filter_factory.hpp	(revision 655)
> +++ include/mapnik/filter_factory.hpp	(working copy)
> @@ -41,7 +41,11 @@
>              stack<shared_ptr<filter<FeatureT> > > filters;
>              stack<shared_ptr<expression<FeatureT> > > exps;
>              filter_grammar<FeatureT> grammar(filters,exps);
> +#if (!defined(OSX_LEOPARD) && defined(DARWIN)) || defined(SUNOS)  
> || defined(FREEBSD)
>              char const *text = str.c_str();
> +#else
> +            char * text = const_cast<char*>(str.data());
> +#endif
>              parse_info<> info = parse(text, grammar, space_p);
>              if ( ! info.full) {
>                  std::ostringstream os;


Justin,

Thanks for the patch. I think the problem is a little bit more subtle  
and related to how UnicodeString is constructed in filter_parser.
When compiled with DEBUG flags, often compiler fills un-initialized  
memory with zeros, also it might use different data alignment which  
would explain why it 'magically' worked. I don't think we should be  
using data() method (which is not guaranteed to return zero- 
terminated string) or const cast, though.

I have some ideas and I'll come up with fix asap. Could, please,  
verify that  sizeof(wchar_t) == 4 on Max OS X ?

Cheers
Artem

> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem at mapnik.org  Fri Feb 22 21:52:54 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 20:52:54 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <9e1245754f.tom@loxley.compton.nu>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com> <9e1245754f.tom@loxley.compton.nu>
Message-ID: <2E0EC80A-8061-4019-9B9C-D05A40712444@mapnik.org>


On 22 Feb 2008, at 19:52, Tom Hughes wrote:

> In message <47BF1B82.8030200 at gmail.com>
>           Justin Bronn <jbronn at gmail.com> wrote:
>
>> Artem,
>>
>>> I don't have access to OS X 10.5 and I can not reproduce this on  
>>> 10.4
>>> It would be very useful if someone could rebuild Mapnik with
>>> optimization and debug flags enabled : -O2 -g  -DDEBUG
>>> and find what is causing this segmentation fault.
>>
>> The attached patch for filter_factory.hpp fixes the segfault  
>> problem for
>> non-debug builds on my installation of 10.5 (Leopard). The patch
>> requires no changing of the compilation flags.
>>
>> I'm still perplexed as to why it would work in the first place  
>> even when
>> DEBUG was set -- any ideas?
>
> Well what was the cause of the segv? and how does your patch fix it?
>
> It looks like all you're doing is casting away const, but as const
> is not normally enforced at run time I don't see how that helps...
>
> The only time changing a const object will segv is when it is a
> compile time constant and has been placed in an RO section of the
> resulting executable, and in that case casting away const won't
> help in the slightest - it will just stop the compiler warning
> about you trying to change a const object.
>
> Casting away const like that should be a major red flag anyway
> as it isn't something you should normally be doing at all.
>
> Tom
>
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From artem at mapnik.org  Fri Feb 22 21:55:45 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 20:55:45 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <9e1245754f.tom@loxley.compton.nu>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com> <9e1245754f.tom@loxley.compton.nu>
Message-ID: <2BC38BA5-BA28-43BD-85C3-8F27ED6A2F98@mapnik.org>


On 22 Feb 2008, at 19:52, Tom Hughes wrote:

> In message <47BF1B82.8030200 at gmail.com>
>           Justin Bronn <jbronn at gmail.com> wrote:
>
>> Artem,
>>
>>> I don't have access to OS X 10.5 and I can not reproduce this on  
>>> 10.4
>>> It would be very useful if someone could rebuild Mapnik with
>>> optimization and debug flags enabled : -O2 -g  -DDEBUG
>>> and find what is causing this segmentation fault.
>>
>> The attached patch for filter_factory.hpp fixes the segfault  
>> problem for
>> non-debug builds on my installation of 10.5 (Leopard). The patch
>> requires no changing of the compilation flags.
>>
>> I'm still perplexed as to why it would work in the first place  
>> even when
>> DEBUG was set -- any ideas?
>
> Well what was the cause of the segv? and how does your patch fix it?
>
> It looks like all you're doing is casting away const, but as const
> is not normally enforced at run time I don't see how that helps...
>
> The only time changing a const object will segv is when it is a
> compile time constant and has been placed in an RO section of the
> resulting executable, and in that case casting away const won't
> help in the slightest - it will just stop the compiler warning
> about you trying to change a const object.
>
> Casting away const like that should be a major red flag anyway
> as it isn't something you should normally be doing at all.

Yes, const cast is a red-herring. I most certain it is to do with how  
UnicodeString is constructed in filter_parser.

>
> Tom
>
Artem

> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From jbronn at gmail.com  Fri Feb 22 22:10:18 2008
From: jbronn at gmail.com (Justin Bronn)
Date: Fri, 22 Feb 2008 15:10:18 -0600
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
Message-ID: <47BF3A3A.1090601@gmail.com>


> I have some ideas and I'll come up with fix asap. Could, please, verify 
> that  sizeof(wchar_t) == 4 on Max OS X ?
> 

I used the attached code to test that size; the program prints "4".

Also attached is the original segmentation fault traceback for those 
inquiring minds.

-Justin
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: wchar_check.cpp
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080222/b5bdccb6/attachment.ksh>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: traceback.txt
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080222/b5bdccb6/attachment.txt>

From tom at compton.nu  Fri Feb 22 22:11:59 2008
From: tom at compton.nu (Tom Hughes)
Date: Fri, 22 Feb 2008 21:11:59 GMT
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org> 
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org> 
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net> 
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net> 
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com> 
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
Message-ID: <20504c754f.tom@loxley.compton.nu>

In message <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88 at mapnik.org>
          Artem Pavlenko <artem at mapnik.org> wrote:
> Thanks for the patch. I think the problem is a little bit more subtle
> and related to how UnicodeString is constructed in filter_parser.
> When compiled with DEBUG flags, often compiler fills un-initialized
> memory with zeros, also it might use different data alignment which
> would explain why it 'magically' worked. I don't think we should be
> using data() method (which is not guaranteed to return zero-
> terminated string) or const cast, though.

If it is down to uninitialised memory then it's probably worth
running it under valgrind to see what it says.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From tom at compton.nu  Fri Feb 22 22:37:19 2008
From: tom at compton.nu (Tom Hughes)
Date: Fri, 22 Feb 2008 21:37:19 GMT
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <20504c754f.tom@loxley.compton.nu>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org> 
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org> 
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net> 
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net> 
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com> 
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org> 
	<20504c754f.tom@loxley.compton.nu>
Message-ID: <28a24e754f.tom@loxley.compton.nu>

In message <20504c754f.tom at loxley.compton.nu>
          Tom Hughes <tom at compton.nu> wrote:

> In message <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88 at mapnik.org>
>           Artem Pavlenko <artem at mapnik.org> wrote:
> > Thanks for the patch. I think the problem is a little bit more subtle
> > and related to how UnicodeString is constructed in filter_parser.
> > When compiled with DEBUG flags, often compiler fills un-initialized
> > memory with zeros, also it might use different data alignment which
> > would explain why it 'magically' worked. I don't think we should be
> > using data() method (which is not guaranteed to return zero-
> > terminated string) or const cast, though.
> 
> If it is down to uninitialised memory then it's probably worth
> running it under valgrind to see what it says.

I just ran a test under valgrind with OSM data and all I found was
this:

==17947== Conditional jump or move depends on uninitialised value(s)
==17947==    at 0x4F5663C: mapnik::logical_and<mapnik::feature<mapnik::geometry<mapnik::vertex<double, 2> >, boost::shared_ptr<mapnik::raster> > >::pass(mapnik::feature<mapnik::geometry<mapnik::vertex<double, 2> >, boost::shared_ptr<mapnik::raster> > const&) const (logical.hpp:48)
==17947==    by 0x40DE29: mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32> >::apply_to_layer(mapnik::Layer const&, mapnik::agg_renderer<mapnik::Image32>&, mapnik::projection const&, double) (feature_style_processor.hpp:193)
==17947==    by 0x40E45C: mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32> >::apply() (feature_style_processor.hpp:92)
==17947==    by 0x408448: main (mapnik_test.cpp:105)

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From artem at mapnik.org  Fri Feb 22 22:49:40 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 21:49:40 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BF3A3A.1090601@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
	<47BF3A3A.1090601@gmail.com>
Message-ID: <00D1C593-2F72-4EBA-AD7D-10B612825C2B@mapnik.org>

Great, thanks
Artem


>
>> I have some ideas and I'll come up with fix asap. Could, please,  
>> verify that  sizeof(wchar_t) == 4 on Max OS X ?
>
> I used the attached code to test that size; the program prints "4".


>
> Also attached is the original segmentation fault traceback for  
> those inquiring minds.
>


> -Justin
> // Compiles with: g++ -Wall -pedantic -o wchar_check wchar_check.cpp
> #include <iostream>
> int main(){
>   std::cout << sizeof(wchar_t) << std::endl;
> }
> Process:         Python [57889]
> Path:            /Library/Frameworks/Python.framework/Versions/2.5/ 
> Resources/Python.app/Contents/MacOS/Python
> Identifier:      Python
> Version:         ??? (???)
> Code Type:       X86 (Native)
> Parent Process:  bash [4266]
>
> Date/Time:       2008-02-22 12:19:00.551 -0600
> OS Version:      Mac OS X 10.5.2 (9C31)
> Report Version:  6
>
> Exception Type:  EXC_BAD_ACCESS (SIGBUS)
> Exception Codes: KERN_PROTECTION_FAILURE at 0x0000000000000000
> Crashed Thread:  0
>
> Thread 0 Crashed:
> 0   ???                           	0000000000 0 + 0
> 1   libmapnik.dylib               	0x00bc25b4  
> boost::spirit::grammar<mapnik::filter_grammar<mapnik::feature<mapnik:: 
> geometry<mapnik::vertex<double, 2> >,  
> boost::shared_ptr<mapnik::raster> > >,  
> boost::spirit::parser_context<boost::spirit::nil_t> >::~grammar() +  
> 100
> 2   libmapnik.dylib               	0x00bef6af  
> mapnik::filter_factory<mapnik::feature<mapnik::geometry<mapnik::vertex 
> <double, 2> >, boost::shared_ptr<mapnik::raster> > >::compile 
> (std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&) + 1295
> 3   libmapnik.dylib               	0x00bba479 mapnik::create_filter 
> (std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&) + 25
> 4   _mapnik.so                    	0x009677ac  
> boost::python::objects::caller_py_function_impl<boost::python::detail: 
> :caller<boost::shared_ptr<mapnik::filter<mapnik::feature<mapnik::geome 
> try<mapnik::vertex<double, 2> >, boost::shared_ptr<mapnik::raster>  
> > > > (*)(std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&),  
> boost::python::default_call_policies,  
> boost::mpl::vector2<boost::shared_ptr<mapnik::filter<mapnik::feature<m 
> apnik::geometry<mapnik::vertex<double, 2> >,  
> boost::shared_ptr<mapnik::raster> > > >, std::basic_string<char,  
> std::char_traits<char>, std::allocator<char> > const&> > >::operator 
> ()(_object*, _object*) + 140
> 5   _mapnik.so                    	0x009fad24  
> boost::python::objects::function::call(_object*, _object*) const + 468
> 6   _mapnik.so                    	0x009fcf95  
> boost::detail::function::void_function_ref_invoker0<boost::python::obj 
> ects::(anonymous namespace)::bind_return, void>::invoke 
> (boost::detail::function::function_buffer&) + 37
> 7   _mapnik.so                    	0x00a02e79  
> boost::function0<void, std::allocator<boost::function_base>  
> >::operator()() const + 41
> 8   _mapnik.so                    	0x00a02d90  
> boost::python::detail::exception_handler::operator() 
> (boost::function0<void, std::allocator<boost::function_base> >  
> const&) const + 256
> 9   _mapnik.so                    	0x009a3024  
> boost::detail::function::function_obj_invoker2<boost::_bi::bind_t<bool 
> , boost::python::detail::translate_exception<mapnik::config_error,  
> void (*)(mapnik::config_error const&)>,  
> boost::_bi::list3<boost::arg<1> (*)(), boost::arg<2> (*)(),  
> boost::_bi::value<void (*)(mapnik::config_error const&)> > >, bool,  
> boost::python::detail::exception_handler const&,  
> boost::function0<void, std::allocator<boost::function_base> >  
> const&>::invoke(boost::detail::function::function_buffer&,  
> boost::python::detail::exception_handler const&,  
> boost::function0<void, std::allocator<boost::function_base> >  
> const&) + 36
> 10  _mapnik.so                    	0x00a029bf  
> boost::python::handle_exception_impl(boost::function0<void,  
> std::allocator<boost::function_base> >) + 63
> 11  _mapnik.so                    	0x009f8c4c function_call + 108
> 12  org.python.python             	0x003f9278 PyObject_Call + 45  
> (abstract.c:1860)
> 13  org.python.python             	0x00480851 PyEval_EvalFrameEx +  
> 9242 (ceval.c:3775)
> 14  org.python.python             	0x00484cdc PyEval_EvalCodeEx +  
> 1819 (ceval.c:2831)
> 15  org.python.python             	0x00484e90 PyEval_EvalCode + 87  
> (ceval.c:500)
> 16  org.python.python             	0x004a8100 PyRun_FileExFlags +  
> 260 (pythonrun.c:1271)
> 17  org.python.python             	0x004a849a  
> PyRun_SimpleFileExFlags + 640 (pythonrun.c:877)
> 18  org.python.python             	0x004b5bb6 Py_Main + 3077  
> (main.c:523)
> 19  org.python.python             	0x00001f8e 0x1000 + 3982
> 20  org.python.python             	0x00001eb5 0x1000 + 3765
>
> Thread 0 crashed with X86 Thread State (32-bit):
>   eax: 0x00839f30  ebx: 0x00befd71  ecx: 0x00000000  edx: 0xbfffed38
>   edi: 0x00839c00  esi: 0x00839ba0  ebp: 0xbfffea48  esp: 0xbfffe9ec
>    ss: 0x0000001f  efl: 0x00010206  eip: 0x00000000   cs: 0x00000017
>    ds: 0x0000001f   es: 0x0000001f   fs: 0x00000000   gs: 0x00000037
>   cr2: 0x00000000
>
> Binary Images:
>     0x1000 -     0x1fff +org.python.python 2.5a0 (2.5alpha0) / 
> Library/Frameworks/Python.framework/Versions/2.5/Resources/ 
> Python.app/Contents/MacOS/Python
>    0xbb000 -    0xbbfff +dl.so ??? (???) /Library/Frameworks/ 
> Python.framework/Versions/2.5/lib/python2.5/lib-dynload/dl.so
>    0xc2000 -    0xe1ff3 +libpng12.0.dylib ??? (???)  
> <cef32b20f18ce312f8cbf0d1f1b85d8e> /usr/local/lib/libpng12.0.dylib
>   0x3f0000 -   0x4e4fc3 +org.python.python 2.5a0 (2.5) /Library/ 
> Frameworks/Python.framework/Versions/2.5/Python
>   0x7e0000 -   0x7e3ffc  libltdl.3.dylib ??? (???)  
> <aadaf4c9f65c2f3b25f6e2cce0a2ad3e> /usr/lib/libltdl.3.dylib
>   0x7e9000 -   0x7f1ff7 +libgeos_c.1.dylib ??? (???)  
> <516159108ff8d4e4c21aa8d7974ef315> /usr/local/lib/libgeos_c.1.dylib
>   0x940000 -   0xa4aff7 +_mapnik.so ??? (???) /Library/Frameworks/ 
> Python.framework/Versions/2.5/lib/python2.5/site-packages/mapnik/ 
> _mapnik.so
>   0xb9a000 -   0xc95feb +libmapnik.dylib ??? (???) /usr/local/lib/ 
> libmapnik.dylib
>   0xd44000 -   0xd60ff8 +libjpeg.62.dylib ??? (???) /usr/local/lib/ 
> libjpeg.62.dylib
>   0xd67000 -   0xe49fff +libicuuc.38.dylib ??? (???)  
> <cf6aca883c640fa850b299b1c0c9e43e> /usr/local/lib/libicuuc.38.dylib
>   0xec7000 -   0xf13fef +libtiff.3.dylib ??? (???)  
> <dfe7782f1abe5e190f053f2de3326917> /usr/local/lib/libtiff.3.dylib
>   0xf28000 -   0xf58fff +libproj.0.dylib ??? (???)  
> <83f197bc7b0c2b748089f40f2e4254ca> /usr/local/lib/libproj.0.dylib
>   0xf72000 -   0xf86fef +libpq.5.dylib ??? (???) /usr/local/lib/ 
> libpq.5.dylib
>   0xf8e000 -   0xfa5fe8 +libexpat.0.1.0.dylib ??? (???) /usr/local/ 
> lib/libexpat.0.1.0.dylib
>   0xfdf000 -   0xfe4fff +gdal.input ??? (???) /usr/local/lib/mapnik/ 
> input/gdal.input
>   0xfeb000 -   0xff2fff +raster.input ??? (???) /usr/local/lib/ 
> mapnik/input/raster.input
>  0x1800000 -  0x22d5fff +libicudata.38.dylib ??? (???) /usr/local/ 
> lib/libicudata.38.dylib
>  0x22d8000 -  0x2337fd7 +libfreetype.6.dylib ??? (???) /usr/local/ 
> lib/libfreetype.6.dylib
>  0x24cf000 -  0x2815fe2 +libgdal.1.dylib ??? (???)  
> <fb0f1d211e10893fb4788abb12d8c78b> /usr/local/lib/libgdal.1.dylib
>  0x2a02000 -  0x2ab9ffb +libgeos-3.0.0.dylib ??? (???)  
> <a131d0531dffc6da1700fd204c99cb3e> /usr/local/lib/libgeos-3.0.0.dylib
>  0x2bb3000 -  0x2cddfff +libhdf5.0.dylib ??? (???) /usr/local/lib/ 
> libhdf5.0.dylib
>  0x2d04000 -  0x2d2fffb  libcurl.4.dylib ??? (???)  
> <54ada27deb3b4ff7043d8836264eca0d> /usr/lib/libcurl.4.dylib
>  0x2d39000 -  0x2d4dff7 +postgis.input ??? (???) /usr/local/lib/ 
> mapnik/input/postgis.input
>  0x2d5c000 -  0x2d77fff +shape.input ??? (???) /usr/local/lib/ 
> mapnik/input/shape.input
> 0x8fe00000 - 0x8fe2da53  dyld 96.2 (???)  
> <7af47d3b00b2268947563c7fa8c59a07> /usr/lib/dyld
> 0x90003000 - 0x90003ff8  com.apple.ApplicationServices 34 (34)  
> <8f910fa65f01d401ad8d04cc933cf887> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/ApplicationServices
> 0x90092000 - 0x9072bfff  com.apple.CoreGraphics 1.351.21 (???)  
> <6c93fd21149f389129fe47fa6ef71880> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> CoreGraphics.framework/Versions/A/CoreGraphics
> 0x9093b000 - 0x909e2feb  com.apple.QD 3.11.52 (???)  
> <c72bd7bd2ce12694c3640a731d1ad878> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/QD.framework/ 
> Versions/A/QD
> 0x90f55000 - 0x90f5cfe9  libgcc_s.1.dylib ??? (???)  
> <a9ab135a5f81f6e345527df87f51bfc9> /usr/lib/libgcc_s.1.dylib
> 0x9213b000 - 0x924f9fea  libLAPACK.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libLAPACK.dylib
> 0x924fa000 - 0x92518fff  libresolv.9.dylib ??? (???)  
> <0629b6dcd71f4aac6a891cbe26253e85> /usr/lib/libresolv.9.dylib
> 0x9257f000 - 0x925b6fff  com.apple.SystemConfiguration 1.9.1  
> (1.9.1) <8a76e429301afe4eba1330bfeaabd9f2> /System/Library/ 
> Frameworks/SystemConfiguration.framework/Versions/A/ 
> SystemConfiguration
> 0x92a8b000 - 0x92ae5ff7  com.apple.CoreText 2.0.1 (???)  
> <07494945ad1e3f5395599f42748457cc> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> CoreText.framework/Versions/A/CoreText
> 0x92ae6000 - 0x92b60ff8  com.apple.print.framework.PrintCore 5.5.2  
> (245.1) <3c9de512e95fbd838694ee5008d56a28> /System/Library/ 
> Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ 
> PrintCore.framework/Versions/A/PrintCore
> 0x92c4b000 - 0x92ca8ffb  libstdc++.6.dylib ??? (???)  
> <04b812dcec670daa8b7d2852ab14be60> /usr/lib/libstdc++.6.dylib
> 0x92ce4000 - 0x92d0ffe7  libauto.dylib ??? (???)  
> <42d8422dc23a18071869fdf7b5d8fab5> /usr/lib/libauto.dylib
> 0x92d10000 - 0x93120fef  libBLAS.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libBLAS.dylib
> 0x93947000 - 0x93a28ff7  libxml2.2.dylib ??? (???)  
> <450ec38b57fb46013847cce851001a2f> /usr/lib/libxml2.2.dylib
> 0x93a2d000 - 0x93a51fff  libxslt.1.dylib ??? (???)  
> <4933ddc7f6618743197aadc85b33b5ab> /usr/lib/libxslt.1.dylib
> 0x93a52000 - 0x93b04ffb  libcrypto.0.9.7.dylib ??? (???)  
> <330b0e48e67faffc8c22dfc069ca7a47> /usr/lib/libcrypto.0.9.7.dylib
> 0x93b2f000 - 0x93b2fffd  com.apple.Accelerate 1.4.2 (Accelerate  
> 1.4.2) /System/Library/Frameworks/Accelerate.framework/Versions/A/ 
> Accelerate
> 0x93e45000 - 0x93ed8ff3  com.apple.ApplicationServices.ATS 3.2  
> (???) <cdf31bd0ac7de54a35ee2d27cf86b6be> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/ 
> Versions/A/ATS
> 0x9426e000 - 0x94270ff5  libRadiance.dylib ??? (???)  
> <b9e04afa91e4b597a00797d67a7268fb> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libRadiance.dylib
> 0x94271000 - 0x94350fff  libobjc.A.dylib ??? (???)  
> <a53206274b6c2d42691f677863f379ae> /usr/lib/libobjc.A.dylib
> 0x943b9000 - 0x943c7ffd  libz.1.dylib ??? (???)  
> <5ddd8539ae2ebfd8e7cc1c57525385c7> /usr/lib/libz.1.dylib
> 0x94679000 - 0x94952ff3  com.apple.CoreServices.CarbonCore 785.8  
> (785.8) <827c228e7d717b397cdb4941eba69553> /System/Library/ 
> Frameworks/CoreServices.framework/Versions/A/Frameworks/ 
> CarbonCore.framework/Versions/A/CarbonCore
> 0x94953000 - 0x94972ffa  libJPEG.dylib ??? (???)  
> <0dd7e9d7fb22174b78205a944144f9c3> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libJPEG.dylib
> 0x94cae000 - 0x94cfeff7  com.apple.HIServices 1.7.0 (???)  
> <f7e78891a6d08265c83dca8e378be1ea> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> HIServices.framework/Versions/A/HIServices
> 0x94cff000 - 0x94d23feb  libssl.0.9.7.dylib ??? (???)  
> <acee7fc534674498dcac211318aa23e8> /usr/lib/libssl.0.9.7.dylib
> 0x94d81000 - 0x94ffbfe7  com.apple.Foundation 6.5.4 (677.15)  
> <6216196287f98a65ddb654d04d773e7b> /System/Library/Frameworks/ 
> Foundation.framework/Versions/C/Foundation
> 0x95097000 - 0x95097ffd  com.apple.Accelerate.vecLib 3.4.2 (vecLib  
> 3.4.2) /System/Library/Frameworks/Accelerate.framework/Versions/A/ 
> Frameworks/vecLib.framework/Versions/A/vecLib
> 0x9509f000 - 0x95159fe3  com.apple.CoreServices.OSServices 224.4  
> (224.4) <ff5007ab220908ac54b6c661e447d593> /System/Library/ 
> Frameworks/CoreServices.framework/Versions/A/Frameworks/ 
> OSServices.framework/Versions/A/OSServices
> 0x952c3000 - 0x9538efff  com.apple.ColorSync 4.5.0 (4.5.0) /System/ 
> Library/Frameworks/ApplicationServices.framework/Versions/A/ 
> Frameworks/ColorSync.framework/Versions/A/ColorSync
> 0x9539a000 - 0x95417fef  libvMisc.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libvMisc.dylib
> 0x95420000 - 0x9545ffef  libTIFF.dylib ??? (???)  
> <76301b3506f310fb454b58897c8d0a9f> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libTIFF.dylib
> 0x95460000 - 0x95468fff  com.apple.DiskArbitration 2.2.1 (2.2.1)  
> <75b0c8d8940a8a27816961dddcac8e0f> /System/Library/Frameworks/ 
> DiskArbitration.framework/Versions/A/DiskArbitration
> 0x954e5000 - 0x9556cff7  libsqlite3.0.dylib ??? (???)  
> <6978bbcca4277d6ae9f042beff643f7d> /usr/lib/libsqlite3.0.dylib
> 0x9556d000 - 0x95571fff  libmathCommon.A.dylib ??? (???) /usr/lib/ 
> system/libmathCommon.A.dylib
> 0x9557c000 - 0x95607fff  com.apple.framework.IOKit 1.5.1 (???)  
> <a17f9f5ea7e8016a467e67349f4d3d03> /System/Library/Frameworks/ 
> IOKit.framework/Versions/A/IOKit
> 0x95608000 - 0x9561efff  com.apple.DictionaryServices 1.0.0 (1.0.0)  
> <ad0aa0252e3323d182e17f50defe56fc> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/ 
> DictionaryServices.framework/Versions/A/DictionaryServices
> 0x9561f000 - 0x956e6ff2  com.apple.vImage 3.0 (3.0) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vImage.framework/Versions/A/vImage
> 0x956e7000 - 0x958b2ff7  com.apple.security 5.0.2 (33001)  
> <0788969ffe7961153219be10786da436> /System/Library/Frameworks/ 
> Security.framework/Versions/A/Security
> 0x95a1d000 - 0x95a62fef  com.apple.Metadata 10.5.2 (398.7)  
> <73a6424c06effc474e699cde6883de99> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/Metadata.framework/ 
> Versions/A/Metadata
> 0x95a63000 - 0x95a63ffa  com.apple.CoreServices 32 (32)  
> <2fcc8f3bd5bbfc000b476cad8e6a3dd2> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/CoreServices
> 0x95a64000 - 0x95a93fe3  com.apple.AE 402.2 (402.2)  
> <e01596187e91af5d48653920017b8c8e> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/AE.framework/Versions/ 
> A/AE
> 0x95a97000 - 0x95ab2ffb  libPng.dylib ??? (???)  
> <85ca18172d7a4b5a5be3574e4e879880> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libPng.dylib
> 0x95ec2000 - 0x95ec9ffe  libbsm.dylib ??? (???)  
> <d25c63378a5029648ffd4b4669be31bf> /usr/lib/libbsm.dylib
> 0x96261000 - 0x963a6ff7  com.apple.ImageIO.framework 2.0.1 (2.0.1)  
> <68ba11e689a9ca30f8310935cd1e02d6> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/ImageIO
> 0x963a7000 - 0x96457fff  edu.mit.Kerberos 6.0.12 (6.0.12)  
> <9e98dfb4cde8b0510fdd972dc9fa1dc9> /System/Library/Frameworks/ 
> Kerberos.framework/Versions/A/Kerberos
> 0x96458000 - 0x964d7ff5  com.apple.SearchKit 1.2.0 (1.2.0)  
> <277b460da86bc222785159fe77e2e2ed> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/SearchKit.framework/ 
> Versions/A/SearchKit
> 0x9658a000 - 0x96601fe3  com.apple.CFNetwork 221.5 (221.5)  
> <5474cdd7d2a8b2e8059de249c702df9e> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/CFNetwork.framework/ 
> Versions/A/CFNetwork
> 0x96602000 - 0x96734fef  com.apple.CoreFoundation 6.5.1 (476.10)  
> <d5bed2688a5eea11a6dc3a3c5c17030e> /System/Library/Frameworks/ 
> CoreFoundation.framework/Versions/A/CoreFoundation
> 0x967a8000 - 0x967cefff  libcups.2.dylib ??? (???)  
> <85ce204da14d62d6a3a5a9adfba01455> /usr/lib/libcups.2.dylib
> 0x9681f000 - 0x9697eff3  libSystem.B.dylib ??? (???)  
> <4899376234e55593b22fc370935f8cdf> /usr/lib/libSystem.B.dylib
> 0x96984000 - 0x96994fff  com.apple.speech.synthesis.framework  
> 3.6.59 (3.6.59) <4ffef145fad3d4d787e0c33eab26b336> /System/Library/ 
> Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ 
> SpeechSynthesis.framework/Versions/A/SpeechSynthesis
> 0x96995000 - 0x969c2feb  libvDSP.dylib ??? (???)  
> <b232c018ddd040ec4e2c2af632dd497f> /System/Library/Frameworks/ 
> Accelerate.framework/Versions/A/Frameworks/vecLib.framework/ 
> Versions/A/libvDSP.dylib
> 0x969c7000 - 0x96abbff4  libiconv.2.dylib ??? (???)  
> <c508c60fafca17824c0017b2e4369802> /usr/lib/libiconv.2.dylib
> 0x96be4000 - 0x96be8fff  libGIF.dylib ??? (???)  
> <b8f61e346fa243a7138910bed3dcdb6b> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libGIF.dylib
> 0x96c2c000 - 0x96c3cffc  com.apple.LangAnalysis 1.6.4 (1.6.4)  
> <cbeb17ab39f28351fe2ab5b82bf465bc> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> LangAnalysis.framework/Versions/A/LangAnalysis
> 0x96c3f000 - 0x96d77ff7  libicucore.A.dylib ??? (???)  
> <afcea652ff2ec36885b2c81c57d06d4c> /usr/lib/libicucore.A.dylib
> 0x96db6000 - 0x96e42ff7  com.apple.LaunchServices 286.5 (286.5)  
> <33c3ae54abb276b61a99d4c764d883e2> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/ 
> LaunchServices.framework/Versions/A/LaunchServices
> 0xfffe8000 - 0xfffebfff  libobjc.A.dylib ??? (???) /usr/lib/ 
> libobjc.A.dylib
> 0xffff0000 - 0xffff1780  libSystem.B.dylib ??? (???) /usr/lib/ 
> libSystem.B.dylib
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem at mapnik.org  Fri Feb 22 22:52:48 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Fri, 22 Feb 2008 21:52:48 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <28a24e754f.tom@loxley.compton.nu>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
	<20504c754f.tom@loxley.compton.nu>
	<28a24e754f.tom@loxley.compton.nu>
Message-ID: <92C7C869-3054-42D8-B7AE-FF064A39C3DD@mapnik.org>


On 22 Feb 2008, at 21:37, Tom Hughes wrote:

> In message <20504c754f.tom at loxley.compton.nu>
>           Tom Hughes <tom at compton.nu> wrote:
>
>> In message <74F5E71A-F596-40BD-9EA2-1EFA80BFFE88 at mapnik.org>
>>           Artem Pavlenko <artem at mapnik.org> wrote:
>>> Thanks for the patch. I think the problem is a little bit more  
>>> subtle
>>> and related to how UnicodeString is constructed in filter_parser.
>>> When compiled with DEBUG flags, often compiler fills un-initialized
>>> memory with zeros, also it might use different data alignment which
>>> would explain why it 'magically' worked. I don't think we should be
>>> using data() method (which is not guaranteed to return zero-
>>> terminated string) or const cast, though.
>>
>> If it is down to uninitialised memory then it's probably worth
>> running it under valgrind to see what it says.
>
> I just ran a test under valgrind with OSM data and all I found was
> this:
>
> ==17947== Conditional jump or move depends on uninitialised value(s)
> ==17947==    at 0x4F5663C:  
> mapnik::logical_and<mapnik::feature<mapnik::geometry<mapnik::vertex<do 
> uble, 2> >, boost::shared_ptr<mapnik::raster> > >::pass 
> (mapnik::feature<mapnik::geometry<mapnik::vertex<double, 2> >,  
> boost::shared_ptr<mapnik::raster> > const&) const (logical.hpp:48)
> ==17947==    by 0x40DE29:  
> mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32>  
> >::apply_to_layer(mapnik::Layer const&,  
> mapnik::agg_renderer<mapnik::Image32>&, mapnik::projection const&,  
> double) (feature_style_processor.hpp:193)
> ==17947==    by 0x40E45C:  
> mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32>  
> >::apply() (feature_style_processor.hpp:92)
> ==17947==    by 0x408448: main (mapnik_test.cpp:105)

Hmm.. looks like valgrind is compailing about lack of default ctor  
which shouldn't be a problem in this case.

Or am I missing something?

> Tom
>
Artem
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Sun Feb 24 11:12:19 2008
From: tom at compton.nu (Tom Hughes)
Date: Sun, 24 Feb 2008 10:12:19 GMT
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <92C7C869-3054-42D8-B7AE-FF064A39C3DD@mapnik.org>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org> 
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org> 
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net> 
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net> 
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com> 
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org> 
	<20504c754f.tom@loxley.compton.nu> <28a24e754f.tom@loxley.compton.nu>
	<92C7C869-3054-42D8-B7AE-FF064A39C3DD@mapnik.org>
Message-ID: <3e9717764f.tom@loxley.compton.nu>

In message <92C7C869-3054-42D8-B7AE-FF064A39C3DD at mapnik.org>
          Artem Pavlenko <artem at mapnik.org> wrote:

> On 22 Feb 2008, at 21:37, Tom Hughes wrote:
> 
> > I just ran a test under valgrind with OSM data and all I found was
> > this:
> >
> > ==17947== Conditional jump or move depends on uninitialised value(s)
> > ==17947==    at 0x4F5663C:
> > mapnik::logical_and<mapnik::feature<mapnik::geometry<mapnik::vertex<do
> > uble, 2> >, boost::shared_ptr<mapnik::raster> > >::pass
> > (mapnik::feature<mapnik::geometry<mapnik::vertex<double, 2> >,
> > boost::shared_ptr<mapnik::raster> > const&) const (logical.hpp:48)
> > ==17947==    by 0x40DE29:
> > mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32>
> > >::apply_to_layer(mapnik::Layer const&,
> > mapnik::agg_renderer<mapnik::Image32>&, mapnik::projection const&,
> > double) (feature_style_processor.hpp:193)
> > ==17947==    by 0x40E45C:
> > mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32>
> > >::apply() (feature_style_processor.hpp:92)
> > ==17947==    by 0x408448: main (mapnik_test.cpp:105)
> 
> Hmm.. looks like valgrind is compailing about lack of default ctor
> which shouldn't be a problem in this case.

No - the problem (as you may have seen from my commit) was that
if PostGIS returned null for an attribute then the plugin didn't
noticed and decoded a buffer of undefined data into a "value" for
the attribute.

That undefinedness then propagated up through the expression
until it hit the conditional in logical_and and triggered the
complaint.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From artem at mapnik.org  Sun Feb 24 11:33:02 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Sun, 24 Feb 2008 10:33:02 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <3e9717764f.tom@loxley.compton.nu>
References: <1190234245.4459.18.camel@localhost.localdomain>
	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>
	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>
	<4784356E.8090704@smartrak.co.nz>
	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>
	<4785297D.7020803@smartrak.co.nz>
	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>
	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>
	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>
	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>
	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
	<20504c754f.tom@loxley.compton.nu>
	<28a24e754f.tom@loxley.compton.nu>
	<92C7C869-3054-42D8-B7AE-FF064A39C3DD@mapnik.org>
	<3e9717764f.tom@loxley.compton.nu>
Message-ID: <348044D4-A35B-476E-BA13-D829A57E339A@mapnik.org>


On 24 Feb 2008, at 10:12, Tom Hughes wrote:

> In message <92C7C869-3054-42D8-B7AE-FF064A39C3DD at mapnik.org>
>           Artem Pavlenko <artem at mapnik.org> wrote:
>
>> On 22 Feb 2008, at 21:37, Tom Hughes wrote:
>>
>>> I just ran a test under valgrind with OSM data and all I found was
>>> this:
>>>
>>> ==17947== Conditional jump or move depends on uninitialised value(s)
>>> ==17947==    at 0x4F5663C:
>>> mapnik::logical_and<mapnik::feature<mapnik::geometry<mapnik::vertex< 
>>> do
>>> uble, 2> >, boost::shared_ptr<mapnik::raster> > >::pass
>>> (mapnik::feature<mapnik::geometry<mapnik::vertex<double, 2> >,
>>> boost::shared_ptr<mapnik::raster> > const&) const (logical.hpp:48)
>>> ==17947==    by 0x40DE29:
>>> mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32 
>>> >
>>>> ::apply_to_layer(mapnik::Layer const&,
>>> mapnik::agg_renderer<mapnik::Image32>&, mapnik::projection const&,
>>> double) (feature_style_processor.hpp:193)
>>> ==17947==    by 0x40E45C:
>>> mapnik::feature_style_processor<mapnik::agg_renderer<mapnik::Image32 
>>> >
>>>> ::apply() (feature_style_processor.hpp:92)
>>> ==17947==    by 0x408448: main (mapnik_test.cpp:105)
>>
>> Hmm.. looks like valgrind is compailing about lack of default ctor
>> which shouldn't be a problem in this case.
>
> No - the problem (as you may have seen from my commit) was that
> if PostGIS returned null for an attribute then the plugin didn't
> noticed and decoded a buffer of undefined data into a "value" for
> the attribute.
>
> That undefinedness then propagated up through the expression
> until it hit the conditional in logical_and and triggered the
> complaint.

Yes, definitely bug. Thanks for the fix. I guess we were getting  
quite a few of these (nulls) from OSM data.

>
> Tom
>
Artem

> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From jburgess777 at googlemail.com  Sun Feb 24 20:22:53 2008
From: jburgess777 at googlemail.com (Jon Burgess)
Date: Sun, 24 Feb 2008 19:22:53 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
Message-ID: <1203880973.3480.175.camel@localhost.localdomain>

The bug fix for the handling of NULL columns in r657 has broken part of
the osm.xml style file. The broken part is an attempts to render
specific fills for certain building types with a fallback for all other
cases where building is non-null.


<Filter>[railway] = 'station' or [building] = 'station'</Filter>
... railway station style
<Filter>[building] = 'supermarket'</Filter>
... supermarket style
<Filter>[building] &lt;&gt; 'station' and [building] &lt;&gt; 'supermarket' and [building] &lt;&gt; ''</Filter>
... style for all other building types


We can not easily use an ElseFilter for this since this style has lots
of other things being rendered not just buildings.

Is there another way to specify a filter equivalent to the SQL "is not
null", or should "[building] <> ''" be working for this? This used to
work before the NULL column fix.

	Jon




From xin at zxv.ltd.uk  Mon Feb 25 17:46:35 2008
From: xin at zxv.ltd.uk (Xin Zheng)
Date: Mon, 25 Feb 2008 16:46:35 +0000
Subject: [Mapnik-devel] comping mapnik viewer
Message-ID: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>

Hi List,

I would like to use map viewer to aid me in developing my XML file. It would
be really useful to see changes straight away, for different zoom levels
without having to generate the tiles first.

I found these previous threads. Although useful, they did not answer my
question of how to compile.
https://lists.berlios.de/pipermail/mapnik-devel/2008-January/000408.html
https://lists.berlios.de/pipermail/mapnik-users/2007-August/000418.html

Does anyone know how to compile this?

Any help is much appreciated.

Xin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080225/bc1ecf9b/attachment.html>

From mr.xzheng at googlemail.com  Mon Feb 25 17:50:01 2008
From: mr.xzheng at googlemail.com (Xin Zheng)
Date: Mon, 25 Feb 2008 16:50:01 +0000
Subject: [Mapnik-devel] comping mapnik viewer
In-Reply-To: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
References: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
Message-ID: <e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>

Hi List,

I would like to use map viewer to aid me in developing my XML file. It would
be really useful to see changes straight away, for different zoom levels
without having to generate the tiles first.

I found these previous threads. Although useful, they did not answer my
question of how to compile.
https://lists.berlios.de/pipermail/mapnik-devel/2008-January/000408.html
https://lists.berlios.de/pipermail/mapnik-users/2007-August/000418.html

Does anyone know how to compile this?

Any help is much appreciated.

Xin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080225/3f0c5d65/attachment.html>

From artem at mapnik.org  Mon Feb 25 19:59:33 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Mon, 25 Feb 2008 18:59:33 +0000
Subject: [Mapnik-devel] comping mapnik viewer
In-Reply-To: <e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>
References: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
	<e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>
Message-ID: <BD302FDE-A35A-4CF2-9BC8-07A68F85FBD6@mapnik.org>

Hi Xin,


> Hi List,
>
> I would like to use map viewer to aid me in developing my XML file.  
> It would be really useful to see changes straight away, for  
> different zoom levels without having to generate the tiles first.
>
> I found these previous threads. Although useful, they did not  
> answer my question of how to compile.
> https://lists.berlios.de/pipermail/mapnik-devel/2008-January/ 
> 000408.html
> https://lists.berlios.de/pipermail/mapnik-users/2007-August/ 
> 000418.html
>
> Does anyone know how to compile this?
>
> Any help is much appreciated.

The viewer is a qt4 application, so first  make sure you have qt4  
properly installed on your system ( including dev )
1. modify viewer.pro to match your system (include, lib directories)
2. modify main.cpp to have correct paths mapnik's  plug-ins and fonts  
dirs
3. qmake
4. make

You could try loading your xml files :

./viewer your.xml

or

./viewer your.xml  -1,50,1,52

or

./viewer   + and open *.xml from file menu

HTH
Cheers
Artem
>
>
> Xin
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080225/e0450045/attachment.html>

From artem at mapnik.org  Mon Feb 25 20:20:32 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Mon, 25 Feb 2008 19:20:32 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <1203880973.3480.175.camel@localhost.localdomain>
References: <1203880973.3480.175.camel@localhost.localdomain>
Message-ID: <47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>


On 24 Feb 2008, at 19:22, Jon Burgess wrote:

> The bug fix for the handling of NULL columns in r657 has broken  
> part of
> the osm.xml style file. The broken part is an attempts to render
> specific fills for certain building types with a fallback for all  
> other
> cases where building is non-null.
>
>
> <Filter>[railway] = 'station' or [building] = 'station'</Filter>
> ... railway station style
> <Filter>[building] = 'supermarket'</Filter>
> ... supermarket style
> <Filter>[building] &lt;&gt; 'station' and [building] &lt;&gt;  
> 'supermarket' and [building] &lt;&gt; ''</Filter>
> ... style for all other building types
>
>
> We can not easily use an ElseFilter for this since this style has lots
> of other things being rendered not just buildings.
>
> Is there another way to specify a filter equivalent to the SQL "is not
> null", or should "[building] <> ''" be working for this? This used to
> work before the NULL column fix.

There are couple ways to solve this :
1. introduce "null" value as a special case.
2. amend SQL statement to include ".. char_length(building) as  
len..." and construct filter like:
[building] &lt;&gt; 'station' and [building] &lt;&gt; 'supermarket'  
and [len] > 0 ; ''

There're probably other ways to handle this case.

Generally I don't think it is that great to have so many columns  
which are NULLs in OSM schema and use those NULLs for data filtering.  
We should probably split data into multiple logical tables and even  
'flatten' data by introducing some sort of numeric feature code :

[fcode] = 123123

and lookup table

fcode       |  desc
------------------
123123   |  supermarche
123124   |  station

On related note,  should we have 'boolean' type for values?


>
> 	Jon
>
Artem

>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Tue Feb 26 01:09:17 2008
From: tom at compton.nu (Tom Hughes)
Date: Tue, 26 Feb 2008 00:09:17 GMT
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
Message-ID: <980de8764f.tom@loxley.compton.nu>

In message <47347AC3-AA96-48F9-9D4A-F6CF5315C3EC at mapnik.org>
          Artem Pavlenko <artem at mapnik.org> wrote:

> On related note,  should we have 'boolean' type for values?

I actually started playing with this yesterday ;-)

Are you actually thinking of allowing boolean attributes in place
of conditional expressions - ie something like:

  [highway] = 'primary' and [bridge]

or just allowing comparison with boolean constants like:

  [highway] = 'primary' and [bridge] = true

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From tom at compton.nu  Tue Feb 26 01:13:01 2008
From: tom at compton.nu (Tom Hughes)
Date: Tue, 26 Feb 2008 00:13:01 GMT
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <1203880973.3480.175.camel@localhost.localdomain>
References: <1203880973.3480.175.camel@localhost.localdomain>
Message-ID: <3165e8764f.tom@loxley.compton.nu>

In message <1203880973.3480.175.camel at localhost.localdomain>
          Jon Burgess <jburgess777 at googlemail.com> wrote:

> The bug fix for the handling of NULL columns in r657 has broken part of
> the osm.xml style file. The broken part is an attempts to render
> specific fills for certain building types with a fallback for all other
> cases where building is non-null.
> 
> 
> <Filter>[railway] = 'station' or [building] = 'station'</Filter>
> ... railway station style
> <Filter>[building] = 'supermarket'</Filter>
> ... supermarket style
> <Filter>[building] &lt;&gt; 'station' and [building] &lt;&gt; 'supermarket' and [building] &lt;&gt; ''</Filter>
> ... style for all other building types
> 
> 
> We can not easily use an ElseFilter for this since this style has lots
> of other things being rendered not just buildings.
> 
> Is there another way to specify a filter equivalent to the SQL "is not
> null", or should "[building] <> ''" be working for this? This used to
> work before the NULL column fix.

Well at the moment a null column is equivalent to the attribute not
existing for the feature, as the PostGIS input plugin will simply not
assign anything to that attribute.

Normal SQL rules would mean that no ordinary relational condition
would match for a null value - that's the wonder of ternary logic
for you ;-) Hence the special IS NULL and IS NOT NULL conditions
in SQL.

I guess we could have some sort of "attribute exists" test in the
mapnik expression syntax?

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From freeman at internet.co.nz  Tue Feb 26 02:12:14 2008
From: freeman at internet.co.nz (Jim Waite)
Date: Tue, 26 Feb 2008 14:12:14 +1300
Subject: [Mapnik-devel] agg_renderer<T>   beginner question.
Message-ID: <000001c87814$9f09d580$2100a8c0@optima.local>


Hi
As a programmer unfamiliar with templates or the "boost" way of doing
things, this may well be a stupid question... but here goes:

Why is agg_renderer a template class?

It is declared like so:
   template <typename T>
   class MAPNIK_DECL agg_renderer : public
feature_style_processor<agg_renderer<T> >,   
                                    private boost::noncopyable

But the template parameter "T" is never used anywhere in the class
definition (other than to pass it through to feature_style_processor, which
seems irrelevant).


The rundemo.cpp example application uses agg_renderer like so:

        Image32 buf(m.getWidth(),m.getHeight());
        agg_renderer<Image32> ren(m,buf);

To me, it would seem that the programmer's intention is that agg_renderer
could render to whatever class we put inside the <>  (Image32 in this case).
But that's not how the code works (for example, the constructor for
agg_renderer always takes an Image32.. no matter how you declare your
particular instantiation of agg_renderer).  You cannot do the following, for
example"

        SomeOtherSortOfImage buf(m.getWidth(),m.getHeight());   
        agg_renderer<SomeOtherSortOfImage> ren(m,buf);


Thanks for indulging me,
Jim Waite.




From artem at mapnik.org  Tue Feb 26 09:46:44 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Tue, 26 Feb 2008 08:46:44 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <980de8764f.tom@loxley.compton.nu>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<980de8764f.tom@loxley.compton.nu>
Message-ID: <76121D90-EE63-47AB-85BD-3E8667AD3937@mapnik.org>


On 26 Feb 2008, at 00:09, Tom Hughes wrote:

> In message <47347AC3-AA96-48F9-9D4A-F6CF5315C3EC at mapnik.org>
>           Artem Pavlenko <artem at mapnik.org> wrote:
>
>> On related note,  should we have 'boolean' type for values?
>
> I actually started playing with this yesterday ;-)

Great!
>
> Are you actually thinking of allowing boolean attributes in place
> of conditional expressions - ie something like:
>
>   [highway] = 'primary' and [bridge]
>
> or just allowing comparison with boolean constants like:
>
>   [highway] = 'primary' and [bridge] = true

I think we should allow following:

[bridge]
not [bridge]
[bridge] = {True,False}


>
> Tom
>
Artem
> -- 
> Tom Hughes (tom at compton.nu)
> http://www.compton.nu/
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Tue Feb 26 09:49:57 2008
From: tom at compton.nu (Tom Hughes)
Date: Tue, 26 Feb 2008 08:49:57 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <76121D90-EE63-47AB-85BD-3E8667AD3937@mapnik.org> (Artem
	Pavlenko's message of "Tue\, 26 Feb 2008 08\:46\:44 +0000")
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<980de8764f.tom@loxley.compton.nu>
	<76121D90-EE63-47AB-85BD-3E8667AD3937@mapnik.org>
Message-ID: <yeklk58xft6.fsf@dellow.uk.cyberscience.com>

In message <76121D90-EE63-47AB-85BD-3E8667AD3937 at mapnik.org>
        Artem Pavlenko <artem at mapnik.org> wrote:

> On 26 Feb 2008, at 00:09, Tom Hughes wrote:
>
>> Are you actually thinking of allowing boolean attributes in place
>> of conditional expressions - ie something like:
>>
>>   [highway] = 'primary' and [bridge]
>>
>> or just allowing comparison with boolean constants like:
>>
>>   [highway] = 'primary' and [bridge] = true
>
> I think we should allow following:
>
> [bridge]
> not [bridge]
> [bridge] = {True,False}

I have the latter at the moment but not the former. I'll see
what I can do about extending it to cover both.

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From artem at mapnik.org  Tue Feb 26 09:58:47 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Tue, 26 Feb 2008 08:58:47 +0000
Subject: [Mapnik-devel] agg_renderer<T>   beginner question.
In-Reply-To: <000001c87814$9f09d580$2100a8c0@optima.local>
References: <000001c87814$9f09d580$2100a8c0@optima.local>
Message-ID: <C06CCBD0-444F-45BA-9631-5779A11EF083@mapnik.org>


On 26 Feb 2008, at 01:12, Jim Waite wrote:

>
> Hi
> As a programmer unfamiliar with templates or the "boost" way of doing
> things, this may well be a stupid question... but here goes:
>
> Why is agg_renderer a template class?
>
> It is declared like so:
>    template <typename T>
>    class MAPNIK_DECL agg_renderer : public
> feature_style_processor<agg_renderer<T> >,
>                                     private boost::noncopyable
>
> But the template parameter "T" is never used anywhere in the class
> definition (other than to pass it through to  
> feature_style_processor, which
> seems irrelevant).

Well spotted, this was a bug (harmless:)  that sneaked in quite  
recently. Fixed in r658.
>
>
> The rundemo.cpp example application uses agg_renderer like so:
>
>         Image32 buf(m.getWidth(),m.getHeight());
>         agg_renderer<Image32> ren(m,buf);
>
> To me, it would seem that the programmer's intention is that  
> agg_renderer
> could render to whatever class we put inside the <>  (Image32 in  
> this case).

Yes, the intention was to be able to instantiate agg_renderer with  
different image types, given they provide suitable interface. In  
reality. because the way template instantiation mechanism works and  
how agg_renderer is implemented at the moment, only  
agg_renderer=<Image32> is accessible from client code. This will  
change in a future.

> But that's not how the code works (for example, the constructor for
> agg_renderer always takes an Image32.. no matter how you declare your
> particular instantiation of agg_renderer).  You cannot do the  
> following, for
> example"
>
>         SomeOtherSortOfImage buf(m.getWidth(),m.getHeight());
>         agg_renderer<SomeOtherSortOfImage> ren(m,buf);

OK. try now (r658) and you should get nice compilation error :)
>
>
> Thanks for indulging me,


> Jim Waite.
>

Thanks highlighting this

Artem
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From artem.mapnik at googlemail.com  Tue Feb 26 12:50:14 2008
From: artem.mapnik at googlemail.com (Artem Pavlenko)
Date: Tue, 26 Feb 2008 11:50:14 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <47BF3A3A.1090601@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
	<47BF3A3A.1090601@gmail.com>
Message-ID: <1A70F46B-97FA-4F7F-9A13-FD623821C5FC@gmail.com>

Justin,

Could you try latest trunk and let me know if it's working for you  
(in release mode).
Also, I added support for transcoding strings in filter expressions ,  
which seems to play with Python:

#!/usr/bin/env python
# -*- coding: utf-8 -*-

..........
provpoly_rule_qc.filter = Filter("[NOM_FR] = 'Qu?bec'") # any UTF8  
string should work! Actual value in DBF is in latin1

.......

Artem


On 22 Feb 2008, at 21:10, Justin Bronn wrote:

>
>> I have some ideas and I'll come up with fix asap. Could, please,  
>> verify that  sizeof(wchar_t) == 4 on Max OS X ?
>
> I used the attached code to test that size; the program prints "4".
>
> Also attached is the original segmentation fault traceback for  
> those inquiring minds.
>
> -Justin
> // Compiles with: g++ -Wall -pedantic -o wchar_check wchar_check.cpp
> #include <iostream>
> int main(){
>   std::cout << sizeof(wchar_t) << std::endl;
> }
> Process:         Python [57889]
> Path:            /Library/Frameworks/Python.framework/Versions/2.5/ 
> Resources/Python.app/Contents/MacOS/Python
> Identifier:      Python
> Version:         ??? (???)
> Code Type:       X86 (Native)
> Parent Process:  bash [4266]
>
> Date/Time:       2008-02-22 12:19:00.551 -0600
> OS Version:      Mac OS X 10.5.2 (9C31)
> Report Version:  6
>
> Exception Type:  EXC_BAD_ACCESS (SIGBUS)
> Exception Codes: KERN_PROTECTION_FAILURE at 0x0000000000000000
> Crashed Thread:  0
>
> Thread 0 Crashed:
> 0   ???                           	0000000000 0 + 0
> 1   libmapnik.dylib               	0x00bc25b4  
> boost::spirit::grammar<mapnik::filter_grammar<mapnik::feature<mapnik:: 
> geometry<mapnik::vertex<double, 2> >,  
> boost::shared_ptr<mapnik::raster> > >,  
> boost::spirit::parser_context<boost::spirit::nil_t> >::~grammar() +  
> 100
> 2   libmapnik.dylib               	0x00bef6af  
> mapnik::filter_factory<mapnik::feature<mapnik::geometry<mapnik::vertex 
> <double, 2> >, boost::shared_ptr<mapnik::raster> > >::compile 
> (std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&) + 1295
> 3   libmapnik.dylib               	0x00bba479 mapnik::create_filter 
> (std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&) + 25
> 4   _mapnik.so                    	0x009677ac  
> boost::python::objects::caller_py_function_impl<boost::python::detail: 
> :caller<boost::shared_ptr<mapnik::filter<mapnik::feature<mapnik::geome 
> try<mapnik::vertex<double, 2> >, boost::shared_ptr<mapnik::raster>  
> > > > (*)(std::basic_string<char, std::char_traits<char>,  
> std::allocator<char> > const&),  
> boost::python::default_call_policies,  
> boost::mpl::vector2<boost::shared_ptr<mapnik::filter<mapnik::feature<m 
> apnik::geometry<mapnik::vertex<double, 2> >,  
> boost::shared_ptr<mapnik::raster> > > >, std::basic_string<char,  
> std::char_traits<char>, std::allocator<char> > const&> > >::operator 
> ()(_object*, _object*) + 140
> 5   _mapnik.so                    	0x009fad24  
> boost::python::objects::function::call(_object*, _object*) const + 468
> 6   _mapnik.so                    	0x009fcf95  
> boost::detail::function::void_function_ref_invoker0<boost::python::obj 
> ects::(anonymous namespace)::bind_return, void>::invoke 
> (boost::detail::function::function_buffer&) + 37
> 7   _mapnik.so                    	0x00a02e79  
> boost::function0<void, std::allocator<boost::function_base>  
> >::operator()() const + 41
> 8   _mapnik.so                    	0x00a02d90  
> boost::python::detail::exception_handler::operator() 
> (boost::function0<void, std::allocator<boost::function_base> >  
> const&) const + 256
> 9   _mapnik.so                    	0x009a3024  
> boost::detail::function::function_obj_invoker2<boost::_bi::bind_t<bool 
> , boost::python::detail::translate_exception<mapnik::config_error,  
> void (*)(mapnik::config_error const&)>,  
> boost::_bi::list3<boost::arg<1> (*)(), boost::arg<2> (*)(),  
> boost::_bi::value<void (*)(mapnik::config_error const&)> > >, bool,  
> boost::python::detail::exception_handler const&,  
> boost::function0<void, std::allocator<boost::function_base> >  
> const&>::invoke(boost::detail::function::function_buffer&,  
> boost::python::detail::exception_handler const&,  
> boost::function0<void, std::allocator<boost::function_base> >  
> const&) + 36
> 10  _mapnik.so                    	0x00a029bf  
> boost::python::handle_exception_impl(boost::function0<void,  
> std::allocator<boost::function_base> >) + 63
> 11  _mapnik.so                    	0x009f8c4c function_call + 108
> 12  org.python.python             	0x003f9278 PyObject_Call + 45  
> (abstract.c:1860)
> 13  org.python.python             	0x00480851 PyEval_EvalFrameEx +  
> 9242 (ceval.c:3775)
> 14  org.python.python             	0x00484cdc PyEval_EvalCodeEx +  
> 1819 (ceval.c:2831)
> 15  org.python.python             	0x00484e90 PyEval_EvalCode + 87  
> (ceval.c:500)
> 16  org.python.python             	0x004a8100 PyRun_FileExFlags +  
> 260 (pythonrun.c:1271)
> 17  org.python.python             	0x004a849a  
> PyRun_SimpleFileExFlags + 640 (pythonrun.c:877)
> 18  org.python.python             	0x004b5bb6 Py_Main + 3077  
> (main.c:523)
> 19  org.python.python             	0x00001f8e 0x1000 + 3982
> 20  org.python.python             	0x00001eb5 0x1000 + 3765
>
> Thread 0 crashed with X86 Thread State (32-bit):
>   eax: 0x00839f30  ebx: 0x00befd71  ecx: 0x00000000  edx: 0xbfffed38
>   edi: 0x00839c00  esi: 0x00839ba0  ebp: 0xbfffea48  esp: 0xbfffe9ec
>    ss: 0x0000001f  efl: 0x00010206  eip: 0x00000000   cs: 0x00000017
>    ds: 0x0000001f   es: 0x0000001f   fs: 0x00000000   gs: 0x00000037
>   cr2: 0x00000000
>
> Binary Images:
>     0x1000 -     0x1fff +org.python.python 2.5a0 (2.5alpha0) / 
> Library/Frameworks/Python.framework/Versions/2.5/Resources/ 
> Python.app/Contents/MacOS/Python
>    0xbb000 -    0xbbfff +dl.so ??? (???) /Library/Frameworks/ 
> Python.framework/Versions/2.5/lib/python2.5/lib-dynload/dl.so
>    0xc2000 -    0xe1ff3 +libpng12.0.dylib ??? (???)  
> <cef32b20f18ce312f8cbf0d1f1b85d8e> /usr/local/lib/libpng12.0.dylib
>   0x3f0000 -   0x4e4fc3 +org.python.python 2.5a0 (2.5) /Library/ 
> Frameworks/Python.framework/Versions/2.5/Python
>   0x7e0000 -   0x7e3ffc  libltdl.3.dylib ??? (???)  
> <aadaf4c9f65c2f3b25f6e2cce0a2ad3e> /usr/lib/libltdl.3.dylib
>   0x7e9000 -   0x7f1ff7 +libgeos_c.1.dylib ??? (???)  
> <516159108ff8d4e4c21aa8d7974ef315> /usr/local/lib/libgeos_c.1.dylib
>   0x940000 -   0xa4aff7 +_mapnik.so ??? (???) /Library/Frameworks/ 
> Python.framework/Versions/2.5/lib/python2.5/site-packages/mapnik/ 
> _mapnik.so
>   0xb9a000 -   0xc95feb +libmapnik.dylib ??? (???) /usr/local/lib/ 
> libmapnik.dylib
>   0xd44000 -   0xd60ff8 +libjpeg.62.dylib ??? (???) /usr/local/lib/ 
> libjpeg.62.dylib
>   0xd67000 -   0xe49fff +libicuuc.38.dylib ??? (???)  
> <cf6aca883c640fa850b299b1c0c9e43e> /usr/local/lib/libicuuc.38.dylib
>   0xec7000 -   0xf13fef +libtiff.3.dylib ??? (???)  
> <dfe7782f1abe5e190f053f2de3326917> /usr/local/lib/libtiff.3.dylib
>   0xf28000 -   0xf58fff +libproj.0.dylib ??? (???)  
> <83f197bc7b0c2b748089f40f2e4254ca> /usr/local/lib/libproj.0.dylib
>   0xf72000 -   0xf86fef +libpq.5.dylib ??? (???) /usr/local/lib/ 
> libpq.5.dylib
>   0xf8e000 -   0xfa5fe8 +libexpat.0.1.0.dylib ??? (???) /usr/local/ 
> lib/libexpat.0.1.0.dylib
>   0xfdf000 -   0xfe4fff +gdal.input ??? (???) /usr/local/lib/mapnik/ 
> input/gdal.input
>   0xfeb000 -   0xff2fff +raster.input ??? (???) /usr/local/lib/ 
> mapnik/input/raster.input
>  0x1800000 -  0x22d5fff +libicudata.38.dylib ??? (???) /usr/local/ 
> lib/libicudata.38.dylib
>  0x22d8000 -  0x2337fd7 +libfreetype.6.dylib ??? (???) /usr/local/ 
> lib/libfreetype.6.dylib
>  0x24cf000 -  0x2815fe2 +libgdal.1.dylib ??? (???)  
> <fb0f1d211e10893fb4788abb12d8c78b> /usr/local/lib/libgdal.1.dylib
>  0x2a02000 -  0x2ab9ffb +libgeos-3.0.0.dylib ??? (???)  
> <a131d0531dffc6da1700fd204c99cb3e> /usr/local/lib/libgeos-3.0.0.dylib
>  0x2bb3000 -  0x2cddfff +libhdf5.0.dylib ??? (???) /usr/local/lib/ 
> libhdf5.0.dylib
>  0x2d04000 -  0x2d2fffb  libcurl.4.dylib ??? (???)  
> <54ada27deb3b4ff7043d8836264eca0d> /usr/lib/libcurl.4.dylib
>  0x2d39000 -  0x2d4dff7 +postgis.input ??? (???) /usr/local/lib/ 
> mapnik/input/postgis.input
>  0x2d5c000 -  0x2d77fff +shape.input ??? (???) /usr/local/lib/ 
> mapnik/input/shape.input
> 0x8fe00000 - 0x8fe2da53  dyld 96.2 (???)  
> <7af47d3b00b2268947563c7fa8c59a07> /usr/lib/dyld
> 0x90003000 - 0x90003ff8  com.apple.ApplicationServices 34 (34)  
> <8f910fa65f01d401ad8d04cc933cf887> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/ApplicationServices
> 0x90092000 - 0x9072bfff  com.apple.CoreGraphics 1.351.21 (???)  
> <6c93fd21149f389129fe47fa6ef71880> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> CoreGraphics.framework/Versions/A/CoreGraphics
> 0x9093b000 - 0x909e2feb  com.apple.QD 3.11.52 (???)  
> <c72bd7bd2ce12694c3640a731d1ad878> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/QD.framework/ 
> Versions/A/QD
> 0x90f55000 - 0x90f5cfe9  libgcc_s.1.dylib ??? (???)  
> <a9ab135a5f81f6e345527df87f51bfc9> /usr/lib/libgcc_s.1.dylib
> 0x9213b000 - 0x924f9fea  libLAPACK.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libLAPACK.dylib
> 0x924fa000 - 0x92518fff  libresolv.9.dylib ??? (???)  
> <0629b6dcd71f4aac6a891cbe26253e85> /usr/lib/libresolv.9.dylib
> 0x9257f000 - 0x925b6fff  com.apple.SystemConfiguration 1.9.1  
> (1.9.1) <8a76e429301afe4eba1330bfeaabd9f2> /System/Library/ 
> Frameworks/SystemConfiguration.framework/Versions/A/ 
> SystemConfiguration
> 0x92a8b000 - 0x92ae5ff7  com.apple.CoreText 2.0.1 (???)  
> <07494945ad1e3f5395599f42748457cc> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> CoreText.framework/Versions/A/CoreText
> 0x92ae6000 - 0x92b60ff8  com.apple.print.framework.PrintCore 5.5.2  
> (245.1) <3c9de512e95fbd838694ee5008d56a28> /System/Library/ 
> Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ 
> PrintCore.framework/Versions/A/PrintCore
> 0x92c4b000 - 0x92ca8ffb  libstdc++.6.dylib ??? (???)  
> <04b812dcec670daa8b7d2852ab14be60> /usr/lib/libstdc++.6.dylib
> 0x92ce4000 - 0x92d0ffe7  libauto.dylib ??? (???)  
> <42d8422dc23a18071869fdf7b5d8fab5> /usr/lib/libauto.dylib
> 0x92d10000 - 0x93120fef  libBLAS.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libBLAS.dylib
> 0x93947000 - 0x93a28ff7  libxml2.2.dylib ??? (???)  
> <450ec38b57fb46013847cce851001a2f> /usr/lib/libxml2.2.dylib
> 0x93a2d000 - 0x93a51fff  libxslt.1.dylib ??? (???)  
> <4933ddc7f6618743197aadc85b33b5ab> /usr/lib/libxslt.1.dylib
> 0x93a52000 - 0x93b04ffb  libcrypto.0.9.7.dylib ??? (???)  
> <330b0e48e67faffc8c22dfc069ca7a47> /usr/lib/libcrypto.0.9.7.dylib
> 0x93b2f000 - 0x93b2fffd  com.apple.Accelerate 1.4.2 (Accelerate  
> 1.4.2) /System/Library/Frameworks/Accelerate.framework/Versions/A/ 
> Accelerate
> 0x93e45000 - 0x93ed8ff3  com.apple.ApplicationServices.ATS 3.2  
> (???) <cdf31bd0ac7de54a35ee2d27cf86b6be> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ATS.framework/ 
> Versions/A/ATS
> 0x9426e000 - 0x94270ff5  libRadiance.dylib ??? (???)  
> <b9e04afa91e4b597a00797d67a7268fb> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libRadiance.dylib
> 0x94271000 - 0x94350fff  libobjc.A.dylib ??? (???)  
> <a53206274b6c2d42691f677863f379ae> /usr/lib/libobjc.A.dylib
> 0x943b9000 - 0x943c7ffd  libz.1.dylib ??? (???)  
> <5ddd8539ae2ebfd8e7cc1c57525385c7> /usr/lib/libz.1.dylib
> 0x94679000 - 0x94952ff3  com.apple.CoreServices.CarbonCore 785.8  
> (785.8) <827c228e7d717b397cdb4941eba69553> /System/Library/ 
> Frameworks/CoreServices.framework/Versions/A/Frameworks/ 
> CarbonCore.framework/Versions/A/CarbonCore
> 0x94953000 - 0x94972ffa  libJPEG.dylib ??? (???)  
> <0dd7e9d7fb22174b78205a944144f9c3> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libJPEG.dylib
> 0x94cae000 - 0x94cfeff7  com.apple.HIServices 1.7.0 (???)  
> <f7e78891a6d08265c83dca8e378be1ea> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> HIServices.framework/Versions/A/HIServices
> 0x94cff000 - 0x94d23feb  libssl.0.9.7.dylib ??? (???)  
> <acee7fc534674498dcac211318aa23e8> /usr/lib/libssl.0.9.7.dylib
> 0x94d81000 - 0x94ffbfe7  com.apple.Foundation 6.5.4 (677.15)  
> <6216196287f98a65ddb654d04d773e7b> /System/Library/Frameworks/ 
> Foundation.framework/Versions/C/Foundation
> 0x95097000 - 0x95097ffd  com.apple.Accelerate.vecLib 3.4.2 (vecLib  
> 3.4.2) /System/Library/Frameworks/Accelerate.framework/Versions/A/ 
> Frameworks/vecLib.framework/Versions/A/vecLib
> 0x9509f000 - 0x95159fe3  com.apple.CoreServices.OSServices 224.4  
> (224.4) <ff5007ab220908ac54b6c661e447d593> /System/Library/ 
> Frameworks/CoreServices.framework/Versions/A/Frameworks/ 
> OSServices.framework/Versions/A/OSServices
> 0x952c3000 - 0x9538efff  com.apple.ColorSync 4.5.0 (4.5.0) /System/ 
> Library/Frameworks/ApplicationServices.framework/Versions/A/ 
> Frameworks/ColorSync.framework/Versions/A/ColorSync
> 0x9539a000 - 0x95417fef  libvMisc.dylib ??? (???) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vecLib.framework/Versions/A/libvMisc.dylib
> 0x95420000 - 0x9545ffef  libTIFF.dylib ??? (???)  
> <76301b3506f310fb454b58897c8d0a9f> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libTIFF.dylib
> 0x95460000 - 0x95468fff  com.apple.DiskArbitration 2.2.1 (2.2.1)  
> <75b0c8d8940a8a27816961dddcac8e0f> /System/Library/Frameworks/ 
> DiskArbitration.framework/Versions/A/DiskArbitration
> 0x954e5000 - 0x9556cff7  libsqlite3.0.dylib ??? (???)  
> <6978bbcca4277d6ae9f042beff643f7d> /usr/lib/libsqlite3.0.dylib
> 0x9556d000 - 0x95571fff  libmathCommon.A.dylib ??? (???) /usr/lib/ 
> system/libmathCommon.A.dylib
> 0x9557c000 - 0x95607fff  com.apple.framework.IOKit 1.5.1 (???)  
> <a17f9f5ea7e8016a467e67349f4d3d03> /System/Library/Frameworks/ 
> IOKit.framework/Versions/A/IOKit
> 0x95608000 - 0x9561efff  com.apple.DictionaryServices 1.0.0 (1.0.0)  
> <ad0aa0252e3323d182e17f50defe56fc> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/ 
> DictionaryServices.framework/Versions/A/DictionaryServices
> 0x9561f000 - 0x956e6ff2  com.apple.vImage 3.0 (3.0) /System/Library/ 
> Frameworks/Accelerate.framework/Versions/A/Frameworks/ 
> vImage.framework/Versions/A/vImage
> 0x956e7000 - 0x958b2ff7  com.apple.security 5.0.2 (33001)  
> <0788969ffe7961153219be10786da436> /System/Library/Frameworks/ 
> Security.framework/Versions/A/Security
> 0x95a1d000 - 0x95a62fef  com.apple.Metadata 10.5.2 (398.7)  
> <73a6424c06effc474e699cde6883de99> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/Metadata.framework/ 
> Versions/A/Metadata
> 0x95a63000 - 0x95a63ffa  com.apple.CoreServices 32 (32)  
> <2fcc8f3bd5bbfc000b476cad8e6a3dd2> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/CoreServices
> 0x95a64000 - 0x95a93fe3  com.apple.AE 402.2 (402.2)  
> <e01596187e91af5d48653920017b8c8e> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/AE.framework/Versions/ 
> A/AE
> 0x95a97000 - 0x95ab2ffb  libPng.dylib ??? (???)  
> <85ca18172d7a4b5a5be3574e4e879880> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libPng.dylib
> 0x95ec2000 - 0x95ec9ffe  libbsm.dylib ??? (???)  
> <d25c63378a5029648ffd4b4669be31bf> /usr/lib/libbsm.dylib
> 0x96261000 - 0x963a6ff7  com.apple.ImageIO.framework 2.0.1 (2.0.1)  
> <68ba11e689a9ca30f8310935cd1e02d6> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/ImageIO
> 0x963a7000 - 0x96457fff  edu.mit.Kerberos 6.0.12 (6.0.12)  
> <9e98dfb4cde8b0510fdd972dc9fa1dc9> /System/Library/Frameworks/ 
> Kerberos.framework/Versions/A/Kerberos
> 0x96458000 - 0x964d7ff5  com.apple.SearchKit 1.2.0 (1.2.0)  
> <277b460da86bc222785159fe77e2e2ed> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/SearchKit.framework/ 
> Versions/A/SearchKit
> 0x9658a000 - 0x96601fe3  com.apple.CFNetwork 221.5 (221.5)  
> <5474cdd7d2a8b2e8059de249c702df9e> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/CFNetwork.framework/ 
> Versions/A/CFNetwork
> 0x96602000 - 0x96734fef  com.apple.CoreFoundation 6.5.1 (476.10)  
> <d5bed2688a5eea11a6dc3a3c5c17030e> /System/Library/Frameworks/ 
> CoreFoundation.framework/Versions/A/CoreFoundation
> 0x967a8000 - 0x967cefff  libcups.2.dylib ??? (???)  
> <85ce204da14d62d6a3a5a9adfba01455> /usr/lib/libcups.2.dylib
> 0x9681f000 - 0x9697eff3  libSystem.B.dylib ??? (???)  
> <4899376234e55593b22fc370935f8cdf> /usr/lib/libSystem.B.dylib
> 0x96984000 - 0x96994fff  com.apple.speech.synthesis.framework  
> 3.6.59 (3.6.59) <4ffef145fad3d4d787e0c33eab26b336> /System/Library/ 
> Frameworks/ApplicationServices.framework/Versions/A/Frameworks/ 
> SpeechSynthesis.framework/Versions/A/SpeechSynthesis
> 0x96995000 - 0x969c2feb  libvDSP.dylib ??? (???)  
> <b232c018ddd040ec4e2c2af632dd497f> /System/Library/Frameworks/ 
> Accelerate.framework/Versions/A/Frameworks/vecLib.framework/ 
> Versions/A/libvDSP.dylib
> 0x969c7000 - 0x96abbff4  libiconv.2.dylib ??? (???)  
> <c508c60fafca17824c0017b2e4369802> /usr/lib/libiconv.2.dylib
> 0x96be4000 - 0x96be8fff  libGIF.dylib ??? (???)  
> <b8f61e346fa243a7138910bed3dcdb6b> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> ImageIO.framework/Versions/A/Resources/libGIF.dylib
> 0x96c2c000 - 0x96c3cffc  com.apple.LangAnalysis 1.6.4 (1.6.4)  
> <cbeb17ab39f28351fe2ab5b82bf465bc> /System/Library/Frameworks/ 
> ApplicationServices.framework/Versions/A/Frameworks/ 
> LangAnalysis.framework/Versions/A/LangAnalysis
> 0x96c3f000 - 0x96d77ff7  libicucore.A.dylib ??? (???)  
> <afcea652ff2ec36885b2c81c57d06d4c> /usr/lib/libicucore.A.dylib
> 0x96db6000 - 0x96e42ff7  com.apple.LaunchServices 286.5 (286.5)  
> <33c3ae54abb276b61a99d4c764d883e2> /System/Library/Frameworks/ 
> CoreServices.framework/Versions/A/Frameworks/ 
> LaunchServices.framework/Versions/A/LaunchServices
> 0xfffe8000 - 0xfffebfff  libobjc.A.dylib ??? (???) /usr/lib/ 
> libobjc.A.dylib
> 0xffff0000 - 0xffff1780  libSystem.B.dylib ??? (???) /usr/lib/ 
> libSystem.B.dylib
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel



From artem.mapnik at googlemail.com  Tue Feb 26 13:02:35 2008
From: artem.mapnik at googlemail.com (Artem Pavlenko)
Date: Tue, 26 Feb 2008 12:02:35 +0000
Subject: [Mapnik-devel] Segmentation fault when running rundemo.py
In-Reply-To: <1A70F46B-97FA-4F7F-9A13-FD623821C5FC@gmail.com>
References: <1190234245.4459.18.camel@localhost.localdomain>	<E27BD1A5-CB9C-434C-AAAE-DB1F22F5AAD2@mapnik.org>	<1190386096.46f3d9b0e4636@webmail.freedom2surf.net>	<4784356E.8090704@smartrak.co.nz>	<4ED81A32-0851-4E0B-BA68-3A11C9722DB2@mapnik.org>	<4785297D.7020803@smartrak.co.nz>	<44D183B6-80E2-47FA-AEC6-702C00278BFF@hailmail.net>	<538A1B61-99AA-4662-93B4-55C55042EA0C@hailmail.net>	<C2068318-87B2-42D0-A4CE-09BAB3F975C0@mapnik.org>	<3834E3EB-6407-4C34-9A99-8A70A365B0FD@hailmail.net>	<FC8E11CC-65F0-40A6-964B-0F635C84B9A0@hailmail.net>
	<C5F80A32-EED9-47BC-BBA1-D70D5FFE4529@mapnik.org>
	<47BEE056.4050500@gmail.com>
	<DDA5EF37-9455-4022-948E-0E8B21A6AE71@mapnik.org>
	<47BF1B82.8030200@gmail.com>
	<74F5E71A-F596-40BD-9EA2-1EFA80BFFE88@mapnik.org>
	<47BF3A3A.1090601@gmail.com>
	<1A70F46B-97FA-4F7F-9A13-FD623821C5FC@gmail.com>
Message-ID: <AE60288E-16D9-429B-BE35-430996ECA635@gmail.com>

<snip>

> Also, I added support for transcoding strings in filter expressions ,
> which seems to play with Python:
play nicely :)

Artem



From xin at zenpow.com  Tue Feb 26 15:33:21 2008
From: xin at zenpow.com (Xin)
Date: Tue, 26 Feb 2008 14:33:21 +0000
Subject: [Mapnik-devel] comping mapnik viewer
In-Reply-To: <BD302FDE-A35A-4CF2-9BC8-07A68F85FBD6@mapnik.org>
References: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
	<e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>
	<BD302FDE-A35A-4CF2-9BC8-07A68F85FBD6@mapnik.org>
Message-ID: <b3b5e5690802260633u663a905ax2e16b119049e9929@mail.gmail.com>

Hi Artem,

Thank you for the quick reply.

I managed to compile Viewer. But when I open my map definition file, I get
this error:

Could not create datasource. No plugin found for type 'shape' in layer
'world-1'

As you can see, my map definition uses shape files. This definition works
fine with generate_image.py.

A snippet from main.cpp:
   datasource_cache::instance()->register_datasources("/home/xin/src/mapnik-
0.5.0/plugins/input");

   freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/dejavu-
ttf-2.14/DejaVuSans.ttf");
   freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/dejavu-
ttf-2.14/DejaVuSans-Bold.ttf");
   freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/dejavu-
ttf-2.14/DejaVuSansMono.ttf");

I compiled Mapnik too so that plugins/input has the lib files. ls
plugins/input :

gdal  Makefile.am  postgis  raster  shape

ls plugins/input/shape:
dbffile.cpp   SConscript            shapefile.cpp
shape_index_featureset.cpp  shape_io.hpp
dbffile.hpp   shape.cpp             shapefile.hpp
shape_index_featureset.hpp  shape_io.os
dbffile.os    shape_featureset.cpp  shapefile.o
shape_index_featureset.os   shape.os
dbf_test.cpp  shape_featureset.hpp  shapefile.os   shape.input
shp_index.hpp
Makefile.am   shape_featureset.os   shape.hpp      shape_io.cpp

What do you think?

Thanks,
Xin

On 25/02/2008, Artem Pavlenko <artem at mapnik.org> wrote:
>
> Hi Xin,
>
> Hi List,
>
> I would like to use map viewer to aid me in developing my XML file. It
> would be really useful to see changes straight away, for different zoom
> levels without having to generate the tiles first.
>
> I found these previous threads. Although useful, they did not answer my
> question of how to compile.
> https://lists.berlios.de/pipermail/mapnik-devel/2008-January/000408.html
> https://lists.berlios.de/pipermail/mapnik-users/2007-August/000418.html
>
> Does anyone know how to compile this?
>
> Any help is much appreciated.
>
>
> The viewer is a qt4 application, so first  make sure you have qt4 properly
> installed on your system ( including dev )
> 1. modify viewer.pro to match your system (include, lib directories)
> 2. modify main.cpp to have correct paths mapnik's  plug-ins and fonts dirs
> 3. qmake
> 4. make
>
> You could try loading your xml files :
>
> ./viewer your.xml
>
> or
>
> ./viewer your.xml  -1,50,1,52
>
> or
>
> ./viewer   + and open *.xml from file menu
>
> HTH
> Cheers
> Artem
>
>
>
> Xin
>  _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080226/742d0dae/attachment.html>

From Nick.Whitelegg at solent.ac.uk  Tue Feb 26 19:46:21 2008
From: Nick.Whitelegg at solent.ac.uk (Nick Whitelegg)
Date: Tue, 26 Feb 2008 18:46:21 +0000
Subject: [Mapnik-devel] Mapnik direct OSM support
Message-ID: <OF966887CB.3124151E-ON802573FB.006631D7-802573FB.00671EFA@solent-university.ac.uk>

Hello Artem (and anyone else),

I believe I've now implemented all code necessary to add direct OSM 
support to Mapnik. I've implemented an .osm XML parser, an osm_dataset 
class representing a complete OSM dataset, and implemented osm_datasource 
and osm_featureset classes inheriting from mapnik::datasource and 
mapnik::featureset.

What I'd just like to check now is how I make the library a plugin.  From 
my examination of the Mapnik directory layout, I just need to turn my code 
into a shared library and then place it under the 
/usr/local/lib/mapnik/input directory with a name of "osm.input". As long 
as the name() method of mapnik_datasource returns "osm", and I use "osm" 
in the Mapnik XML file where I'd normally use "postgis" or "shape", it 
looks like this should work.

Is this correct?

The code for my initial stab at this is at
http://www.nickw.uklinux.net/mapnik/mapnikosm_initial.tar.bz2

Thanks,
Nick


From artem at mapnik.org  Tue Feb 26 20:44:45 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Tue, 26 Feb 2008 19:44:45 +0000
Subject: [Mapnik-devel] comping mapnik viewer
In-Reply-To: <b3b5e5690802260633u663a905ax2e16b119049e9929@mail.gmail.com>
References: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
	<e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>
	<BD302FDE-A35A-4CF2-9BC8-07A68F85FBD6@mapnik.org>
	<b3b5e5690802260633u663a905ax2e16b119049e9929@mail.gmail.com>
Message-ID: <E8A22439-86B0-4B3C-8588-7E8C891A4D8D@mapnik.org>

Hi Xin,

> Hi Artem,
>
> Thank you for the quick reply.
>
> I managed to compile Viewer. But when I open my map definition  
> file, I get this error:
>
> Could not create datasource. No plugin found for type 'shape' in  
> layer 'world-1'
>
> As you can see, my map definition uses shape files. This definition  
> works fine with generate_image.py.
>
> A snippet from main.cpp:
>    datasource_cache::instance()->register_datasources("/home/xin/ 
> src/mapnik-0.5.0/plugins/input");
>
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/ 
> dejavu-ttf-2.14/DejaVuSans.ttf");
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/ 
> dejavu-ttf-2.14/DejaVuSans-Bold.ttf");
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0/fonts/ 
> dejavu-ttf-2.14/DejaVuSansMono.ttf");
>
> I compiled Mapnik too so that plugins/input has the lib files. ls  
> plugins/input :
>
> gdal  Makefile.am  postgis  raster  shape
>
> ls plugins/input/shape:
> dbffile.cpp   SConscript            shapefile.cpp   
> shape_index_featureset.cpp  shape_io.hpp
> dbffile.hpp   shape.cpp             shapefile.hpp   
> shape_index_featureset.hpp  shape_io.os
> dbffile.os    shape_featureset.cpp  shapefile.o     
> shape_index_featureset.os   shape.os
> dbf_test.cpp  shape_featureset.hpp  shapefile.os    
> shape.input                 shp_index.hpp
> Makefile.am   shape_featureset.os   shape.hpp      shape_io.cpp
>
> What do you think?

Have you run 'install' which puts things in correct directories  
(default /usr/local but you can specify PREFIX=/your/path )

python scons/scons.py install

(might need sudo )

You mentioned generate_image.py works for you, in this case have a  
look in paths.py which will have correct path to plugins.


>
>
> Thanks,
> Xin

Cheers
Artem

>
>
> On 25/02/2008, Artem Pavlenko <artem at mapnik.org> wrote:
> Hi Xin,
>
>
>> Hi List,
>>
>> I would like to use map viewer to aid me in developing my XML  
>> file. It would be really useful to see changes straight away, for  
>> different zoom levels without having to generate the tiles first.
>>
>> I found these previous threads. Although useful, they did not  
>> answer my question of how to compile.
>> https://lists.berlios.de/pipermail/mapnik-devel/2008-January/ 
>> 000408.html
>> https://lists.berlios.de/pipermail/mapnik-users/2007-August/ 
>> 000418.html
>>
>> Does anyone know how to compile this?
>>
>> Any help is much appreciated.
>
> The viewer is a qt4 application, so first  make sure you have qt4  
> properly installed on your system ( including dev )
> 1. modify viewer.pro to match your system (include, lib directories)
> 2. modify main.cpp to have correct paths mapnik's  plug-ins and  
> fonts dirs
> 3. qmake
> 4. make
>
> You could try loading your xml files :
>
> ./viewer your.xml
>
> or
>
> ./viewer your.xml  -1,50,1,52
>
> or
>
> ./viewer   + and open *.xml from file menu
>
> HTH
> Cheers
> Artem
>>
>>
>> Xin
>> _______________________________________________
>> Mapnik-devel mailing list
>> Mapnik-devel at lists.berlios.de
>> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080226/8ed9bf34/attachment.html>

From artem at mapnik.org  Tue Feb 26 20:48:08 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Tue, 26 Feb 2008 19:48:08 +0000
Subject: [Mapnik-devel] Mapnik direct OSM support
In-Reply-To: <OF966887CB.3124151E-ON802573FB.006631D7-802573FB.00671EFA@solent-university.ac.uk>
References: <OF966887CB.3124151E-ON802573FB.006631D7-802573FB.00671EFA@solent-university.ac.uk>
Message-ID: <14EEE3B7-1159-4F02-9C96-D9FB725A6E55@mapnik.org>


On 26 Feb 2008, at 18:46, Nick Whitelegg wrote:

> Hello Artem (and anyone else),
>
> I believe I've now implemented all code necessary to add direct OSM
> support to Mapnik. I've implemented an .osm XML parser, an osm_dataset
> class representing a complete OSM dataset, and implemented  
> osm_datasource
> and osm_featureset classes inheriting from mapnik::datasource and
> mapnik::featureset.

very cool!
>
> What I'd just like to check now is how I make the library a  
> plugin.  From
> my examination of the Mapnik directory layout, I just need to turn  
> my code
> into a shared library and then place it under the
> /usr/local/lib/mapnik/input directory with a name of "osm.input".  
> As long
> as the name() method of mapnik_datasource returns "osm", and I use  
> "osm"
> in the Mapnik XML file where I'd normally use "postgis" or "shape", it
> looks like this should work.
>
> Is this correct?

yes.
>
> The code for my initial stab at this is at
> http://www.nickw.uklinux.net/mapnik/mapnikosm_initial.tar.bz2

Great stuff, Nick! I'll have a look once I get a moment. I can give  
you svn write access just send me your public key (ssh).
>
> Thanks,
> Nick

Cheers
Artem


> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>



From tom at compton.nu  Tue Feb 26 22:42:58 2008
From: tom at compton.nu (Tom Hughes)
Date: Tue, 26 Feb 2008 21:42:58 GMT
Subject: [Mapnik-devel] Mapnik direct OSM support
In-Reply-To: <14EEE3B7-1159-4F02-9C96-D9FB725A6E55@mapnik.org>
References: <OF966887CB.3124151E-ON802573FB.006631D7-802573FB.00671EFA@solent-university.ac.uk>
	<14EEE3B7-1159-4F02-9C96-D9FB725A6E55@mapnik.org>
Message-ID: <817e5e774f.tom@loxley.compton.nu>

In message <14EEE3B7-1159-4F02-9C96-D9FB725A6E55 at mapnik.org>
          Artem Pavlenko <artem at mapnik.org> wrote:

> On 26 Feb 2008, at 18:46, Nick Whitelegg wrote:
> 
> > I believe I've now implemented all code necessary to add direct OSM
> > support to Mapnik. I've implemented an .osm XML parser, an osm_dataset
> > class representing a complete OSM dataset, and implemented
> > osm_datasource
> > and osm_featureset classes inheriting from mapnik::datasource and
> > mapnik::featureset.
> 
> very cool!

Indeed. It was something I had thought of doing myself.

How do you work out the type of the attributes Nick? Do you have a
built in table or do you just guess somehow?

Tom

-- 
Tom Hughes (tom at compton.nu)
http://www.compton.nu/


From jburgess at uklinux.net  Tue Feb 26 23:16:44 2008
From: jburgess at uklinux.net (Jon Burgess)
Date: Tue, 26 Feb 2008 22:16:44 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
Message-ID: <1204064204.3480.221.camel@localhost.localdomain>


On Mon, 2008-02-25 at 19:20 +0000, Artem Pavlenko wrote:
> On 24 Feb 2008, at 19:22, Jon Burgess wrote:
> 
> > The bug fix for the handling of NULL columns in r657 has broken  
> > part of
> > the osm.xml style file. The broken part is an attempts to render
> > specific fills for certain building types with a fallback for all  
> > other
> > cases where building is non-null.
> >
> >
> > <Filter>[railway] = 'station' or [building] = 'station'</Filter>
> > ... railway station style
> > <Filter>[building] = 'supermarket'</Filter>
> > ... supermarket style
> > <Filter>[building] &lt;&gt; 'station' and [building] &lt;&gt;  
> > 'supermarket' and [building] &lt;&gt; ''</Filter>
> > ... style for all other building types
> >
> >
> > We can not easily use an ElseFilter for this since this style has lots
> > of other things being rendered not just buildings.
> >
> > Is there another way to specify a filter equivalent to the SQL "is not
> > null", or should "[building] <> ''" be working for this? This used to
> > work before the NULL column fix.
> 
> There are couple ways to solve this :
> 1. introduce "null" value as a special case.
> 2. amend SQL statement to include ".. char_length(building) as  
> len..." and construct filter like:
> [building] &lt;&gt; 'station' and [building] &lt;&gt; 'supermarket'  
> and [len] > 0 ; ''
> 


I don't think running char_leng() on the column will do what you want. I
think the result of this is a NULL too...

gis=> select char_length(NULL)>0 as len;
 len
---

(1 row)

The only test which works is an "is null" one. I think we'd need to add
something like "'building' is null as building_null".

gis=> select 'foo' is NULL as building_null;
 building_null
---------------
 f
(1 row)

gis=> select NULL is NULL as building_null;
 building_null
---------------
 t
(1 row)


> There're probably other ways to handle this case.
> 
> Generally I don't think it is that great to have so many columns  
> which are NULLs in OSM schema and use those NULLs for data filtering.  
> We should probably split data into multiple logical tables and even  
> 'flatten' data by introducing some sort of numeric feature code :
> 
> [fcode] = 123123
> 
> and lookup table
> 
> fcode       |  desc
> ------------------
> 123123   |  supermarche
> 123124   |  station

I think Postgres is quite efficient at dealing with nul values, but I
have to agree that now that we have 40 columns we may be wasting some
space. I don't know just how compact Postgres stores its data, in theory
it might be possible for it to store each of these nul columns in a
single bit (followed by data for all the non-null columns).

If we introduce feature codes like these then I would hope they could be
entirely hidden by the software. I would personally not want to manually
translate to/from features codes when updating the osm.xml file.

> On related note,  should we have 'boolean' type for values?

We need to be careful since there are some not-quite boolean types in
use in OSM, e.g. oneway=0/1/-1. Maybe we code remove the -1 by reversing
the way direction during import.

	Jon




From Nick.Whitelegg at solent.ac.uk  Wed Feb 27 09:50:08 2008
From: Nick.Whitelegg at solent.ac.uk (Nick Whitelegg)
Date: Wed, 27 Feb 2008 08:50:08 +0000
Subject: [Mapnik-devel] Mapnik direct OSM support
In-Reply-To: <817e5e774f.tom@loxley.compton.nu>
Message-ID: <OFD452B6A3.42FC64F6-ON802573FC.0030766A-802573FC.00308960@solent-university.ac.uk>

>Indeed. It was something I had thought of doing myself.

>How do you work out the type of the attributes Nick? Do you have a
>built in table or do you just guess somehow?

Hello Tom,

TBH I've just assumed all are Strings for the moment. I want to get an 
initial version working, then refine it later.

Nick


From xin at zenpow.com  Wed Feb 27 17:12:49 2008
From: xin at zenpow.com (Xin)
Date: Wed, 27 Feb 2008 16:12:49 +0000
Subject: [Mapnik-devel] comping mapnik viewer
In-Reply-To: <E8A22439-86B0-4B3C-8588-7E8C891A4D8D@mapnik.org>
References: <e04cd2420802250846w1b4855edqd2fed8d048bc6184@mail.gmail.com>
	<e04cd2420802250850r590aeed7v641180684186184f@mail.gmail.com>
	<BD302FDE-A35A-4CF2-9BC8-07A68F85FBD6@mapnik.org>
	<b3b5e5690802260633u663a905ax2e16b119049e9929@mail.gmail.com>
	<E8A22439-86B0-4B3C-8588-7E8C891A4D8D@mapnik.org>
Message-ID: <b3b5e5690802270812q5440e304jd2a44fe66de77d49@mail.gmail.com>

Wheyhay! I got it working.

Thank you so much Arterm. I will defnitely be donating once I get paid:)

with appreciation,
Xin

On 26/02/2008, Artem Pavlenko <artem at mapnik.org> wrote:
>
> Hi Xin,
>
> Hi Artem,
>
> Thank you for the quick reply.
>
> I managed to compile Viewer. But when I open my map definition file, I get
> this error:
>
> Could not create datasource. No plugin found for type 'shape' in layer
> 'world-1'
>
> As you can see, my map definition uses shape files. This definition works
> fine with generate_image.py.
>
> A snippet from main.cpp:
>
> datasource_cache::instance()->register_datasources("/home/xin/src/mapnik-
> 0.5.0/plugins/input");
>
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0
> /fonts/dejavu-ttf-2.14/DejaVuSans.ttf");
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0
> /fonts/dejavu-ttf-2.14/DejaVuSans-Bold.ttf");
>    freetype_engine::register_font("/home/xin/src/mapnik-0.5.0
> /fonts/dejavu-ttf-2.14/DejaVuSansMono.ttf");
>
> I compiled Mapnik too so that plugins/input has the lib files. ls
> plugins/input :
>
> gdal  Makefile.am  postgis  raster  shape
>
> ls plugins/input/shape:
> dbffile.cpp   SConscript            shapefile.cpp
> shape_index_featureset.cpp  shape_io.hpp
> dbffile.hpp   shape.cpp             shapefile.hpp
> shape_index_featureset.hpp  shape_io.os
> dbffile.os    shape_featureset.cpp  shapefile.o
> shape_index_featureset.os   shape.os
> dbf_test.cpp  shape_featureset.hpp  shapefile.os   shape.input
> shp_index.hpp
> Makefile.am   shape_featureset.os   shape.hpp      shape_io.cpp
>
> What do you think?
>
>
> Have you run 'install' which puts things in correct directories (default
> /usr/local but you can specify PREFIX=/your/path )
>
> python scons/scons.py install
>
> (might need sudo )
>
> You mentioned generate_image.py works for you, in this case have a look in
> paths.py which will have correct path to plugins.
>
>
>
>
> Thanks,
> Xin
>
>
> Cheers
> Artem
>
>
>
> On 25/02/2008, Artem Pavlenko <artem at mapnik.org> wrote:
> >
> > Hi Xin,
> >
> > Hi List,
> >
> > I would like to use map viewer to aid me in developing my XML file. It
> > would be really useful to see changes straight away, for different zoom
> > levels without having to generate the tiles first.
> >
> > I found these previous threads. Although useful, they did not answer my
> > question of how to compile.
> > https://lists.berlios.de/pipermail/mapnik-devel/2008-January/000408.html
> > https://lists.berlios.de/pipermail/mapnik-users/2007-August/000418.html
> >
> > Does anyone know how to compile this?
> >
> > Any help is much appreciated.
> >
> >
> > The viewer is a qt4 application, so first  make sure you have qt4
> > properly installed on your system ( including dev )
> > 1. modify viewer.pro to match your system (include, lib directories)
> > 2. modify main.cpp to have correct paths mapnik's  plug-ins and fonts
> > dirs
> > 3. qmake
> > 4. make
> >
> > You could try loading your xml files :
> >
> > ./viewer your.xml
> >
> > or
> >
> > ./viewer your.xml  -1,50,1,52
> >
> > or
> >
> > ./viewer   + and open *.xml from file menu
> >
> > HTH
> > Cheers
> > Artem
> >
> >
> >
> > Xin
> >  _______________________________________________
> > Mapnik-devel mailing list
> > Mapnik-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/mapnik-devel
> >
> >
> >
> > _______________________________________________
> > Mapnik-devel mailing list
> > Mapnik-devel at lists.berlios.de
> > https://lists.berlios.de/mailman/listinfo/mapnik-devel
> >
> >
> _______________________________________________
> Mapnik-devel mailing list
> Mapnik-devel at lists.berlios.de
> https://lists.berlios.de/mailman/listinfo/mapnik-devel
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <https://lists.berlios.de/pipermail/mapnik-devel/attachments/20080227/562150c3/attachment.html>

From nick at hogweed.org  Thu Feb 28 01:18:48 2008
From: nick at hogweed.org (Nick Whitelegg)
Date: Thu, 28 Feb 2008 00:18:48 +0000
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing
Message-ID: <200802280018.48474.nick@hogweed.org>


Hello everyone,

Have just tried the Mapnik/OSM plugin. Unfortunately I get a crash when the 
XML is being parsed. This is unfortunately not reproducible if the XML 
parsing code is used standalone, rather than as an OSM plugin.

The latest version of my code is at 
http://www.nickw.uklinux.net/mapnik/mapnikosm_2.tar.bz2.

As well as the actual code, this contains a small C++ file - render.cpp - used 
for testing, along with a test XML style file - osmmerc.xml - and a small 
test OSM file - test.osm.

The error occurs when the the startElement() method in xmlparse.cpp is called.

I'm wondering whether this is something to do with the way I compiled the 
shared library? The libMakefile is what I use to make the shared library. I 
used -fPIC to compile each source file, then

gcc -shared -o osm.input $(OBJ)

to make the shared library.

A backtrace is displayed (see below)

Any ideas on this one? 

Thanks,
Nick

--

Output from render:

osm::dataset::loadmemset
setting up my_handler
parsing file`
*** glibc detected *** ./render: realloc(): invalid pointer: 0xbfbadc3c ***
======= Backtrace: =========
/lib/libc.so.6[0xb7a894b6]
/lib/libc.so.6(realloc+0x255)[0xb7a8d2f5]
/usr/lib/libxml2.so.2(nodePush+0x75)[0xb7e59d25]
/usr/lib/libxml2.so.2(xmlSAX2StartElement+0x119)[0xb7f1b709]
/usr/lib/libxml2.so.2(startElement+0x2b)[0xb7f227db]
/usr/lib/libxml2.so.2(xmlParseStartTag+0x481)[0xb7e63501]
/usr/lib/libxml2.so.2(xmlParseElement+0x199)[0xb7e6b849]
/usr/lib/libxml2.so.2(xmlParseDocument+0x2ab)[0xb7e6dafb]
/usr/lib/libxml2.so.2(xmlSAXUserParseFile+0x6b)[0xb7e6e85b]
/usr/local/lib/mapnik/input/osm.input(_ZN11osm_dataset4loadEPKc+0x121)
[0xb785e65f]
/usr/local/lib/mapnik/input/osm.input(_ZN14osm_datasourceC1ERKN6mapnik10parametersE+0x456)
[0xb7860758]
/usr/local/lib/mapnik/input/osm.input(create+0x34)[0xb7860b0c]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik16datasource_cache6createERKNS_10parametersE+0x4f8)[0xb7d0e808]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik10map_parser11parse_layerERNS_3MapERKN5boost13property_tree11basic_ptreeINS4_12ptree_traitsIcEEEE+0x6ff)
[0xb7d5970f]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik10map_parser9parse_mapERNS_3MapERKN5boost13property_tree11basic_ptreeINS4_12ptree_traitsIcEEEE+0x25d)
[0xb7d665fd]





From freeman at internet.co.nz  Thu Feb 28 05:29:30 2008
From: freeman at internet.co.nz (Jim Waite)
Date: Thu, 28 Feb 2008 17:29:30 +1300
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing
In-Reply-To: <200802280018.48474.nick@hogweed.org>
References: <200802280018.48474.nick@hogweed.org>
Message-ID: <000001c879c2$8322ee60$2100a8c0@optima.local>

Hi Nick.
Please confirm that the test.osm file is in the bzip archive that you
posted.  When I downloaded and bunzipped the file I could not find test.osm.
:-Jim


-----Original Message-----
From: mapnik-devel-bounces at lists.berlios.de
[mailto:mapnik-devel-bounces at lists.berlios.de] On Behalf Of Nick Whitelegg
Sent: Thursday, 28 February 2008 1:19 p.m.
To: 
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing


Hello everyone,

Have just tried the Mapnik/OSM plugin. Unfortunately I get a crash when the 
XML is being parsed. This is unfortunately not reproducible if the XML 
parsing code is used standalone, rather than as an OSM plugin.

The latest version of my code is at 
http://www.nickw.uklinux.net/mapnik/mapnikosm_2.tar.bz2.

As well as the actual code, this contains a small C++ file - render.cpp -
used 
for testing, along with a test XML style file - osmmerc.xml - and a small 
test OSM file - test.osm.

The error occurs when the the startElement() method in xmlparse.cpp is
called.

I'm wondering whether this is something to do with the way I compiled the 
shared library? The libMakefile is what I use to make the shared library. I 
used -fPIC to compile each source file, then

gcc -shared -o osm.input $(OBJ)

to make the shared library.

A backtrace is displayed (see below)

Any ideas on this one? 

Thanks,
Nick

--

Output from render:

osm::dataset::loadmemset
setting up my_handler
parsing file`
*** glibc detected *** ./render: realloc(): invalid pointer: 0xbfbadc3c ***
======= Backtrace: =========
/lib/libc.so.6[0xb7a894b6]
/lib/libc.so.6(realloc+0x255)[0xb7a8d2f5]
/usr/lib/libxml2.so.2(nodePush+0x75)[0xb7e59d25]
/usr/lib/libxml2.so.2(xmlSAX2StartElement+0x119)[0xb7f1b709]
/usr/lib/libxml2.so.2(startElement+0x2b)[0xb7f227db]
/usr/lib/libxml2.so.2(xmlParseStartTag+0x481)[0xb7e63501]
/usr/lib/libxml2.so.2(xmlParseElement+0x199)[0xb7e6b849]
/usr/lib/libxml2.so.2(xmlParseDocument+0x2ab)[0xb7e6dafb]
/usr/lib/libxml2.so.2(xmlSAXUserParseFile+0x6b)[0xb7e6e85b]
/usr/local/lib/mapnik/input/osm.input(_ZN11osm_dataset4loadEPKc+0x121)
[0xb785e65f]
/usr/local/lib/mapnik/input/osm.input(_ZN14osm_datasourceC1ERKN6mapnik10para
metersE+0x456)
[0xb7860758]
/usr/local/lib/mapnik/input/osm.input(create+0x34)[0xb7860b0c]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik16datasource_cache6createERKNS_10parametersE+0x4f8)[0xb7d0e808]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik10map_parser11parse_layerERNS_3MapERKN5boost13property_tree11basi
c_ptreeINS4_12ptree_traitsIcEEEE+0x6ff)
[0xb7d5970f]
/usr/local/lib/libmapnik.so.0.5
(_ZN6mapnik10map_parser9parse_mapERNS_3MapERKN5boost13property_tree11basic_p
treeINS4_12ptree_traitsIcEEEE+0x25d)
[0xb7d665fd]



_______________________________________________
Mapnik-devel mailing list
Mapnik-devel at lists.berlios.de
https://lists.berlios.de/mailman/listinfo/mapnik-devel



From Nick.Whitelegg at solent.ac.uk  Thu Feb 28 10:32:00 2008
From: Nick.Whitelegg at solent.ac.uk (Nick Whitelegg)
Date: Thu, 28 Feb 2008 09:32:00 +0000
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing
In-Reply-To: <000001c879c2$8322ee60$2100a8c0@optima.local>
Message-ID: <OFEC371C22.9D7BAEA4-ON802573FD.003451FC-802573FD.00345E77@solent-university.ac.uk>

>Hi Nick.
>Please confirm that the test.osm file is in the bzip archive that you
>posted.  When I downloaded and bunzipped the file I could not find 
test.osm.
>:-Jim

Hello Jim,

Sorry - I left it out. It is now in the bz2 archive (same url as before).

Nick


From kleptog at gmail.com  Thu Feb 28 16:19:43 2008
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Thu, 28 Feb 2008 16:19:43 +0100
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <1204064204.3480.221.camel@localhost.localdomain>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<1204064204.3480.221.camel@localhost.localdomain>
Message-ID: <2fc2c5f10802280719k4de866b3r11010eac3d340570@mail.gmail.com>

On Tue, Feb 26, 2008 at 11:16 PM, Jon Burgess <jburgess at uklinux.net> wrote:
>  I think Postgres is quite efficient at dealing with nul values, but I
>  have to agree that now that we have 40 columns we may be wasting some
>  space. I don't know just how compact Postgres stores its data, in theory
>  it might be possible for it to store each of these nul columns in a
>  single bit (followed by data for all the non-null columns).

Which is what it does. 40 columns works out to 5 bytes per row overhead.

I was think of storing as a hash, but that'd be more expensive since
you have to store the keys in each row...

Have a nice day,
-- 
Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/


From artem at mapnik.org  Thu Feb 28 16:28:12 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Thu, 28 Feb 2008 15:28:12 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <2fc2c5f10802280719k4de866b3r11010eac3d340570@mail.gmail.com>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<1204064204.3480.221.camel@localhost.localdomain>
	<2fc2c5f10802280719k4de866b3r11010eac3d340570@mail.gmail.com>
Message-ID: <EB144781-0390-42E1-9A47-212B77CF4C1F@mapnik.org>


On 28 Feb 2008, at 15:19, Martijn van Oosterhout wrote:

> On Tue, Feb 26, 2008 at 11:16 PM, Jon Burgess  
> <jburgess at uklinux.net> wrote:
>>  I think Postgres is quite efficient at dealing with nul values,  
>> but I
>>  have to agree that now that we have 40 columns we may be wasting  
>> some
>>  space. I don't know just how compact Postgres stores its data, in  
>> theory
>>  it might be possible for it to store each of these nul columns in a
>>  single bit (followed by data for all the non-null columns).
>
> Which is what it does. 40 columns works out to 5 bytes per row  
> overhead.


So, it uses 1 bit to store a null value? How did you figure it out?  
Can you point me to source, please ? I'm curious:)
Artem

>
> I was think of storing as a hash, but that'd be more expensive since
> you have to store the keys in each row...
>
> Have a nice day,
> -- 
> Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/
>



From gravitystorm at gmail.com  Thu Feb 28 17:32:41 2008
From: gravitystorm at gmail.com (Andy Allan)
Date: Thu, 28 Feb 2008 16:32:41 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <1204064204.3480.221.camel@localhost.localdomain>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<1204064204.3480.221.camel@localhost.localdomain>
Message-ID: <c4193f8c0802280832y75095683sfe97d24ea3de7611@mail.gmail.com>

On Tue, Feb 26, 2008 at 10:16 PM, Jon Burgess <jburgess at uklinux.net> wrote:

>  We need to be careful since there are some not-quite boolean types in
>  use in OSM, e.g. oneway=0/1/-1. Maybe we code remove the -1 by reversing
>  the way direction during import.

We'd need to be *very* careful with things like contraflow lanes in that case.

Cheers,
Andy


From kleptog at gmail.com  Thu Feb 28 18:03:05 2008
From: kleptog at gmail.com (Martijn van Oosterhout)
Date: Thu, 28 Feb 2008 18:03:05 +0100
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <EB144781-0390-42E1-9A47-212B77CF4C1F@mapnik.org>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<1204064204.3480.221.camel@localhost.localdomain>
	<2fc2c5f10802280719k4de866b3r11010eac3d340570@mail.gmail.com>
	<EB144781-0390-42E1-9A47-212B77CF4C1F@mapnik.org>
Message-ID: <2fc2c5f10802280903t7c581fact2732146b52117cd8@mail.gmail.com>

On Thu, Feb 28, 2008 at 4:28 PM, Artem Pavlenko <artem at mapnik.org> wrote:
>  So, it uses 1 bit to store a null value? How did you figure it out?
>  Can you point me to source, please ? I'm curious:)
>  Artem

How do I know? Well, on and off programming backend stuff in postgres
for many years teachs you things like this. However it is also in the
documentation.

http://www.postgresql.org/docs/8.3/static/storage-page-layout.html

Just before the HeapTupleHeaderData Layout table.

Have a nice day,
-- 
Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/


From artem at mapnik.org  Thu Feb 28 18:55:41 2008
From: artem at mapnik.org (Artem Pavlenko)
Date: Thu, 28 Feb 2008 17:55:41 +0000
Subject: [Mapnik-devel] Filter for Null columns in osm.xml?
In-Reply-To: <2fc2c5f10802280903t7c581fact2732146b52117cd8@mail.gmail.com>
References: <1203880973.3480.175.camel@localhost.localdomain>
	<47347AC3-AA96-48F9-9D4A-F6CF5315C3EC@mapnik.org>
	<1204064204.3480.221.camel@localhost.localdomain>
	<2fc2c5f10802280719k4de866b3r11010eac3d340570@mail.gmail.com>
	<EB144781-0390-42E1-9A47-212B77CF4C1F@mapnik.org>
	<2fc2c5f10802280903t7c581fact2732146b52117cd8@mail.gmail.com>
Message-ID: <8E00FFE1-183C-4660-B844-B1428D24BF40@mapnik.org>


On 28 Feb 2008, at 17:03, Martijn van Oosterhout wrote:

> On Thu, Feb 28, 2008 at 4:28 PM, Artem Pavlenko <artem at mapnik.org>  
> wrote:
>>  So, it uses 1 bit to store a null value? How did you figure it out?
>>  Can you point me to source, please ? I'm curious:)
>>  Artem
>
> How do I know? Well, on and off programming backend stuff in postgres
> for many years teachs you things like this. However it is also in the
> documentation.
>
> http://www.postgresql.org/docs/8.3/static/storage-page-layout.html
>
> Just before the HeapTupleHeaderData Layout table.

Thanks, Martjin. Looks like very compact storage layout.
If I understand correctly nulls bitmap needs testing for every  
attribute (I know it is fast op), does this till make case for  
reducing number of columns ? or not ?

>
> Have a nice day,
> -- 
> Martijn van Oosterhout <kleptog at gmail.com> http://svana.org/kleptog/

Cheers
Artem
>
Artem




From freeman at internet.co.nz  Thu Feb 28 23:33:41 2008
From: freeman at internet.co.nz (Jim Waite)
Date: Fri, 29 Feb 2008 11:33:41 +1300
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing
In-Reply-To: <OFEC371C22.9D7BAEA4-ON802573FD.003451FC-802573FD.00345E77@solent-university.ac.uk>
References: <000001c879c2$8322ee60$2100a8c0@optima.local>
	<OFEC371C22.9D7BAEA4-ON802573FD.003451FC-802573FD.00345E77@solent-university.ac.uk>
Message-ID: <000001c87a59$f8595060$2100a8c0@optima.local>

Hi Nick.
Thanks. Got it.

It all seems to work fine for me.  In other words, I can run the demo
"render.cpp" and it does not crash.  It produces the following output

osm::dataset::loadmemset
setting up my_handler
parsing file`
Start element
Start element
Start element
Start element
Found a node
Start element
 + some more similar to above...

...and the blah.png file is produced.

Sorry, I know this doesn't help much with your problem.

FWIW, I am compiling on a windows system, using MSVC++ 2005.  Linking
against libxml2-2.6.30

I had to make the following code change to osm_featureset.cpp to fix what
appears to be an infinite loop.

osm_featureset.cpp
***************
*** 107,113 ****
   while(i != cur_item->keyvals.end())
   {	
      //only add if in the specified set of attribute names
      if(attribute_names_.find(i->first) != attribute_names_.end())
         (*feature)[i->first] = tr_->transcode(i->second.c_str());
      ++i;   // <--- added this line 
   }


And the following change to osmmerc.xml to stop proj from complaining.
osmmerc.xml: line 3, prepended "+proj=latlong" to the srs attribute.


:-Jim


 
-----Original Message-----
From: Nick Whitelegg [mailto:Nick.Whitelegg at solent.ac.uk] 
Sent: Thursday, 28 February 2008 10:32 p.m.
To: Jim Waite
Cc: mapnik-devel at lists.berlios.de
Subject: Re: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing

>Hi Nick.
>Please confirm that the test.osm file is in the bzip archive that you
>posted.  When I downloaded and bunzipped the file I could not find 
test.osm.
>:-Jim

Hello Jim,

Sorry - I left it out. It is now in the bz2 archive (same url as before).

Nick



From Nick.Whitelegg at solent.ac.uk  Fri Feb 29 11:33:43 2008
From: Nick.Whitelegg at solent.ac.uk (Nick Whitelegg)
Date: Fri, 29 Feb 2008 10:33:43 +0000
Subject: [Mapnik-devel] Mapnik OSM plugin - crash in libxml parsing
In-Reply-To: <000001c87a59$f8595060$2100a8c0@optima.local>
Message-ID: <OF4F9A8C76.15A6DF6C-ON802573FE.00394AAC-802573FE.003A04CF@solent-university.ac.uk>

Hello everyone,

An update on the Mapnik OSM plugin. I reimplemented the XML parsing using 
expat 2.0.1, rather than libxml2, (actually re-used old code from osm2shp) 
and I no longer get the crash. There are some issues with rendering (i.e. 
not all ways are rendered correctly) but I suspect that can be sorted 
fairly easily.
Expat isn't a long term fix though, as I don't think it's utf-8 compliant. 


So it looks like it's a libxml2 issue of some sort. I'll check again but I 
think my code is OK. In case there are any libxml experts here the code is 
at

http://www.nickw.uklinux.net/mapnik/mapnik_osm_3.tar.bz2


What might be good is for anyone else with a Linux system (I say Linux as 
it seems to work in Jim's Windows environment) could test it out and see 
if you get a crash too. You'll need to make the following changes (as the 
version in the archive is set up to use expat for parsing):

In osm_dataset::load() in osm.cpp, comment out the block within the "if" 
which relates to expat, and uncomment the block relating to libxml2.
In the Makefile, change the make instructions for "render" to use 
LDFLAGS4, not LDFLAGS3.
In the makefile for the library (libMakefile), change the list of object 
files to include Parser.o, rather than xmlparse.o.

Thanks,
Nick


